<!DOCTYPE html>
<!--
G√úVENLƒ∞K NOTU: Bu uygulama bir web sunucusu √ºzerinden √ßalƒ±≈ütƒ±rƒ±lacaksa,
a≈üaƒüƒ±daki HTTP response header'larƒ±nƒ±n sunucu tarafƒ±nda ayarlanmasƒ± √∂nerilir:

- Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline' https://pagead2.googlesyndication.com https://www.googletagmanager.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' https://www.googleapis.com https://openlibrary.org https://api.allorigins.win https://api.codetabs.com https://cors-anywhere.herokuapp.com https://corsproxy.io https://api.cors.sh https://proxycors.com https://yacdn.org https://thingproxy.freeboard.io https://allorigins.win https://covers.openlibrary.org https://www.dr.com.tr https://www.bkmkitap.com https://www.kitapyurdu.com https://www.hepsiburada.com https://www.trendyol.com https://www.amazon.com.tr https://googleads.g.doubleclick.net https://tpc.googlesyndication.com;

- X-Content-Type-Options: nosniff

- Referrer-Policy: strict-origin-when-cross-origin

- X-Frame-Options: DENY (veya SAMEORIGIN)

Bu header'lar XSS, clickjacking ve diƒüer g√ºvenlik a√ßƒ±klarƒ±nƒ± √∂nlemeye yardƒ±mcƒ± olur.
-->
<html lang="tr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>Arama Uygulamasƒ±</title>
        <link rel="stylesheet" href="./styles/badges.css?v=2.0.0">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-secondary: white;
            --text-primary: #333;
            --text-secondary: #666;
            --text-white: white;
            --border-color: #ddd;
            --shadow: rgba(0,0,0,0.3);
            --card-bg: white;
            --input-bg: white;
            --input-border: #ddd;
            --safe-area-inset-top: 0px !important;
        }

        #banner-space {
            width: 100%;
            height: 65px;
            pointer-events: none;
        }

        @media (prefers-color-scheme: dark) {
            body:not(.light-mode):not(.dark-mode) {
                --bg-primary: linear-gradient(135deg, #2d1b4e 0%, #1a0f2e 100%);
                --bg-secondary: #1e1e1e;
                --text-primary: #e0e0e0;
                --text-secondary: #b0b0b0;
                --text-white: #e0e0e0;
                --border-color: #444;
                --shadow: rgba(0,0,0,0.6);
                --card-bg: #2d2d2d;
                --input-bg: #2d2d2d;
                --input-border: #555;
            }
        }

        /* Manuel koyu mod */
        body.dark-mode {
            --bg-primary: linear-gradient(135deg, #2d1b4e 0%, #1a0f2e 100%);
            --bg-secondary: #1e1e1e;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --text-white: #e0e0e0;
            --border-color: #444;
            --shadow: rgba(0,0,0,0.6);
            --card-bg: #2d2d2d;
            --input-bg: #2d2d2d;
            --input-border: #555;
        }

        /* Manuel a√ßƒ±k mod (prefers-color-scheme: dark olsa bile) */
        body.light-mode {
            --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-secondary: white;
            --text-primary: #333;
            --text-secondary: #666;
            --text-white: white;
            --border-color: #ddd;
            --shadow: rgba(0,0,0,0.3);
            --card-bg: white;
            --input-bg: white;
            --input-border: #ddd;
        }

        html {
            margin: 0;
            padding: 0;
            padding-top: 0 !important;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            transition: background 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 0;
            position: relative;
        }

        .header-actions {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .favorites-btn {
            padding: 5px 10px;
            background: rgba(255,255,255,0.9);
            color: #222;
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            height: 28px;
            display: flex;
            align-items: center;
        }

        body.dark-mode .favorites-btn {
            background: rgba(255,255,255,0.2);
            color: #ddd;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .favorites-btn:hover {
            background: rgba(255,255,255,1);
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        }

        body.dark-mode .favorites-btn:hover {
            background: rgba(255,255,255,0.3);
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .favorites-btn .badge {
            background: #e74c3c;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
            margin-left: 5px;
        }

        .theme-toggle-btn {
            padding: 5px 10px;
            background: rgba(255,255,255,0.9);
            color: #222;
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            height: 28px;
        }

        body.dark-mode .theme-toggle-btn {
            background: rgba(255,255,255,0.2);
            color: #ddd;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .theme-toggle-btn:hover {
            background: rgba(255,255,255,1);
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        }

        body.dark-mode .theme-toggle-btn:hover {
            background: rgba(255,255,255,0.3);
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .theme-toggle-btn .icon {
            font-size: 16px;
        }

        .badge-button {
            background: #3a3a3a;
            color: white;
            padding: 10px 16px;
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            width: fit-content;
            margin: 10px auto;
            border: none;
            transition: all 0.3s;
        }

        .badge-button:hover {
            background: #4a4a4a;
            transform: translateY(-1px);
        }

        .badge-notif {
            width: 10px;
            height: 10px;
            background: red;
            border-radius: 50%;
            display: none;
        }

        .badge-notif.active {
            display: inline-block;
        }

        .badges-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 99999;
        }

        .modal-content {
            width: 85%;
            background: #2e2e2e;
            padding: 20px;
            border-radius: 12px;
            color: white;
        }

        .badge-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 15px 0;
        }

        .badge-card {
            background: #1f1f1f;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            opacity: 0.4;
            border: 2px solid #444;
        }

        .badge-card.unlocked {
            opacity: 1;
            border-color: gold;
        }

        .badge-card button {
            margin-top: 8px;
            padding: 6px 10px;
            border: none;
            border-radius: 6px;
            background: #ff9800;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        .close-btn {
            background: #e53935;
            padding: 10px;
            border-radius: 8px;
            color: white;
            width: 100%;
            border: none;
            margin-top: 10px;
            cursor: pointer;
        }

        .user-title-box {
            background: #242424;
            padding: 10px 15px;
            margin: 10px auto;
            width: fit-content;
            border-radius: 12px;
            color: #ffd54f;
            font-size: 15px;
            font-weight: bold;
            text-align: center;
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .search-container {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px var(--shadow);
            margin-bottom: 30px;
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }

        .quote-box {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            margin-top: 0;
            padding: 15px;
            background: white;
            border: 2px solid var(--input-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* G√ºn√ºn s√∂z√º kutucuƒüu - tƒ±klanabilir deƒüil */

        .quote-text {
            font-size: 16px;
            color: var(--text-primary);
            font-style: italic;
            margin-bottom: 10px;
            line-height: 1.6;
            text-align: center;
        }

        .quote-author {
            font-size: 14px;
            color: var(--text-secondary);
            text-align: right;
            font-weight: 500;
            margin-top: 5px;
        }

        .quote-author::before {
            content: "‚Äî ";
        }

        body.dark-mode .quote-box {
            background: #2d2d2d;
            border-color: #555;
        }

        @media (prefers-color-scheme: dark) {
            body:not(.light-mode):not(.dark-mode) .quote-box {
                background: #2d2d2d;
                border-color: #555;
            }
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            position: relative;
        }

        .search-input-wrapper {
            flex: 1;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid var(--input-border);
            border-radius: 8px;
            outline: none;
            transition: border-color 0.3s;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        .search-input:focus {
            border-color: #667eea;
        }

        .search-history-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border: 2px solid var(--input-border);
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 5px 15px var(--shadow);
            display: none;
            margin-top: -2px;
        }

        .search-history-dropdown.show {
            display: block;
        }

        .search-history-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
            border-left: 3px solid transparent;
            color: var(--text-primary);
            transition: background 0.2s, border-left 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }

        .search-history-item:hover,
        .search-history-item:focus {
            background: var(--input-bg);
            border-left-color: #667eea;
        }

        .search-history-item:active {
            background: var(--input-bg);
            border-left-color: #764ba2;
            border-left-width: 4px;
        }

        .search-history-item:last-child {
            border-bottom: none;
        }

        .search-history-item .icon {
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .search-history-item:hover .icon,
        .search-history-item:focus .icon {
            opacity: 1;
        }

        .sort-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            flex-wrap: wrap;
            position: relative;
            top: auto;
            left: auto;
            z-index: 10;
        }

        .sort-label {
            font-size: 12px;
            color: #1a1a2e;
            font-weight: 700;
            white-space: nowrap;
            text-shadow: 0 1px 2px rgba(255,255,255,0.3);
        }

        body.dark-mode .sort-label {
            color: #f8f9fa;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }

        .sort-select {
            padding: 8px 32px 8px 14px;
            border: 2px solid rgba(102, 126, 234, 0.4);
            border-radius: 10px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            color: #1a1a2e;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            outline: none;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
            min-height: 36px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23667eea' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
        }

        body.dark-mode .sort-select {
            border: 2px solid rgba(255, 255, 255, 0.35);
            background: linear-gradient(135deg, rgba(30, 30, 50, 0.95) 0%, rgba(40, 40, 70, 0.95) 100%);
            color: #f8f9fa;
            box-shadow: 0 3px 12px rgba(0,0,0,0.4);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23a5b4fc' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
        }

        .sort-select:hover {
            border-color: rgba(102, 126, 234, 0.7);
            background: linear-gradient(135deg, #ffffff 0%, #eef1ff 100%);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);
            transform: translateY(-1px);
        }

        body.dark-mode .sort-select:hover {
            border-color: rgba(255, 255, 255, 0.55);
            background: linear-gradient(135deg, rgba(40, 40, 70, 0.98) 0%, rgba(50, 50, 90, 0.98) 100%);
            box-shadow: 0 5px 16px rgba(0,0,0,0.5);
        }

        .sort-select:focus {
            border-color: #667eea;
            background: linear-gradient(135deg, #ffffff 0%, #f0f4ff 100%);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2), 0 4px 12px rgba(102, 126, 234, 0.25);
        }

        body.dark-mode .sort-select:focus {
            border-color: #a5b4fc;
            background: linear-gradient(135deg, rgba(40, 40, 70, 1) 0%, rgba(55, 55, 100, 1) 100%);
            box-shadow: 0 0 0 3px rgba(165, 180, 252, 0.25), 0 5px 16px rgba(0,0,0,0.5);
        }

        /* Select option stilleri */
        .sort-select option {
            padding: 10px 14px;
            background: #ffffff;
            color: #1a1a2e;
            font-weight: 500;
        }

        body.dark-mode .sort-select option {
            background: #2a2a4a;
            color: #f8f9fa;
        }

        @media (max-width: 768px) {
            .sort-container {
                position: relative;
                top: auto;
                left: auto;
                margin-bottom: 10px;
            }
            
            .sort-select {
                padding: 6px 28px 6px 12px;
                font-size: 12px;
                min-height: 32px;
            }
        }

        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.1s ease, box-shadow 0.1s ease, background-color 0.15s ease;
        }

        .search-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .search-btn:active:not(:disabled) {
            transform: scale(0.97);
            box-shadow: 0 0 0 rgba(0,0,0,0);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.15);
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.1s ease, box-shadow 0.1s ease, background-color 0.15s ease, background 0.3s, color 0.3s, border-color 0.3s;
            font-size: 14px;
            color: #333;
            white-space: nowrap;
            flex-shrink: 0;
            position: relative;
        }

        body.dark-mode .filter-btn {
            background: var(--input-bg);
            border: 2px solid var(--border-color);
            color: var(--text-primary);
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .filter-btn.active::after {
            content: ' ‚úì';
            font-weight: bold;
        }

        .filter-btn:active {
            transform: scale(0.97);
            box-shadow: 0 0 0 rgba(0,0,0,0);
        }

        /* Eri≈üilebilirlik i√ßin g√∂rsel olarak gizli ama ekran okuyucu i√ßin g√∂r√ºn√ºr */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        .results-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .popular-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            padding: 6px 14px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
            box-shadow: 0 3px 10px rgba(255, 107, 107, 0.5);
            vertical-align: middle;
            white-space: nowrap;
            animation: pulse 2s ease-in-out infinite;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.9;
                transform: scale(1.02);
            }
        }

        .popular-book {
            border: 3px solid #ff6b6b !important;
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4) !important;
            background: linear-gradient(135deg, var(--card-bg) 0%, rgba(255, 107, 107, 0.08) 100%) !important;
            position: relative;
        }

        .popular-book::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff6b6b, #ee5a6f, #ff6b6b);
            border-radius: 15px 15px 0 0;
        }

        .popular-book:hover {
            box-shadow: 0 10px 35px rgba(255, 107, 107, 0.5) !important;
            transform: translateY(-6px) !important;
            border-color: #ff5252 !important;
        }

        .book-title {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
            line-height: 1.5;
        }

        .book-card {
            transition: transform 0.15s ease, box-shadow 0.15s ease;
            position: relative;
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s, background 0.3s;
            display: flex;
            flex-direction: column;
            color: var(--text-primary);
        }

        .book-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.18);
        }

        /* Favoriler i√ßin k√º√ß√ºk kart g√∂r√ºn√ºm√º */
        .book-card.favorite-small {
            padding: 12px;
            border-radius: 10px;
        }

        .book-card.favorite-small .book-cover {
            max-width: 80px;
            height: 110px;
            margin: 0 auto 8px;
        }

        .book-card.favorite-small .book-cover-placeholder {
            max-width: 80px;
            height: 110px;
            margin: 0 auto 8px;
            font-size: 24px;
        }

        .book-card.favorite-small .book-title {
            font-size: 1.1em;
            margin-bottom: 6px;
        }

        .book-card.favorite-small .book-author {
            font-size: 0.9em;
            margin-bottom: 6px;
        }

        .book-card.favorite-small .book-year {
            font-size: 0.8em;
            margin-bottom: 8px;
        }

        .book-card.favorite-small .book-summary {
            font-size: 0.85em;
            line-height: 1.4;
            margin-bottom: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .book-card.favorite-small .purchase-link {
            padding: 6px 8px;
            font-size: 11px;
        }

        .book-card.favorite-small .favorite-btn {
            width: 36px;
            height: 36px;
            top: 8px;
            right: 8px;
            font-size: 18px;
        }

        /* Koyu modda kompakt kart g√∂r√ºn√ºm√º */
        body.dark-mode .book-card:not(.favorite-small) {
            padding: 18px;
            border-radius: 12px;
        }

        body.dark-mode .book-card:not(.favorite-small) .book-cover {
            max-width: 135px;
            height: 180px;
            margin: 0 auto 12px;
        }

        body.dark-mode .book-card:not(.favorite-small) .book-cover-placeholder {
            max-width: 135px;
            height: 180px;
            margin: 0 auto 12px;
            font-size: 38px;
        }

        body.dark-mode .book-card:not(.favorite-small) .book-title {
            font-size: 1.25em;
            margin-bottom: 8px;
        }

        body.dark-mode .book-card:not(.favorite-small) .book-author {
            font-size: 1em;
            margin-bottom: 8px;
        }

        body.dark-mode .book-card:not(.favorite-small) .book-year {
            font-size: 0.85em;
            margin-bottom: 12px;
        }

        body.dark-mode .book-card:not(.favorite-small) .book-summary {
            font-size: 0.9em;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        body.dark-mode .book-card:not(.favorite-small) .purchase-link {
            padding: 10px;
            font-size: 13px;
        }

        .book-cover {
            width: 100%;
            max-width: 150px;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin: 0 auto 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            display: block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .book-cover-placeholder {
            width: 100%;
            max-width: 150px;
            height: 200px;
            border-radius: 8px;
            margin: 0 auto 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            display: none;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 42px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            letter-spacing: 2px;
            position: relative;
        }

        .book-cover-placeholder.show {
            display: flex;
        }

        .book-cover-placeholder::before {
            content: 'üìö';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            opacity: 0.3;
        }

        .book-info {
            flex: 1;
        }

        .book-title {
            font-size: 1.4em;
            color: var(--text-primary);
            margin-bottom: 10px;
            font-weight: bold;
        }

        .book-author {
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .book-year {
            color: var(--text-secondary);
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .book-summary {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 20px;
            text-align: justify;
        }

        .purchase-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .purchase-link {
            flex: 1;
            padding: 12px;
            text-align: center;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
            color: white;
            font-size: 14px;
        }

        .purchase-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .dr-link {
            background: #e74c3c;
        }

        .bkm-link {
            background: #3498db;
        }

        .kitapyurdu-link {
            background: #2ecc71;
        }

        .hepsiburada-link {
            background: #ff6600;
        }

        .trendyol-link {
            background: #ff6000;
        }

        .amazon-link {
            background: #ff9900;
        }

        .favorite-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border: 2px solid rgba(0, 0, 0, 0.08);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: #888;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.8);
            z-index: 10;
        }

        .favorite-btn:hover {
            transform: scale(1.15);
            background: linear-gradient(145deg, #ffffff, #e8e8e8);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .favorite-btn:active {
            transform: scale(0.95);
        }

        .favorite-btn.active {
            background: linear-gradient(145deg, #ff6b6b, #ee5a5a);
            border-color: #d63031;
            color: white;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .favorite-btn.active:hover {
            background: linear-gradient(145deg, #ff5252, #e53935);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.5);
        }

        /* Dark mode i√ßin favori butonu */
        body.dark-mode .favorite-btn {
            background: linear-gradient(145deg, #3d3d3d, #2d2d2d);
            border-color: rgba(255, 255, 255, 0.1);
            color: #aaa;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .favorite-btn:hover {
            background: linear-gradient(145deg, #4a4a4a, #3a3a3a);
            color: #ffd700;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
        }

        body.dark-mode .favorite-btn.active {
            background: linear-gradient(145deg, #ff6b6b, #ee5a5a);
            border-color: #ff6b6b;
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        body.dark-mode .favorite-btn.active:hover {
            background: linear-gradient(145deg, #ff5252, #e53935);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.5);
        }

        /* Sistem dark mode tercihine g√∂re */
        @media (prefers-color-scheme: dark) {
            body:not(.light-mode):not(.dark-mode) .favorite-btn {
                background: linear-gradient(145deg, #3d3d3d, #2d2d2d);
                border-color: rgba(255, 255, 255, 0.1);
                color: #aaa;
                box-shadow: 0 3px 12px rgba(0, 0, 0, 0.3);
            }

            body:not(.light-mode):not(.dark-mode) .favorite-btn:hover {
                background: linear-gradient(145deg, #4a4a4a, #3a3a3a);
                color: #ffd700;
            }

            body:not(.light-mode):not(.dark-mode) .favorite-btn.active {
                background: linear-gradient(145deg, #ff6b6b, #ee5a5a);
                color: white;
            }
        }

        /* Fiyat Kar≈üƒ±la≈ütƒ±rma Stilleri */
        .price-compare-btn {
            background: #1db954;
            color: #fff;
            padding: 7px 12px;
            border-radius: 6px;
            margin-top: 6px;
            cursor: pointer;
            font-weight: bold;
            border: none;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .price-compare-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(29, 185, 84, 0.3);
            background: #1ed760;
        }

        .go-buy-btn {
            background: #ff6b35;
            color: #fff;
            padding: 6px 14px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.85em;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .go-buy-btn:hover {
            background: #ff8659;
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(255, 107, 53, 0.3);
        }

        /* Fiyat y√ºkleme animasyonlarƒ± */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .price-loading-container {
            text-align: center;
            padding: 30px 20px;
        }

        .price-loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(29, 185, 84, 0.2);
            border-top-color: #1db954;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .price-loading-text {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 15px;
            animation: pulse 2s ease-in-out infinite;
        }

        .price-loading-stores {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 20px;
        }

        .price-loading-store {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: rgba(29, 185, 84, 0.1);
            border-radius: 6px;
            font-size: 14px;
            animation: slideIn 0.3s ease-out;
        }

        .price-loading-store.active {
            background: rgba(29, 185, 84, 0.2);
        }

        .price-loading-store .store-name {
            font-weight: 500;
        }

        .price-loading-store .store-status {
            font-size: 12px;
            color: #1db954;
        }

        .price-loading-store .store-status::after {
            content: '...';
            animation: pulse 1.5s ease-in-out infinite;
        }

        .price-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, .6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .price-content {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 300px;
            animation: pop .25s ease;
            color: var(--text-primary);
        }

        @keyframes pop {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .price-row:last-of-type {
            border-bottom: none;
        }

        .go-buy-btn {
            background: #ff6b35;
            color: #fff;
            padding: 6px 14px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.85em;
            transition: all 0.2s;
            white-space: nowrap;
            margin-left: 10px;
        }

        .go-buy-btn:hover {
            background: #ff8659;
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(255, 107, 53, 0.3);
        }

        .price-row span {
            flex: 1;
        }

        .price-row strong {
            flex: 1;
            text-align: center;
            color: var(--text-primary);
        }

        .price-row a {
            background: #1db954;
            color: #fff;
            padding: 4px 7px;
            border-radius: 4px;
            text-decoration: none;
            margin-left: 10px;
            font-size: 12px;
        }

        .price-row a:hover {
            background: #1ed760;
        }

        .price-content h3 {
            margin-top: 0;
            margin-bottom: 15px;
            text-align: center;
            color: var(--text-primary);
        }

        .close-modal {
            margin-top: 15px;
            width: 100%;
            background: #444;
            color: #fff;
            padding: 8px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .close-modal:hover {
            background: #555;
        }

        .no-results {
            text-align: center;
            color: var(--text-white);
            font-size: 1.2em;
            padding: 40px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
        }

        .loading {
            text-align: center;
            color: var(--text-white);
            font-size: 1.2em;
            padding: 40px;
        }

        .favorites-view {
            display: none;
        }

        .favorites-view.active {
            display: block;
        }

        .search-view.active {
            display: block;
        }

        .view-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            color: white;
        }

        .view-header h2 {
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .back-btn {
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .empty-favorites {
            text-align: center;
            color: white;
            font-size: 1.2em;
            padding: 40px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
        }

        .favorites-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
            backdrop-filter: blur(5px);
        }

        .favorites-modal.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 20px;
        }

        .favorites-modal-content {
            background: var(--bg-secondary);
            border-radius: 20px;
            max-width: 1400px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 20px 60px var(--shadow);
            position: relative;
            transition: background 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }

        .modal-header h2 {
            color: var(--text-primary);
            font-size: 2em;
            margin: 0;
        }

        .close-modal-btn {
            padding: 10px 20px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .close-modal-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .price-comparison-section {
            margin-top: 20px;
            padding: 20px;
            background: var(--input-bg);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .price-comparison-title {
            font-size: 1.3em;
            color: var(--text-primary);
            margin-bottom: 15px;
            font-weight: bold;
        }

        .price-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .price-input-group {
            display: flex;
            flex-direction: column;
        }

        .price-input-group label {
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .price-input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            width: 100%;
        }

        .price-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .price-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .price-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }

        .price-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        .price-table tr:hover {
            background: #f8f9fa;
        }

        .price-value {
            font-weight: bold;
            color: #2ecc71;
            font-size: 1.1em;
        }

        .price-value.empty {
            color: #999;
            font-weight: normal;
        }

        .best-price {
            background: #d4edda !important;
            font-weight: bold;
        }

        .save-prices-btn {
            padding: 10px 20px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .save-prices-btn:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }

        .compare-all-btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .compare-all-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .fetch-prices-btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 15px;
            transition: all 0.3s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .fetch-prices-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .fetch-prices-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .price-loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .price-status {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        .price-status.success {
            color: #2ecc71;
        }

        .price-status.error {
            color: #e74c3c;
        }


        .single-book-price-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1001;
            overflow-y: auto;
            backdrop-filter: blur(5px);
        }

        .single-book-price-modal.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .single-book-price-content {
            background: var(--bg-secondary);
            border-radius: 20px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            box-shadow: 0 20px 60px var(--shadow);
            position: relative;
            color: var(--text-primary);
        }

        @media (max-width: 768px) {
            .search-box {
                flex-direction: column;
            }

            .results-container {
                grid-template-columns: 1fr;
            }

            .header-actions {
                position: static;
                justify-content: center;
                margin-top: 0;
            }

            .view-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .filter-buttons {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                padding-bottom: 5px;
            }

            .filter-buttons::-webkit-scrollbar {
                display: none;
            }

            .filter-btn {
                min-width: fit-content;
                font-size: 13px;
                padding: 8px 16px;
            }
        }



        /* Gizlilik a√ßƒ±klamasƒ± stilleri */
        .privacy-notice {
            margin-top: 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            color: rgba(255, 255, 255, 0.95);
            font-size: 13px;
            line-height: 1.6;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            transition: background 0.3s ease, color 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .privacy-notice strong {
            color: rgba(255, 255, 255, 1);
            font-weight: 600;
        }

        .privacy-notice-icon {
            font-size: 18px;
            margin-bottom: 10px;
            display: block;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
        }

        @media (max-width: 768px) {
            .privacy-notice {
                font-size: 12px;
                padding: 15px;
                margin-top: 0;
            }
        }

        /* AdMob Reklam Stilleri */
        #native-ad-card {
            grid-column: 1 / -1;
            width: 100%;
            max-width: 100%;
            display: flex;
            align-items: center;
            gap: 24px;
            border: 1px solid rgba(255, 255, 255, 0.25);
            background: rgba(255, 255, 255, 0.9);
            color: #0f172a;
            padding: 24px;
        }

        body.dark-mode #native-ad-card {
            background: rgba(15, 23, 42, 0.85);
            border-color: rgba(148, 163, 184, 0.3);
            color: #e2e8f0;
        }

        #native-ad-card .book-cover,
        #native-ad-card .book-cover-placeholder {
            flex: 0 0 180px;
            max-width: 180px;
            height: 240px;
            margin: 0;
        }

        #native-ad-card .book-info {
            flex: 1 1 320px;
            text-align: left;
        }

        #native-ad-card .purchase-links {
            flex-wrap: wrap;
            justify-content: flex-start;
        }

        #native-ad-card .purchase-link {
            flex: 0 0 auto;
        }

        .ad-label {
            font-size: 11px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: rgba(15, 23, 42, 0.65);
            text-align: right;
        }

        body.dark-mode .ad-label {
            color: rgba(226, 232, 240, 0.65);
        }

        /* Empty ad slots should collapse gracefully */
        /* Empty ad containers should collapse gracefully */
        .ad-slot,
        #native-ad-card:empty,
        #ad-placeholder:empty {
            min-height: 0 !important;
            height: auto !important;
        }
        
        /* Ensure ad containers can collapse when empty */
        [id*="ad-container"] {
            min-height: 0 !important;
            height: auto !important;
        }


        /* Ad placeholder styles */
        #ad-placeholder {
            width: 100%;
            min-height: 120px;
            height: auto;
            background: #f5f5f5;
            margin: 20px auto;
            border-radius: 8px;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.dark-mode #ad-placeholder {
            background: #2d2d2d;
        }

        @media (max-width: 768px) {
            #native-ad-card {
                flex-direction: column;
                padding: 18px;
                gap: 16px;
                text-align: center;
            }

            #native-ad-card .book-info {
                text-align: center;
            }

            #native-ad-card .purchase-links {
                justify-content: center;
            }
        }

        /* ===== NEON SPLASH SCREEN (Optimized) ===== */
        #splash-screen {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 9999;
            background: linear-gradient(135deg, #0a0f1a 0%, #000000 100%);
            transition: opacity 1.2s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            will-change: opacity;
        }

        .splash-visible {
            opacity: 1;
        }

        .splash-hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* Splash tamamen gizlendiƒüinde */
        .splash-removed {
            display: none !important;
        }

        /* Basitle≈ütirilmi≈ü par√ßacƒ±klar - sadece 5 adet */
        .splash-particles {
            position: absolute;
            inset: 0;
            overflow: hidden;
            will-change: transform;
        }

        .splash-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #39ff14;
            border-radius: 50%;
            opacity: 0.4;
            animation: float-particle 5s ease-in-out infinite;
            will-change: transform, opacity;
        }

        .splash-particle:nth-child(1) { left: 15%; top: 25%; animation-delay: 0s; }
        .splash-particle:nth-child(2) { left: 75%; top: 20%; animation-delay: 1s; }
        .splash-particle:nth-child(3) { left: 25%; top: 70%; animation-delay: 2s; }
        .splash-particle:nth-child(4) { left: 80%; top: 65%; animation-delay: 1.5s; }
        .splash-particle:nth-child(5) { left: 50%; top: 85%; animation-delay: 0.5s; }

        @keyframes float-particle {
            0%, 100% { transform: translateY(0); opacity: 0.3; }
            50% { transform: translateY(-20px); opacity: 0.7; }
        }

        /* Logo container - basitle≈ütirilmi≈ü animasyon */
        .splash-logo-container {
            position: relative;
            animation: logo-entrance 0.8s ease-out forwards;
            opacity: 0;
            transform: scale(0.8);
            will-change: transform, opacity;
        }

        @keyframes logo-entrance {
            to { opacity: 1; transform: scale(1); }
        }

        /* Neon SVG Logo - optimize edilmi≈ü glow */
        .splash-neon-logo {
            width: 160px;
            height: 160px;
            filter: drop-shadow(0 0 15px #39ff14) drop-shadow(0 0 30px rgba(57, 255, 20, 0.4));
            animation: neon-pulse 3s ease-in-out infinite;
            will-change: filter;
        }

        .splash-neon-logo path,
        .splash-neon-logo circle,
        .splash-neon-logo line {
            stroke: #39ff14;
            stroke-width: 2.5;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        @keyframes neon-pulse {
            0%, 100% { filter: drop-shadow(0 0 15px #39ff14) drop-shadow(0 0 30px rgba(57, 255, 20, 0.4)); }
            50% { filter: drop-shadow(0 0 25px #39ff14) drop-shadow(0 0 50px rgba(57, 255, 20, 0.6)); }
        }

        /* √áizim animasyonu - daha hƒ±zlƒ± */
        .splash-neon-logo .book-outline {
            stroke-dasharray: 800;
            stroke-dashoffset: 800;
            animation: draw-logo 1.2s ease-out forwards 0.2s;
        }

        .splash-neon-logo .magnifier {
            stroke-dasharray: 400;
            stroke-dashoffset: 400;
            animation: draw-logo 0.8s ease-out forwards 0.6s;
        }

        @keyframes draw-logo {
            to { stroke-dashoffset: 0; }
        }

        /* Uygulama adƒ± - basitle≈ütirilmi≈ü */
        .splash-title {
            margin-top: 25px;
            font-size: 2.4em;
            font-weight: 700;
            letter-spacing: 3px;
            color: #39ff14;
            text-shadow: 0 0 20px rgba(57, 255, 20, 0.8), 0 0 40px rgba(57, 255, 20, 0.4);
            animation: fade-in-up 0.6s ease-out forwards 0.4s;
            opacity: 0;
            will-change: transform, opacity;
        }

        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Alt yazƒ± */
        .splash-subtitle {
            margin-top: 8px;
            font-size: 1em;
            color: rgba(57, 255, 20, 0.6);
            letter-spacing: 2px;
            text-transform: uppercase;
            animation: fade-in 0.6s ease-out forwards 0.6s;
            opacity: 0;
        }

        @keyframes fade-in {
            to { opacity: 1; }
        }

        /* Y√ºkleme √ßubuƒüu */
        .splash-loader-container {
            margin-top: 40px;
            width: 180px;
            height: 3px;
            background: rgba(57, 255, 20, 0.15);
            border-radius: 3px;
            overflow: hidden;
            animation: fade-in 0.4s ease-out forwards 0.8s;
            opacity: 0;
        }

        .splash-loader-bar {
            height: 100%;
            background: #39ff14;
            border-radius: 3px;
            box-shadow: 0 0 10px rgba(57, 255, 20, 0.6);
            animation: loader-progress 1.8s ease-out forwards 1s;
            width: 0%;
            will-change: width;
        }

        @keyframes loader-progress {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        /* Y√ºkleniyor yazƒ±sƒ± */
        .splash-loading-text {
            margin-top: 12px;
            font-size: 0.8em;
            color: rgba(57, 255, 20, 0.5);
            letter-spacing: 1px;
            animation: fade-in 0.4s ease-out forwards 0.8s;
            opacity: 0;
        }

        /* Halka efekti - sadece 1 tane, daha hafif */
        .splash-ring {
            position: absolute;
            width: 250px;
            height: 250px;
            border: 1px solid rgba(57, 255, 20, 0.08);
            border-radius: 50%;
            animation: ring-expand 4s ease-out infinite;
            will-change: transform, opacity;
        }

        .splash-ring:nth-child(2) { animation-delay: 1.3s; }
        .splash-ring:nth-child(3) { display: none; }

        @keyframes ring-expand {
            0% { transform: scale(0.6); opacity: 0.5; }
            100% { transform: scale(1.8); opacity: 0; }
        }
            </style>
        </head>
        <body>
            <div id="userTitleBox" class="user-title-box">
                √únvan: <span id="activeTitle">‚Äî</span>
            </div>
            <!-- Splash Screen -->
    <script>
        // Mobilde hemen √ßalƒ±≈üacak inline script - splash screen'i kapat
        // Bu script body'nin ba≈üƒ±nda √ßalƒ±≈üƒ±r, ana script'ten baƒüƒ±msƒ±zdƒ±r
        (function() {
            function hideSplash() {
                try {
                    var splash = document.getElementById('splash-screen');
                    if (splash && !splash.classList.contains('splash-hidden')) {
                        // √ñnce fade-out ba≈ülat
                        splash.classList.remove('splash-visible');
                        splash.classList.add('splash-hidden');
                        
                        // Fade-out animasyonu bittikten sonra tamamen kaldƒ±r
                        setTimeout(function() {
                            if (splash) {
                                splash.classList.add('splash-removed');
                            }
                        }, 1200); // CSS transition s√ºresi kadar bekle
                    }
                } catch(e) {
                    // Hata durumunda direkt gizle
                    try {
                        var splash = document.getElementById('splash-screen');
                        if (splash) {
                            splash.style.display = 'none';
                        }
                    } catch(e2) {}
                }
            }

            // Optimize edilmi≈ü zamanlama - 2.8 saniye
            var SPLASH_DURATION = 2800;
            
            // DOM hazƒ±r olduƒüunda ba≈ülat
            if (document.readyState === 'complete' || document.readyState === 'interactive') {
                setTimeout(hideSplash, SPLASH_DURATION);
            } else {
                document.addEventListener('DOMContentLoaded', function() {
                    setTimeout(hideSplash, SPLASH_DURATION);
                }, false);
            }
            
            // G√ºvenlik: 4 saniye sonra kesinlikle kapat
            setTimeout(hideSplash, 4000);
        })();
        </script>
        <div id="splash-screen" class="splash-visible">
            <!-- Halka efektleri -->
            <div class="splash-ring"></div>
            <div class="splash-ring"></div>
            
            <!-- Arka plan par√ßacƒ±klarƒ± (azaltƒ±lmƒ±≈ü) -->
            <div class="splash-particles">
                <div class="splash-particle"></div>
                <div class="splash-particle"></div>
                <div class="splash-particle"></div>
                <div class="splash-particle"></div>
                <div class="splash-particle"></div>
            </div>
            
            <!-- Logo -->
            <div class="splash-logo-container">
                <svg class="splash-neon-logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <!-- Kitap ana g√∂vdesi -->
                    <path class="book-outline" d="M15 20 L15 75 Q15 80 20 80 L65 80 Q70 80 70 75 L70 25 Q70 20 65 20 L20 20 Q15 20 15 25" />
                    <!-- Kitap orta √ßizgisi (cilt) -->
                    <path class="book-outline" d="M42 20 L42 80" />
                    <!-- Kitap sayfalarƒ± sol -->
                    <line class="book-outline" x1="22" y1="32" x2="38" y2="32" />
                    <line class="book-outline" x1="22" y1="42" x2="38" y2="42" />
                    <line class="book-outline" x1="22" y1="52" x2="38" y2="52" />
                    <line class="book-outline" x1="22" y1="62" x2="35" y2="62" />
                    <!-- Kitap arka sayfalar efekti -->
                    <path class="book-outline" d="M18 22 L18 77" />
                    <path class="book-outline" d="M21 24 L21 76" />
                    <!-- B√ºy√ºte√ß -->
                    <circle class="magnifier" cx="62" cy="52" r="18" />
                    <line class="magnifier" x1="75" y1="65" x2="88" y2="82" style="stroke-width: 5;" />
                    <!-- B√ºy√ºte√ß i√ßi parlaklƒ±k -->
                    <path class="magnifier" d="M52 45 Q56 40 62 42" style="stroke-width: 2; opacity: 0.6;" />
                </svg>
            </div>
            
            <!-- Uygulama adƒ± -->
            <div class="splash-title">KitapMatik</div>
            <div class="splash-subtitle">Ara ‚Ä¢ Bul ‚Ä¢ Al</div>
            
            <!-- Y√ºkleme √ßubuƒüu -->
            <div class="splash-loader-container">
                <div class="splash-loader-bar"></div>
            </div>
            <div class="splash-loading-text">Y√ºkleniyor...</div>
        </div>
                    <div class="container">
                        <div class="header">
                            <div class="header-actions">
                                <button class="theme-toggle-btn" onclick="toggleTheme()" aria-label="Tema deƒüi≈ütir" title="Koyu/A√ßƒ±k tema deƒüi≈ütir">
                                    <span class="icon" id="themeIcon">üåô</span>
                                        <span id="themeText">Koyu Mod</span>
                                        </button>
                                        <button class="favorites-btn" onclick="showFavorites()">
                                            ‚≠ê Favorilerim <span class="badge" id="favoritesCount">0</span>
                                        </button>
                                    </div>
                                            <div id="badgeButton" class="badge-button" onclick="openBadges()">
                                                üèÖ Rozetler
                                                <span id="badgeNotif" class="badge-notif"></span>
                                            </div>
                                            <div id="quoteBox" class="quote-box" aria-label="G√ºn√ºn s√∂z√º" style="position:relative; overflow:hidden; background:linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.02)); border:1px solid rgba(255,255,255,0.08); border-radius:18px; padding:22px 28px 18px; box-shadow:0 15px 35px rgba(0,0,0,0.2); margin-bottom:18px; backdrop-filter:blur(6px);">
                                                <span aria-hidden="true" style="position:absolute; inset:0; background:radial-gradient(circle at top left, rgba(255,255,255,0.35), transparent 55%); opacity:0.7;"></span>
                                                    <span aria-hidden="true" style="position:absolute; inset:10px; border:1px dashed rgba(255,255,255,0.25); border-radius:14px; pointer-events:none;"></span>
                                                        <div style="position:relative; z-index:1;">
                                                            <div class="quote-text" id="quoteText" style="font-size:1.15rem; line-height:1.6; font-weight:600; letter-spacing:0.4px;">Okumak, ruhun gƒ±dasƒ±dƒ±r.</div>
                                                                <div class="quote-author" id="quoteAuthor" style="margin-top:8px; font-size:0.95rem; letter-spacing:1px; text-transform:uppercase; font-weight:600; color:var(--quote-author-color, #1f2a37); text-shadow:0 3px 8px rgba(0,0,0,0.35); transition:color 0.3s ease;">Cicero</div>
                                                                </div>
                                                            </div>
                                                        </div>


                                                        <!-- Arama G√∂r√ºn√ºm√º -->
                                                        <div id="searchView" class="search-view active">
                                                            <div class="search-container">
                                                                <div class="sort-container">
                                                                    <label for="sortSelect" class="sort-label">üìä Sƒ±ralama:</label>
                                                                        <select id="sortSelect" class="sort-select" aria-label="Sƒ±ralama se√ßeneƒüi">
                                                                            <option value="relevance">üéØ ƒ∞lgililik</option>
                                                                            <option value="newest">üÜï En Yeni</option>
                                                                            <option value="popular">üî• Pop√ºler</option>
                                                                        </select>
                                                                                <button class="filter-btn" id="trend-raft-btn" onclick="openTrendSection()" aria-pressed="false" aria-label="Trend Rafƒ±" style="padding: 6px 12px; font-size: 12px; height: 28px; line-height: 1;">üî• Trend Rafƒ±</button>
                                                                                <button class="filter-btn" onclick="openBlog()" aria-label="Blog" style="padding: 6px 12px; font-size: 12px; height: 28px; line-height: 1;">üìö Blog</button>
                                                                                </div>
                                                                                <div class="search-box">
                                                                                    <div class="search-input-wrapper">
                                                                                        <label for="searchInput" class="visually-hidden">Arama</label>
                                                                                            <input type="text" id="searchInput" class="search-input" placeholder="Adƒ±, yazar, yayƒ±nevi veya test kitabƒ± arayƒ±n..." aria-label="Arama kutusu" maxlength="100" autocomplete="off">
                                                                                            <div id="searchHistoryDropdown" class="search-history-dropdown" role="listbox" aria-label="Arama ge√ßmi≈üi"></div>
                                                                                            </div>
                                                                                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                                                                                <button id="searchBtn" onclick="searchBooks()" class="search-btn" aria-label="Ara">Ara</button>
                                                                                                    </div>
                                                                                                </div>
                                                                                                <div class="filter-buttons" role="group" aria-label="Arama filtreleri">
                                                                                                    <button class="filter-btn active" onclick="setFilter('all', this)" aria-pressed="true" aria-label="T√ºm√º filtresi (se√ßili)">T√ºm√º</button>
                                                                                                        <button class="filter-btn" onclick="setFilter('book', this)" aria-pressed="false" aria-label="Adƒ± filtresi">Adƒ±</button>
                                                                                                            <button class="filter-btn" onclick="setFilter('author', this)" aria-pressed="false" aria-label="Yazar filtresi">Yazar</button>
                                                                                                                <button class="filter-btn" onclick="setFilter('publisher', this)" aria-pressed="false" aria-label="Yayƒ±nevi filtresi">Yayƒ±nevi</button>
                                                                                                                    <button class="filter-btn" onclick="setFilter('test', this)" aria-pressed="false" aria-label="Test Kitabƒ± filtresi">Test Kitabƒ±</button>
                                                                                                                    </div>
                                                                                                                </div>


                                                                                                                <!-- Sonu√ß B√∂l√ºmleri -->
                                                                                                                <div id="results-normal" class="results-container" role="list" aria-label="Arama sonu√ßlarƒ±" style="display: none;"></div>
                                                                                                                        <div id="results-trend" class="results-container" role="list" aria-label="Trend kitaplar" style="display: none;"></div>

                                                                                                                        <!-- Ad Placeholder -->
                                                                                                                        <div id="ad-placeholder"></div>



                                                                                                                        </div>

                                                                                                                        <!-- Favoriler G√∂r√ºn√ºm√º -->
                                                                                                                        <div id="favoritesView" class="favorites-view">
                                                                                                                            <div class="view-header">
                                                                                                                                <h2>‚≠ê Favorilerim</h2>
                                                                                                                                    <button class="back-btn" onclick="showSearch()">‚Üê Arama Sayfasƒ±na D√∂n</button>
                                                                                                                                    </div>
                                                                                                                                    <div id="favoritesContainer" class="results-container" role="list" aria-label="Favori kitaplar"></div>
                                                                                                                                    </div>

                                                                                                                                    <!-- Favoriler Modal -->
                                                                                                                                    <div id="favoritesModal" class="favorites-modal">
                                                                                                                                        <div class="favorites-modal-content">
                                                                                                                                            <div class="modal-header">
                                                                                                                                                <h2>‚≠ê Favorilerim</h2>
                                                                                                                                                    <button class="close-modal-btn" onclick="closeFavoritesModal()">‚úï Kapat</button>
                                                                                                                                                    </div>
                                                                                                                                                    <div id="favoritesModalContainer" class="results-container"></div>
                                                                                                                                                    </div>
                                                                                                                                                </div>

                                                                                                                                                <!-- Tekil Kitap Fiyat Kar≈üƒ±la≈ütƒ±rma Modal -->
                                                                                                                                                <div id="singleBookPriceModal" class="single-book-price-modal">
                                                                                                                                                    <div class="single-book-price-content">
                                                                                                                                                        <div class="modal-header">
                                                                                                                                                            <h2>üí∞ Fiyat Kar≈üƒ±la≈ütƒ±rma</h2>
                                                                                                                                                                <button class="close-modal-btn" onclick="closeSingleBookPriceModal()">‚úï Kapat</button>
                                                                                                                                                                </div>
                                                                                                                                                                <div id="singleBookPriceContent"></div>
                                                                                                                                                                </div>
                                                                                                                                                            </div>



                                                                                                                                                            <!-- Badges Modal -->
                                                                                                                                                            <div id="badgesModal" class="badges-modal" style="display:none;">
                                                                                                                                                                <div class="modal-content">
                                                                                                                                                                    <h2>Rozetlerim</h2>
                                                                                                                                                                    <div id="badgeGrid" class="badge-grid"></div>
                                                                                                                                                                    <button class="close-btn" onclick="closeBadges()">Kapat</button>
                                                                                                                                                                </div>
                                                                                                                                                            </div>

                                                                                                                                                            <!-- Gizlilik A√ßƒ±klamasƒ± -->
                                                                                                                                                            <div class="privacy-notice" role="contentinfo" aria-label="Gizlilik a√ßƒ±klamasƒ±">
                                                                                                                                                                <span class="privacy-notice-icon">üîí</span>
                                                                                                                                                                    <strong>Gizlilik ve Veri G√ºvenliƒüi:</strong> Uygulama kullanƒ±cƒ± verilerini sunuculara g√∂ndermez. Favoriler, tema se√ßimi ve arama ge√ßmi≈üi yalnƒ±zca cihazda yerel olarak saklanƒ±r.
                                                                                                                                                                    </div>
                                                                                                                                                                </div>



    <script>
        // Pop√ºler s√∂zler listesi
        const POPULAR_QUOTES = [
            // Atat√ºrk s√∂zleri (aƒüƒ±rlƒ±klƒ±)
            { text: "Eƒüitimdir ki, bir milleti ya h√ºr, baƒüƒ±msƒ±z, ≈üanlƒ±, y√ºksek bir toplum halinde ya≈üatƒ±r ya da esaret ve sefalete terk eder.", author: "Mustafa Kemal Atat√ºrk", weight: 3 },
            { text: "Hayatta en hakiki m√ºr≈üit ilimdir, fendir.", author: "Mustafa Kemal Atat√ºrk", weight: 3 },
            { text: "Okumak demek, bence, insanƒ±n kendi kendisiyle konu≈ümasƒ± demektir.", author: "Mustafa Kemal Atat√ºrk", weight: 3 },
            { text: "Bir millet irfan ordusuna sahip olmadƒ±k√ßa sava≈ü meydanlarƒ±nda ne kadar parlak zaferler elde ederse etsin, o zaferlerin kalƒ±cƒ± sonu√ßlar vermesi m√ºmk√ºn deƒüildir.", author: "Mustafa Kemal Atat√ºrk", weight: 3 },
            { text: "Uyuyan milletler ya √∂l√ºr, ya da k√∂le olarak uyanƒ±rlar.", author: "Mustafa Kemal Atat√ºrk", weight: 3 },
            
            // T√ºrk yazarlar
            { text: "ƒ∞nsan okumalƒ±, ama ya≈üamak i√ßin okumalƒ±.", author: "Sabahattin Ali" },
            { text: "Kitap, insanƒ±n i√ßine a√ßƒ±lan penceredir.", author: "Ya≈üar Kemal" },
            { text: "Her kitap, binlerce yƒ±lƒ±n birikimidir.", author: "Cemil Meri√ß" },
            { text: "Okumak, d√º≈ü√ºnmenin ta kendisidir.", author: "Ahmet Hamdi Tanpƒ±nar" },
            { text: "Bir kitap bazen bir √∂mre bedeldir.", author: "Oƒüuz Atay" },
            { text: "Kelimeler, insanƒ± insan yapan tek ≈üeydir.", author: "Nazƒ±m Hikmet" },
            { text: "ƒ∞nsan ancak sevdiƒüi ≈üeyi iyi anlar.", author: "Orhan Pamuk" },
            { text: "Edebiyat, insanƒ±n kendini arama yolculuƒüudur.", author: "Ahmet √úmit" },
            { text: "Her ≈üiir, ruhun bir par√ßasƒ±dƒ±r.", author: "Cemal S√ºreya" },
            { text: "S√∂z, insanƒ±n aynasƒ±dƒ±r.", author: "Attila ƒ∞lhan" },
            { text: "Okumak, ba≈üka hayatlarƒ± ya≈üamaktƒ±r.", author: "Z√ºlf√º Livaneli" },
            
            // Klasik d√ºnya yazarlarƒ±
            { text: "Okumak, ruhun gƒ±dasƒ±dƒ±r.", author: "Cicero" },
            { text: "Kitaplar, uygarlƒ±ƒüƒ±n gemisidir.", author: "Carl Sagan" },
            { text: "Bir kitap okumak, yazarƒ±n beyniyle d√º≈ü√ºnmektir.", author: "Arthur Schopenhauer" },
            { text: "Kitaplar olmasaydƒ±, d√ºnya karanlƒ±kta kalƒ±rdƒ±.", author: "Thomas Carlyle" },
            { text: "Bazƒ± kitaplar tadƒ±lmalƒ±, bazƒ±larƒ± yutulmalƒ±, √ßok azƒ± ise √ßiƒünenip sindirilmelidir.", author: "Francis Bacon" },
            { text: "Kitaplar, sessiz √∂ƒüretmenlerdir.", author: "Aulus Gellius" },
            { text: "Ger√ßek cennet, kaybettiƒüimiz cennet deƒüil, okuduƒüumuz kitaplardƒ±r.", author: "Marcel Proust" },
            { text: "Kitaplar, insanlƒ±ƒüƒ±n hafƒ±zasƒ±dƒ±r.", author: "Isaac Asimov" },
            { text: "Okumayan insan, sadece bir hayat ya≈üar. Okuyan ise binlerce hayat ya≈üar.", author: "George R.R. Martin" },
            { text: "Bir oda kitapsƒ±zsa, ruhsuz bir beden gibidir.", author: "Cicero" },
            { text: "Kitaplar gemilerin ta≈üƒ±yamadƒ±ƒüƒ± y√ºkleri ta≈üƒ±r.", author: "Emily Dickinson" },
            
            // Modern d√ºnya yazarlarƒ±
            { text: "Bir kitap, sonsuz bir yolculuktur.", author: "Jorge Luis Borges" },
            { text: "Kitaplar, hayal g√ºc√ºn√ºn kapƒ±larƒ±nƒ± a√ßar.", author: "J.K. Rowling" },
            { text: "Bir kitap, bir hayattƒ±r.", author: "Maya Angelou" },
            { text: "Kitaplar, d√º≈ü√ºncelerin evidir.", author: "Mark Twain" },
            { text: "Okuyan bir insan, iki hayat ya≈üar.", author: "Umberto Eco" },
            { text: "Her kitap, yeni bir yolculuktur.", author: "Paulo Coelho" },
            { text: "Kitaplar, en sadƒ±k arkada≈ülardƒ±r.", author: "Ernest Hemingway" },
            { text: "Bir roman, hayatƒ±n yoƒüunla≈ütƒ±rƒ±lmƒ±≈ü halidir.", author: "Milan Kundera" },
            { text: "ƒ∞yi edebiyat, insanlƒ±ƒüƒ±n aynasƒ±dƒ±r.", author: "Virginia Woolf" },
            { text: "Kitaplar, √∂l√ºms√ºzl√ºƒü√ºn kanƒ±tƒ±dƒ±r.", author: "Carl Sagan" },
            
            // Filozoflar
            { text: "Okumak, bilginin anahtarƒ±dƒ±r.", author: "Konf√º√ßy√ºs" },
            { text: "Kitaplar, hayatƒ±n rehberidir.", author: "Seneca" },
            { text: "Kitaplar, bilgeliƒüin kaynaƒüƒ±dƒ±r.", author: "Platon" },
            { text: "Okumak, bilgeliƒüin ba≈ülangƒ±cƒ±dƒ±r.", author: "Sokrates" },
            { text: "Okumak, zihni √∂zg√ºrle≈ütirir.", author: "Ralph Waldo Emerson" },
            { text: "Bilgi g√º√ßt√ºr.", author: "Francis Bacon" },
            
            // ≈ûairler
            { text: "Okumak, ruhu y√ºkseltir.", author: "Victor Hugo" },
            { text: "D√ºn akƒ±llƒ±ydƒ±m, d√ºnyayƒ± deƒüi≈ütirmek istedim. Bug√ºn bilgeyim, kendimi deƒüi≈ütiriyorum.", author: "Mevlana" },
            { text: "≈ûiir, kelimelerin m√ºziƒüidir.", author: "Pablo Neruda" },
            { text: "Bir kitap, sessiz bir devrimdir.", author: "Fyodor Dostoyevski" },
            { text: "Edebiyat, insanlƒ±ƒüƒ±n vicdanƒ±dƒ±r.", author: "Lev Tolstoy" },
            
            // ƒ∞lham verici
            { text: "Bug√ºn okuduƒüun bir satƒ±r, yarƒ±n hayatƒ±nƒ± deƒüi≈ütirebilir.", author: "Anonim" },
            { text: "Her okunan sayfa, zihnine eklenen bir tuƒüladƒ±r.", author: "Anonim" },
            { text: "En g√ºzel yolculuklar, sayfalarda yapƒ±lƒ±r.", author: "Anonim" },
            { text: "Kitaplar √∂lmez, sadece yeni okuyucularƒ±nƒ± bekler.", author: "Anonim" },
            { text: "Okumak, kendi sesini ba≈üka seslerde bulmaktƒ±r.", author: "Anonim" }
        ];

        // G√ºnl√ºk s√∂z sistemi - Her g√ºn aynƒ± s√∂z g√∂sterilir
        function getDailyQuote() {
            const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
            const storedData = localStorage.getItem('dailyQuote_v1');
            
            if (storedData) {
                try {
                    const data = JSON.parse(storedData);
                    // Eƒüer bug√ºn√ºn s√∂z√º zaten varsa, onu g√∂ster
                    if (data.date === today && data.quote) {
                        return data.quote;
                    }
                } catch (e) {
                    console.error('G√ºnl√ºk s√∂z verisi okunamadƒ±:', e);
                }
            }
            
            // Yeni g√ºn i√ßin s√∂z se√ß
            // Tarihe g√∂re deterministik index hesapla (her g√ºn farklƒ± ama tutarlƒ±)
            const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            const year = new Date().getFullYear();
            const seed = (dayOfYear * 31 + year) % POPULAR_QUOTES.length;
            
            // Aƒüƒ±rlƒ±klƒ± se√ßim i√ßin index'i ayarla
            let selectedQuote = POPULAR_QUOTES[seed];
            
            // Atat√ºrk s√∂zleri aƒüƒ±rlƒ±klƒ± olsun (her 3 g√ºnde 1 Atat√ºrk s√∂z√º)
            if (dayOfYear % 3 === 0) {
                const ataturkQuotes = POPULAR_QUOTES.filter(q => q.author === "Mustafa Kemal Atat√ºrk");
                if (ataturkQuotes.length > 0) {
                    selectedQuote = ataturkQuotes[dayOfYear % ataturkQuotes.length];
                }
            }
            
            // G√ºn√ºn s√∂z√ºn√º kaydet
            localStorage.setItem('dailyQuote_v1', JSON.stringify({
                date: today,
                quote: selectedQuote
            }));
            
            return selectedQuote;
        }

        // G√ºnl√ºk s√∂z√º g√∂ster
        function showDailyQuote() {
            const quote = getDailyQuote();
            if (quote) {
                document.getElementById('quoteText').textContent = quote.text;
                document.getElementById('quoteAuthor').textContent = quote.author;
            }
        }

        // Sayfa y√ºklendiƒüinde g√ºnl√ºk s√∂z√º g√∂ster
        document.addEventListener('DOMContentLoaded', function() {
            showDailyQuote();
        });

        let currentFilter = 'all';
        let isSearching = false; // √áift tƒ±klama korumasƒ± i√ßin flag
        const API_BASE_URL = 'https://www.googleapis.com/books/v1/volumes';
        const OPEN_LIBRARY_API_URL = 'https://openlibrary.org/search.json';

        // API kodlarƒ± kaldƒ±rƒ±ldƒ±

        // Pop√ºler kitaplar listesi (maƒüazalarda √ßok satanlar)
        const POPULAR_BOOKS = [
            // Adam Fawer
            { title: 'Empati', author: 'Adam Fawer', isbn: '9786254258992' },
            { title: 'Empati', author: 'Fawer', isbn: '9786254258992' },
            { title: 'Empati', author: 'Adam', isbn: '9786254258992' },
            { title: 'Kontr', author: 'Adam Fawer' },
            { title: 'Kaos', author: 'Adam Fawer' },
            { title: 'Obsesif', author: 'Adam Fawer' },
            // ≈ûebnem ƒ∞≈üig√ºzel
            { title: 'Hanƒ±m Hanƒ±mcƒ±k', author: '≈ûebnem ƒ∞≈üig√ºzel' },
            { title: 'Civan', author: '≈ûebnem ƒ∞≈üig√ºzel' },
            // Ahmet √úmit
            { title: 'ƒ∞stanbul Hatƒ±rasƒ±', author: 'Ahmet √úmit' },
            { title: 'Bab-ƒ± Esrar', author: 'Ahmet √úmit' },
            { title: 'Sis ve Gece', author: 'Ahmet √úmit' },
            // Elif ≈ûafak
            { title: 'A≈ük', author: 'Elif ≈ûafak' },
            { title: 'Kƒ±rk Kural', author: 'Elif ≈ûafak' },
            { title: 'Ustam ve Ben', author: 'Elif ≈ûafak' },
            // Orhan Pamuk
            { title: 'Kƒ±rmƒ±zƒ± Sa√ßlƒ± Kadƒ±n', author: 'Orhan Pamuk' },
            { title: 'Kafamda Bir Tuhaflƒ±k', author: 'Orhan Pamuk' },
            { title: 'Kar', author: 'Orhan Pamuk' },
            // ƒ∞hsan Oktay Anar
            { title: 'Puslu Kƒ±talar Atlasƒ±', author: 'ƒ∞hsan Oktay Anar' },
            { title: 'Efr√¢siyab\'ƒ±n Hikayeleri', author: 'ƒ∞hsan Oktay Anar' },
            // Z√ºlf√º Livaneli
            { title: 'Serenad', author: 'Z√ºlf√º Livaneli' },
            { title: 'Mutluluk', author: 'Z√ºlf√º Livaneli' },
            // K√ºr≈üat Ba≈üar
            { title: 'Benim Adƒ±m Kƒ±rmƒ±zƒ±', author: 'Orhan Pamuk' },
            // Tuna Kiremit√ßi
            { title: 'Gizli Ajanda', author: 'Tuna Kiremit√ßi' },
            // Hakan G√ºnday
            { title: 'Zargana', author: 'Hakan G√ºnday' },
            { title: 'Daha', author: 'Hakan G√ºnday' },
            // Oƒüuz Atay
            { title: 'Tutunamayanlar', author: 'Oƒüuz Atay' },
            { title: 'Tehlikeli Oyunlar', author: 'Oƒüuz Atay' },
            // Ya≈üar Kemal
            { title: 'ƒ∞nce Memed', author: 'Ya≈üar Kemal' },
            { title: 'Teneke', author: 'Ya≈üar Kemal' },
            // Sabahattin Ali
            { title: 'K√ºrk Mantolu Madonna', author: 'Sabahattin Ali' },
            { title: 'ƒ∞√ßimizdeki ≈ûeytan', author: 'Sabahattin Ali' },
            // Re≈üat Nuri G√ºntekin
            { title: '√áalƒ±ku≈üu', author: 'Re≈üat Nuri G√ºntekin' },
            // Halide Edib Adƒ±var
            { title: 'Sinekli Bakkal', author: 'Halide Edib Adƒ±var' },
            // Y√ºz√ºklerin Efendisi (√ßeviri)
            { title: 'Y√ºz√ºklerin Efendisi', author: 'J.R.R. Tolkien' },
            { title: 'Y√ºz√ºk Karde≈üliƒüi', author: 'Tolkien' },
            // Harry Potter (√ßeviri)
            { title: 'Harry Potter', author: 'J.K. Rowling' },
            { title: 'Harry Potter ve Felsefe Ta≈üƒ±', author: 'Rowling' },
            // Su√ß ve Ceza (√ßeviri)
            { title: 'Su√ß ve Ceza', author: 'Dostoyevski' },
            { title: 'Su√ß ve Ceza', author: 'Fyodor Dostoyevsky' },
            // Sava≈ü ve Barƒ±≈ü (√ßeviri)
            { title: 'Sava≈ü ve Barƒ±≈ü', author: 'Tolstoy' },
            { title: 'Sava≈ü ve Barƒ±≈ü', author: 'Leo Tolstoy' },
            // 1984 (√ßeviri)
            { title: '1984', author: 'George Orwell' },
            // Hayvan √áiftliƒüi (√ßeviri)
            { title: 'Hayvan √áiftliƒüi', author: 'George Orwell' },
            // Simyacƒ± (√ßeviri)
            { title: 'Simyacƒ±', author: 'Paulo Coelho' },
            // K√º√ß√ºk Prens (√ßeviri)
            { title: 'K√º√ß√ºk Prens', author: 'Antoine de Saint-Exup√©ry' },
            { title: 'K√º√ß√ºk Prens', author: 'Saint-Exup√©ry' }
        ];

        // Kitap e≈üle≈ütirme fonksiyonu (ba≈ülƒ±k ve yazar kar≈üƒ±la≈ütƒ±rmasƒ±)
        function isBookMatch(book, popularBook) {
            if (!book || !popularBook) return false;

            // ISBN e≈üle≈ümesi (en kesin)
            if (popularBook.isbn && book.isbn) {
                const bookIsbn = book.isbn.replace(/[-\s]/g, '').substring(0, 13);
                const popularIsbn = popularBook.isbn.replace(/[-\s]/g, '').substring(0, 13);
                if (bookIsbn === popularIsbn || bookIsbn.endsWith(popularIsbn) || popularIsbn.endsWith(bookIsbn)) {
                    return true;
                }
            }

            // Ba≈ülƒ±k ve yazar e≈üle≈ümesi
            let bookTitle = (book.title || '').toLowerCase().trim();
            let popularTitle = (popularBook.title || '').toLowerCase().trim();
            let bookAuthor = (book.author || '').toLowerCase().trim();
            let popularAuthor = (popularBook.author || '').toLowerCase().trim();

            // √ñzel karakterleri ve fazla bo≈üluklarƒ± temizle
            bookTitle = bookTitle.replace(/[^\w\sƒü√º≈üƒ±√∂√ßƒû√ú≈ûƒ∞√ñ√á]/g, '').replace(/\s+/g, ' ');
            popularTitle = popularTitle.replace(/[^\w\sƒü√º≈üƒ±√∂√ßƒû√ú≈ûƒ∞√ñ√á]/g, '').replace(/\s+/g, ' ');
            bookAuthor = bookAuthor.replace(/[^\w\sƒü√º≈üƒ±√∂√ßƒû√ú≈ûƒ∞√ñ√á]/g, '').replace(/\s+/g, ' ');
            popularAuthor = popularAuthor.replace(/[^\w\sƒü√º≈üƒ±√∂√ßƒû√ú≈ûƒ∞√ñ√á]/g, '').replace(/\s+/g, ' ');

            // Ba≈ülƒ±k e≈üle≈ümesi kontrol√º (daha toleranslƒ±)
            const titleWords = bookTitle.split(/\s+/).filter(w => w.length > 1);
            const popularTitleWords = popularTitle.split(/\s+/).filter(w => w.length > 1);

            // Tam e≈üle≈üme
            let titleMatch = bookTitle === popularTitle;

            // Normalize edilmi≈ü e≈üle≈üme (bo≈üluklar ve √∂zel karakterler olmadan)
            if (!titleMatch) {
                const normalizedBookTitle = bookTitle.replace(/\s+/g, '').replace(/[^\wƒü√º≈üƒ±√∂√ßƒû√ú≈ûƒ∞√ñ√á]/g, '');
                const normalizedPopularTitle = popularTitle.replace(/\s+/g, '').replace(/[^\wƒü√º≈üƒ±√∂√ßƒû√ú≈ûƒ∞√ñ√á]/g, '');
                titleMatch = normalizedBookTitle === normalizedPopularTitle;
            }

            // Kelime bazlƒ± e≈üle≈üme (ba≈ülƒ±ƒüƒ±n %60'ƒ± e≈üle≈üiyorsa kabul et - daha esnek)
            if (!titleMatch && titleWords.length > 0 && popularTitleWords.length > 0) {
                const matchingWords = titleWords.filter(word =>
                    popularTitleWords.some(popWord =>
                        word === popWord ||
                        word.includes(popWord) ||
                        popWord.includes(word) ||
                        (word.length >= 3 && popWord.length >= 3 && word.substring(0, 3) === popWord.substring(0, 3))
                    )
                );
                // Daha esnek: en az %60 e≈üle≈üme veya tek kelimelik ba≈ülƒ±klar i√ßin tam e≈üle≈üme
                const minMatch = Math.min(titleWords.length, popularTitleWords.length);
                titleMatch = matchingWords.length >= Math.max(1, Math.ceil(minMatch * 0.6)) ||
                           (titleWords.length === 1 && popularTitleWords.length === 1 && titleWords[0] === popularTitleWords[0]);
            }

            // ƒ∞√ßerme kontrol√º (daha esnek)
            if (!titleMatch) {
                titleMatch = bookTitle.includes(popularTitle) ||
                           popularTitle.includes(bookTitle) ||
                           bookTitle.replace(/\s+/g, '').includes(popularTitle.replace(/\s+/g, '')) ||
                           popularTitle.replace(/\s+/g, '').includes(bookTitle.replace(/\s+/g, ''));
            }

            if (!titleMatch) return false;

            // Yazar e≈üle≈ümesi kontrol√º (yazar bilgisi varsa)
            if (popularAuthor && bookAuthor) {
                // Yazar adlarƒ±nƒ± kelimelere ayƒ±r (daha esnek - 2 karakterden uzun kelimeler)
                const authorWords = popularAuthor.split(/\s+/).filter(w => w.length > 1);
                const bookAuthorWords = bookAuthor.split(/\s+/).filter(w => w.length > 1);

                // Yazar kelimelerinin e≈üle≈ümesini kontrol et
                const hasAuthorMatch = authorWords.some(word => {
                    return bookAuthorWords.some(bookWord => {
                        // Tam e≈üle≈üme
                        if (word === bookWord) return true;
                        // ƒ∞√ßerme kontrol√º
                        if (word.includes(bookWord) || bookWord.includes(word)) return true;
                        // ƒ∞lk 3 karakter e≈üle≈ümesi (daha esnek)
                        if (word.length >= 3 && bookWord.length >= 3) {
                            if (word.substring(0, 3) === bookWord.substring(0, 3)) return true;
                        }
                        // Normalize edilmi≈ü e≈üle≈üme
                        const normWord = word.replace(/[^\wƒü√º≈üƒ±√∂√ßƒû√ú≈ûƒ∞√ñ√á]/g, '');
                        const normBookWord = bookWord.replace(/[^\wƒü√º≈üƒ±√∂√ßƒû√ú≈ûƒ∞√ñ√á]/g, '');
                        if (normWord === normBookWord || normWord.includes(normBookWord) || normBookWord.includes(normWord)) {
                            return true;
                        }
                        return false;
                    });
                });

                // Yazar e≈üle≈ümesi yoksa ama ba≈ülƒ±k kesin e≈üle≈üiyorsa yine kabul et
                if (!hasAuthorMatch && titleMatch) {
                    // Ba≈ülƒ±k tam e≈üle≈üiyorsa yazar kontrol√ºn√º atla
                    if (bookTitle === popularTitle ||
                        bookTitle.replace(/\s+/g, '') === popularTitle.replace(/\s+/g, '')) {
                        return true;
                    }
                }

                return hasAuthorMatch;
            }

            // Yazar bilgisi yoksa sadece ba≈ülƒ±k e≈üle≈ümesi yeterli
            // Ama ba≈ülƒ±k kesin e≈üle≈üiyorsa kabul et
            return titleMatch;
        }

        // Google'da pop√ºler olan yazarlar (en √ßok aranan - Google Trends'e g√∂re)
        const POPULAR_AUTHORS = [
            // T√ºrk yazarlar (en √ßok aranan)
            'Adam Fawer', 'Fawer', 'Adam',
            'Elif ≈ûafak', '≈ûafak', 'Elif',
            'Ahmet √úmit', '√úmit', 'Ahmet',
            'Orhan Pamuk', 'Pamuk', 'Orhan',
            'ƒ∞hsan Oktay Anar', 'Anar', 'ƒ∞hsan Oktay',
            'Z√ºlf√º Livaneli', 'Livaneli', 'Z√ºlf√º',
            'Hakan G√ºnday', 'G√ºnday', 'Hakan',
            'Oƒüuz Atay', 'Atay', 'Oƒüuz',
            'Ya≈üar Kemal', 'Kemal', 'Ya≈üar',
            'Sabahattin Ali', 'Ali', 'Sabahattin',
            'Re≈üat Nuri G√ºntekin', 'G√ºntekin', 'Re≈üat Nuri',
            'Halide Edib Adƒ±var', 'Adƒ±var', 'Halide Edib',
            'Tuna Kiremit√ßi', 'Kiremit√ßi', 'Tuna',
            '≈ûebnem ƒ∞≈üig√ºzel', 'ƒ∞≈üig√ºzel', '≈ûebnem',
            'K√ºr≈üat Ba≈üar', 'Ba≈üar', 'K√ºr≈üat',
            'Buket Uzuner', 'Uzuner', 'Buket',
            'Ay≈üe Kulin', 'Kulin', 'Ay≈üe',
            'Canan Tan', 'Tan', 'Canan',
            'Sinek Sekiz Yayƒ±nevi', 'Sinek Sekiz',
            'Nazan Bekiroƒülu', 'Bekiroƒülu', 'Nazan',
            'ƒ∞skender Pala', 'Pala', 'ƒ∞skender',
            'Murat Mente≈ü', 'Mente≈ü', 'Murat',
            'Barƒ±≈ü Bƒ±√ßak√ßƒ±', 'Bƒ±√ßak√ßƒ±', 'Barƒ±≈ü',
            'Burhan S√∂nmez', 'S√∂nmez', 'Burhan',
            '≈ûermin Ya≈üar', 'Ya≈üar', '≈ûermin',
            // Yabancƒ± yazarlar (T√ºrkiye'de pop√ºler)
            'J.R.R. Tolkien', 'Tolkien', 'J.R.R', 'JRR Tolkien',
            'J.K. Rowling', 'Rowling', 'J.K', 'JK Rowling',
            'Dostoyevski', 'Fyodor Dostoyevsky', 'Dostoyevsky', 'Fyodor',
            'Tolstoy', 'Leo Tolstoy', 'Lev Tolstoy',
            'George Orwell', 'Orwell', 'George',
            'Paulo Coelho', 'Coelho', 'Paulo',
            'Antoine de Saint-Exup√©ry', 'Saint-Exup√©ry', 'Exup√©ry', 'Saint Exup√©ry',
            'Gabriel Garc√≠a M√°rquez', 'M√°rquez', 'Garc√≠a M√°rquez',
            'Haruki Murakami', 'Murakami', 'Haruki',
            'Dan Brown', 'Brown', 'Dan',
            'Stephen King', 'King', 'Stephen',
            'Agatha Christie', 'Christie', 'Agatha',
            'Jane Austen', 'Austen', 'Jane',
            'Charles Dickens', 'Dickens', 'Charles',
            'Mark Twain', 'Twain', 'Mark',
            'Ernest Hemingway', 'Hemingway', 'Ernest',
            'Franz Kafka', 'Kafka', 'Franz',
            'Virginia Woolf', 'Woolf', 'Virginia',
            'Marcel Proust', 'Proust', 'Marcel',
            'F. Scott Fitzgerald', 'Fitzgerald', 'Scott Fitzgerald',
            'Aldous Huxley', 'Huxley', 'Aldous',
            'Ray Bradbury', 'Bradbury', 'Ray',
            'Isaac Asimov', 'Asimov', 'Isaac',
            'Jules Verne', 'Verne', 'Jules',
            'H.G. Wells', 'Wells', 'HG Wells',
            'Edgar Allan Poe', 'Poe', 'Edgar Allan',
            'Oscar Wilde', 'Wilde', 'Oscar',
            'Albert Camus', 'Camus', 'Albert',
            'Jean-Paul Sartre', 'Sartre', 'Jean Paul',
            'Milan Kundera', 'Kundera', 'Milan',
            'Umberto Eco', 'Eco', 'Umberto',
            'Italo Calvino', 'Calvino', 'Italo',
            'Isabel Allende', 'Allende', 'Isabel',
            'Mario Vargas Llosa', 'Vargas Llosa', 'Mario Vargas',
            'Jorge Luis Borges', 'Borges', 'Jorge Luis',
            'Gabriel Garcia Marquez', 'Garcia Marquez',
            'Chuck Palahniuk', 'Palahniuk', 'Chuck',
            'Kurt Vonnegut', 'Vonnegut', 'Kurt',
            'Raymond Carver', 'Carver', 'Raymond',
            'John Steinbeck', 'Steinbeck', 'John',
            'William Faulkner', 'Faulkner', 'William',
            'Tennessee Williams', 'Williams', 'Tennessee',
            'Arthur Conan Doyle', 'Conan Doyle', 'Arthur',
            'H.P. Lovecraft', 'Lovecraft', 'HP Lovecraft',
            'Bram Stoker', 'Stoker', 'Bram',
            'Mary Shelley', 'Shelley', 'Mary',
            'Charlotte Bront√´', 'Bront√´', 'Charlotte',
            'Emily Bront√´', 'Emily',
            'Anne Bront√´', 'Anne',
            'Victor Hugo', 'Hugo', 'Victor',
            'Alexandre Dumas', 'Dumas', 'Alexandre',
            'Gustave Flaubert', 'Flaubert', 'Gustave',
            '√âmile Zola', 'Zola', 'Emile',
            'Honor√© de Balzac', 'Balzac', 'Honore',
            'Stendhal', 'Marie-Henri Beyle',
            'Guy de Maupassant', 'Maupassant', 'Guy',
            'Anton Chekhov', 'Chekhov', 'Anton',
            'Ivan Turgenev', 'Turgenev', 'Ivan',
            'Nikolai Gogol', 'Gogol', 'Nikolai',
            'Aleksandr Pushkin', 'Pushkin', 'Aleksandr'
        ];

        // Yazar pop√ºlerlik kontrol√º
        function isAuthorPopular(author) {
            if (!author) return false;
            const authorLower = author.toLowerCase().trim();

            return POPULAR_AUTHORS.some(popAuthor => {
                const popAuthorLower = popAuthor.toLowerCase().trim();
                // Tam e≈üle≈üme
                if (authorLower === popAuthorLower) return true;
                // ƒ∞√ßerme kontrol√º
                if (authorLower.includes(popAuthorLower) || popAuthorLower.includes(authorLower)) return true;
                // Kelime bazlƒ± e≈üle≈üme
                const authorWords = authorLower.split(/\s+/);
                const popAuthorWords = popAuthorLower.split(/\s+/);
                return authorWords.some(word =>
                    popAuthorWords.some(popWord =>
                        word === popWord ||
                        word.includes(popWord) ||
                        popWord.includes(word) ||
                        (word.length >= 3 && popWord.length >= 3 && word.substring(0, 3) === popWord.substring(0, 3))
                    )
                );
            });
        }

        // Google Books pop√ºlerlik kriterleri (Google'da pop√ºler olan kitaplar)
        function isGooglePopular(book) {
            if (!book) return false;

            const rating = book.averageRating || 0;
            const ratingsCount = book.ratingsCount || 0;
            const popularityScore = book.popularityScore || 0;

            // Google Books'ta √ßok pop√ºler olan kitaplar i√ßin kriterler (daha esnek):
            // 1. √áok y√ºksek rating (4.3+) VE √ßok oy (50+) - iyi kitaplar
            // 2. VEYA √ßok oy (200+) - √ßok satan/okunan kitaplar (daha d√º≈ü√ºk e≈üik)
            // 3. VEYA y√ºksek pop√ºlerlik skoru (5+) - pop√ºler kitaplar (daha d√º≈ü√ºk e≈üik)
            // 4. VEYA √ßok y√ºksek rating (4.6+) - en pop√ºler kitaplar
            // 5. VEYA √ßok oy (500+) - √ßok pop√ºler kitaplar
            // 6. VEYA orta-y√ºksek rating (4.0+) VE orta oy (100+) - pop√ºler kitaplar

            const hasVeryHighRating = rating >= 4.3 && ratingsCount >= 50;
            const hasManyRatings = ratingsCount >= 200; // Daha d√º≈ü√ºk e≈üik
            const hasHighPopularityScore = popularityScore >= 5; // Daha d√º≈ü√ºk e≈üik
            const hasExtremeRating = rating >= 4.6;
            const hasExtremeRatingsCount = ratingsCount >= 500;
            const hasGoodRatingAndRatings = rating >= 4.0 && ratingsCount >= 100;

            return hasVeryHighRating || hasManyRatings || hasHighPopularityScore || hasExtremeRating || hasExtremeRatingsCount || hasGoodRatingAndRatings;
        }

        // Maƒüazalardaki pop√ºler kitaplarla e≈üle≈ütirme
        function matchWithPopularBooks(books) {
            if (!books || books.length === 0) return;

            let matchCount = 0;
            let googlePopularCount = 0;
            let authorPopularCount = 0;

            // Her kitap i√ßin pop√ºler kitaplar listesini kontrol et
            for (let book of books) {
                let isPopular = false;
                let matchedBook = null;
                let isGooglePop = false;
                let isAuthorPop = false;

                // 1. Pop√ºler kitaplar listesinde var mƒ±?
                for (let popularBook of POPULAR_BOOKS) {
                    if (isBookMatch(book, popularBook)) {
                        isPopular = true;
                        matchedBook = popularBook;
                        matchCount++;
                        console.log(`üî• Pop√ºler kitap e≈üle≈üti: "${book.title}" - ${book.author} (E≈üle≈üen: "${popularBook.title}" - ${popularBook.author})`);
                        break;
                    }
                }

                // 2. Google Books'ta pop√ºler mi? (√ßok y√ºksek rating, √ßok oy, y√ºksek pop√ºlerlik skoru)
                if (!isPopular) {
                    isGooglePop = isGooglePopular(book);
                    if (isGooglePop) {
                        isPopular = true;
                        googlePopularCount++;
                        console.log(`üî• Google'da pop√ºler: "${book.title}" - ${book.author} (Rating: ${book.averageRating || 0}, Oy: ${book.ratingsCount || 0}, Skor: ${book.popularityScore || 0})`);
                    }
                }

                // 3. Yazar Google'da pop√ºler mi? (en √ßok aranan yazarlar)
                if (!isPopular && book.author) {
                    isAuthorPop = isAuthorPopular(book.author);
                    if (isAuthorPop) {
                        isPopular = true;
                        authorPopularCount++;
                        console.log(`üî• Pop√ºler yazar: "${book.title}" - ${book.author}`);
                    }
                }

                book.isPopularInStores = isPopular;

                // Debug: E≈üle≈ümeyen kitaplarƒ± da g√∂ster (isteƒüe baƒülƒ±)
                if (!isPopular && book.title && book.title.toLowerCase().includes('empati')) {
                    console.log(`‚ö†Ô∏è Empati bulundu ama e≈üle≈ümedi: "${book.title}" - ${book.author} (Rating: ${book.averageRating || 0}, Oy: ${book.ratingsCount || 0})`);
                }
            }

            console.log(`üìä Pop√ºler kitaplar i≈üaretlendi: ${matchCount + googlePopularCount + authorPopularCount}/${books.length} kitap`);
            console.log(`   - Liste e≈üle≈ümesi: ${matchCount}`);
            console.log(`   - Google Books pop√ºler: ${googlePopularCount}`);
            console.log(`   - Pop√ºler yazar: ${authorPopularCount}`);

            // Eƒüer hi√ß pop√ºler kitap yoksa uyarƒ± ver
            if (matchCount === 0 && googlePopularCount === 0 && authorPopularCount === 0 && books.length > 0) {
                console.log('‚ö†Ô∏è Uyarƒ±: Hi√ß pop√ºler kitap e≈üle≈ümedi. Listede olmayan kitaplar olabilir.');
            }
        }

        // Birden fazla √ºcretsiz kaynaktan kitap kapaƒüƒ± g√∂rseli alma fonksiyonu
        function getBookCoverFromMultipleSources(isbn, isbn13, isbn10) {
            if (!isbn) return null;

            // Kullanƒ±lacak ISBN (√∂ncelik ISBN-13)
            const primaryIsbn = isbn13 || isbn10 || isbn;
            const secondaryIsbn = isbn13 && isbn10 ? isbn10 : null;

            // Birden fazla √ºcretsiz kaynak (fallback mekanizmasƒ±)
            // 1. Open Library (en g√ºvenilir ve √ºcretsiz)
            const openLibraryLarge = `https://covers.openlibrary.org/b/isbn/${primaryIsbn}-L.jpg`;
            const openLibraryMedium = `https://covers.openlibrary.org/b/isbn/${primaryIsbn}-M.jpg`;

            // 2. Google Books Cover API (ISBN ile direkt)
            const googleBooksCover = `https://books.google.com/books/content/images/frontcover/${primaryIsbn}?fife=w400-h600`;
            const googleBooksCoverAlt = `https://books.google.com/books/publisher/content/images/frontcover/${primaryIsbn}?fife=w400-h600`;

            // 3. Open Library alternatif formatlar
            const openLibrarySmall = `https://covers.openlibrary.org/b/isbn/${primaryIsbn}-S.jpg`;

            // 4. ISBN-10 varsa onu da dene
            const openLibraryIsbn10 = secondaryIsbn ? `https://covers.openlibrary.org/b/isbn/${secondaryIsbn}-L.jpg` : null;

            // ƒ∞lk kaynaƒüƒ± varsayƒ±lan olarak d√∂nd√ºr (en g√ºvenilir)
            // Ger√ßek kontrol client-side'da yapƒ±lacak (img onerror ile)
            return openLibraryLarge;
        }

        // Kitap kapaƒüƒ± g√∂rseli i√ßin fallback URL'leri olu≈ütur
        function getBookCoverFallbackUrls(isbn, isbn13, isbn10) {
            if (!isbn) return [];

            const primaryIsbn = isbn13 || isbn10 || isbn;
            const secondaryIsbn = isbn13 && isbn10 ? isbn10 : null;

            const fallbackUrls = [
                // Open Library (en g√ºvenilir)
                `https://covers.openlibrary.org/b/isbn/${primaryIsbn}-L.jpg`,
                `https://covers.openlibrary.org/b/isbn/${primaryIsbn}-M.jpg`,
                // Google Books Cover API
                `https://books.google.com/books/content/images/frontcover/${primaryIsbn}?fife=w400-h600`,
                `https://books.google.com/books/publisher/content/images/frontcover/${primaryIsbn}?fife=w400-h600`,
                // Open Library alternatif
                `https://covers.openlibrary.org/b/isbn/${primaryIsbn}-S.jpg`
            ];

            // ISBN-10 varsa onu da ekle
            if (secondaryIsbn) {
                fallbackUrls.push(`https://covers.openlibrary.org/b/isbn/${secondaryIsbn}-L.jpg`);
                fallbackUrls.push(`https://covers.openlibrary.org/b/isbn/${secondaryIsbn}-M.jpg`);
            }

            return fallbackUrls;
        }

        const MAX_RESULTS = 50;
        const FAVORITES_STORAGE_KEY = 'kitapFavorileri';
        const PRICES_STORAGE_KEY = 'kitapFiyatlari';
        const SEARCH_HISTORY_KEY = 'kitapAramaGecmisi';
        const THEME_STORAGE_KEY = 'kitapTemaTercihi';
        const curatedTestBooksLibrary = [
            {
                title: 'TYT Matematik Soru Bankasƒ± 2025',
                author: 'Akƒ±l Fikir Yayƒ±nlarƒ± Uzman Kadro',
                year: '2025',
                summary: 'Yeni nesil mantƒ±k sorularƒ±, konu √∂zetleri ve akƒ±llƒ± ipu√ßlarƒ±yla g√ºncel TYT matematik m√ºfredatƒ±nƒ± birebir takip eder.',
                thumbnail: 'https://dummyimage.com/320x480/1f2933/ffffff&text=TYT+MAT',
                isbn: '9786050000011',
                tags: ['tyt', 'matematik', 'soru bankasƒ±', 'yeni nesil'],
                examLevels: ['TYT'],
                publisher: 'Akƒ±l Fikir Yayƒ±nlarƒ±',
                averageRating: 4.9,
                ratingsCount: 1246
            },
            {
                title: 'AYT Fizik 30√ó40 Deneme Seti',
                author: 'Quantum Sƒ±nav At√∂lyesi',
                year: '2024',
                summary: 'MEB kazanƒ±mlarƒ±na g√∂re gruplandƒ±rƒ±lmƒ±≈ü 30 fasik√ºl ve 40 √∂zg√ºn denemeden olu≈üur, video √ß√∂z√ºm QR kodlarƒ± i√ßerir.',
                thumbnail: 'https://dummyimage.com/320x480/143041/ffffff&text=AYT+FIZIK',
                isbn: '9786050000028',
                tags: ['ayt', 'fizik', 'deneme', 'video √ß√∂z√ºml√º'],
                examLevels: ['AYT', 'YKS'],
                publisher: 'Quantum',
                averageRating: 4.8,
                ratingsCount: 987
            },
            {
                title: 'YKS Paragraf Kampƒ± 8 Haftada',
                author: 'Dilhan Yayƒ±ncƒ±lƒ±k Edit√∂r Kurulu',
                year: '2025',
                summary: 'Paragraf hƒ±zƒ±nƒ± artƒ±ran 56 g√ºnl√ºk kamp programƒ±, g√ºnl√ºk takip √ßizelgesi ve metin √ß√∂z√ºm teknikleriyle desteklenir.',
                thumbnail: 'https://dummyimage.com/320x480/1b3a4b/ffffff&text=PARAGRAF',
                isbn: '9786050000035',
                tags: ['tyt', 'yks', 'paragraf', 'kamp programƒ±'],
                examLevels: ['TYT', 'KPSS'],
                publisher: 'Dilhan Yayƒ±ncƒ±lƒ±k',
                averageRating: 4.7,
                ratingsCount: 1632
            },
            {
                title: 'TYT-AYT Kimya Konu Anlatƒ±mlƒ±',
                author: 'LabPlus Akademi',
                year: '2025',
                summary: 'Temel kavramlardan ileri organik kimyaya kadar t√ºm √ºniteler infografik destekli anlatƒ±mla peki≈ütirilir.',
                thumbnail: 'https://dummyimage.com/320x480/0f2f3d/ffffff&text=KIMYA',
                isbn: '9786050000042',
                tags: ['tyt', 'ayt', 'kimya', 'konu anlatƒ±mƒ±'],
                examLevels: ['TYT', 'AYT'],
                publisher: 'LabPlus',
                averageRating: 4.85,
                ratingsCount: 754
            },
            {
                title: 'KPSS Eƒüitim Bilimleri Tamamƒ± √á√∂z√ºml√º',
                author: 'Uzman Kariyer Akademi',
                year: '2024',
                summary: '√ñƒüretim y√∂ntemleri, √∂l√ßme ve deƒüerlendirme, geli≈üim psikolojisi konularƒ±nda tamamƒ± √ß√∂z√ºml√º 1200 soru i√ßerir.',
                thumbnail: 'https://dummyimage.com/320x480/292524/ffffff&text=KPSS+EB',
                isbn: '9786050000059',
                tags: ['kpss', 'eƒüitim bilimleri', 'tamamƒ± √ß√∂z√ºml√º'],
                examLevels: ['KPSS'],
                publisher: 'Uzman Kariyer',
                averageRating: 4.6,
                ratingsCount: 543
            },
            {
                title: 'MS√ú Matematik Hƒ±zlƒ± Tekrar F√∂yleri',
                author: 'Savunma Akademi',
                year: '2025',
                summary: 'MS√ú formatƒ±na uygun, 12 mod√ºlden olu≈üan tekrar f√∂yleri ve pratik hƒ±z tablolarƒ± i√ßerir.',
                thumbnail: 'https://dummyimage.com/320x480/1c2e3f/ffffff&text=MSU+MAT',
                isbn: '9786050000066',
                tags: ['ms√º', 'matematik', 'f√∂y', 'tekrar'],
                examLevels: ['MS√ú', 'TYT'],
                publisher: 'Savunma Akademi',
                averageRating: 4.75,
                ratingsCount: 412
            },
            {
                title: 'TYT Fen Bilimleri Masterclass',
                author: 'Astera Eƒüitim Platformu',
                year: '2025',
                summary: 'Biyoloji, fizik ve kimya konularƒ±nƒ± tek kitapta toplayan, QR kodlu dijital laboratuvar etkinlikleri i√ßerir.',
                thumbnail: 'https://dummyimage.com/320x480/102a43/ffffff&text=FEN',
                isbn: '9786050000073',
                tags: ['tyt', 'fen', 'masterclass', 'video destekli'],
                examLevels: ['TYT'],
                publisher: 'Astera',
                averageRating: 4.85,
                ratingsCount: 628
            },
            {
                title: 'TYT T√ºrk√ße Paragraf Soru Bankasƒ±',
                author: 'Kelime Kul√ºb√º',
                year: '2025',
                summary: 'Zorluk seviyesine g√∂re renklendirilmi≈ü paragraflar ve hƒ±z √∂l√ßer sayfalarla s√ºre y√∂netimini geli≈ütirir.',
                thumbnail: 'https://dummyimage.com/320x480/2a3d45/ffffff&text=TURKCE',
                isbn: '9786050000080',
                tags: ['tyt', 't√ºrk√ße', 'paragraf', 'soru bankasƒ±'],
                examLevels: ['TYT'],
                publisher: 'Kelime Kul√ºb√º',
                averageRating: 4.9,
                ratingsCount: 2014
            },
            // ===== POP√úLER TEST Kƒ∞TABI YAYINEVLERƒ∞ =====
            {
                title: 'TYT Matematik Soru Bankasƒ±',
                author: 'Tongu√ß Akademi',
                year: '2025',
                summary: 'Adƒ±m adƒ±m konu anlatƒ±mƒ± ve bolca soru √ß√∂z√ºm√º ile TYT matematiƒüe hazƒ±rlƒ±k.',
                thumbnail: 'https://dummyimage.com/320x480/e74c3c/ffffff&text=TONGUC',
                isbn: '9786050100001',
                tags: ['tyt', 'matematik', 'soru bankasƒ±', 'tongu√ß'],
                examLevels: ['TYT'],
                publisher: 'Tongu√ß Akademi',
                averageRating: 4.9,
                ratingsCount: 5420
            },
            {
                title: 'AYT Fizik Konu Anlatƒ±mlƒ±',
                author: 'Palme Yayƒ±nevi',
                year: '2025',
                summary: 'Detaylƒ± konu anlatƒ±mƒ± ve √∂rnek sorularla AYT fiziƒüe kapsamlƒ± hazƒ±rlƒ±k.',
                thumbnail: 'https://dummyimage.com/320x480/27ae60/ffffff&text=PALME',
                isbn: '9786050100002',
                tags: ['ayt', 'fizik', 'konu anlatƒ±mlƒ±'],
                examLevels: ['AYT'],
                publisher: 'Palme Yayƒ±nlarƒ±',
                averageRating: 4.8,
                ratingsCount: 3210
            },
            {
                title: 'TYT-AYT Geometri Soru Bankasƒ±',
                author: 'Limit Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'Temel geometriden analitik geometriye t√ºm konularƒ± kapsayan soru bankasƒ±.',
                thumbnail: 'https://dummyimage.com/320x480/3498db/ffffff&text=LIMIT',
                isbn: '9786050100003',
                tags: ['tyt', 'ayt', 'geometri', 'soru bankasƒ±'],
                examLevels: ['TYT', 'AYT'],
                publisher: 'Limit Yayƒ±nlarƒ±',
                averageRating: 4.85,
                ratingsCount: 2890
            },
            {
                title: 'TYT T√ºrk√ße Soru Bankasƒ±',
                author: '3D Yayƒ±nlarƒ±',
                year: '2025',
                summary: '3 boyutlu √∂ƒürenme sistemiyle T√ºrk√ße dersine farklƒ± bir bakƒ±≈ü a√ßƒ±sƒ±.',
                thumbnail: 'https://dummyimage.com/320x480/9b59b6/ffffff&text=3D',
                isbn: '9786050100004',
                tags: ['tyt', 't√ºrk√ße', 'soru bankasƒ±'],
                examLevels: ['TYT'],
                publisher: '3D Yayƒ±nlarƒ±',
                averageRating: 4.7,
                ratingsCount: 2150
            },
            {
                title: 'TYT Matematik Video √á√∂z√ºml√º',
                author: 'Benim Hocam Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'QR kodlu video √ß√∂z√ºmlerle desteklenen interaktif soru bankasƒ±.',
                thumbnail: 'https://dummyimage.com/320x480/e67e22/ffffff&text=BENIM+HOCAM',
                isbn: '9786050100005',
                tags: ['tyt', 'matematik', 'video √ß√∂z√ºml√º'],
                examLevels: ['TYT'],
                publisher: 'Benim Hocam Yayƒ±nlarƒ±',
                averageRating: 4.9,
                ratingsCount: 4560
            },
            {
                title: 'AYT Matematik Soru Bankasƒ±',
                author: 'Karek√∂k Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'ƒ∞leri d√ºzey matematik konularƒ±nƒ± kapsayan kapsamlƒ± soru bankasƒ±.',
                thumbnail: 'https://dummyimage.com/320x480/1abc9c/ffffff&text=KAREKOK',
                isbn: '9786050100006',
                tags: ['ayt', 'matematik', 'soru bankasƒ±'],
                examLevels: ['AYT'],
                publisher: 'Karek√∂k Yayƒ±nlarƒ±',
                averageRating: 4.8,
                ratingsCount: 3780
            },
            {
                title: 'TYT Fen Bilimleri Soru Bankasƒ±',
                author: 'FDD Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'Fizik, kimya ve biyoloji konularƒ±nƒ± bir arada sunan kapsamlƒ± kaynak.',
                thumbnail: 'https://dummyimage.com/320x480/2c3e50/ffffff&text=FDD',
                isbn: '9786050100007',
                tags: ['tyt', 'fen', 'soru bankasƒ±'],
                examLevels: ['TYT'],
                publisher: 'FDD Yayƒ±nlarƒ±',
                averageRating: 4.75,
                ratingsCount: 1980
            },
            {
                title: 'LGS Matematik Soru Bankasƒ±',
                author: 'Bilfen Yayƒ±ncƒ±lƒ±k',
                year: '2025',
                summary: 'LGS sƒ±navƒ±na √∂zel hazƒ±rlanmƒ±≈ü matematik soru bankasƒ±.',
                thumbnail: 'https://dummyimage.com/320x480/16a085/ffffff&text=BILFEN',
                isbn: '9786050100008',
                tags: ['lgs', 'matematik', 'soru bankasƒ±'],
                examLevels: ['LGS'],
                publisher: 'Bilfen Yayƒ±ncƒ±lƒ±k',
                averageRating: 4.8,
                ratingsCount: 2340
            },
            {
                title: 'KPSS Genel Yetenek Soru Bankasƒ±',
                author: 'Yargƒ± Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'KPSS genel yetenek testine kapsamlƒ± hazƒ±rlƒ±k.',
                thumbnail: 'https://dummyimage.com/320x480/c0392b/ffffff&text=YARGI',
                isbn: '9786050100009',
                tags: ['kpss', 'genel yetenek', 'soru bankasƒ±'],
                examLevels: ['KPSS'],
                publisher: 'Yargƒ± Yayƒ±nlarƒ±',
                averageRating: 4.85,
                ratingsCount: 4120
            },
            {
                title: 'KPSS Eƒüitim Bilimleri',
                author: 'Pegem Akademi',
                year: '2025',
                summary: '√ñƒüretmenlik sƒ±navlarƒ±na kapsamlƒ± hazƒ±rlƒ±k kaynaƒüƒ±.',
                thumbnail: 'https://dummyimage.com/320x480/8e44ad/ffffff&text=PEGEM',
                isbn: '9786050100010',
                tags: ['kpss', 'eƒüitim bilimleri', '√∂ƒüretmenlik'],
                examLevels: ['KPSS'],
                publisher: 'Pegem Akademi',
                averageRating: 4.9,
                ratingsCount: 3560
            },
            {
                title: 'TYT Matematik F√∂y Seti',
                author: 'Hƒ±z ve Renk Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'Renkli ve hƒ±zlƒ± √∂ƒürenme i√ßin tasarlanmƒ±≈ü f√∂y seti.',
                thumbnail: 'https://dummyimage.com/320x480/f39c12/ffffff&text=HIZ+RENK',
                isbn: '9786050100011',
                tags: ['tyt', 'matematik', 'f√∂y'],
                examLevels: ['TYT'],
                publisher: 'Hƒ±z ve Renk Yayƒ±nlarƒ±',
                averageRating: 4.7,
                ratingsCount: 1890
            },
            {
                title: 'LGS T√ºm Dersler Soru Bankasƒ±',
                author: 'Okyanus Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'LGS sƒ±navƒ±na t√ºm derslerden kapsamlƒ± hazƒ±rlƒ±k.',
                thumbnail: 'https://dummyimage.com/320x480/0984e3/ffffff&text=OKYANUS',
                isbn: '9786050100012',
                tags: ['lgs', 't√ºm dersler', 'soru bankasƒ±'],
                examLevels: ['LGS'],
                publisher: 'Okyanus Yayƒ±nlarƒ±',
                averageRating: 4.8,
                ratingsCount: 2670
            },
            {
                title: 'AYT Kimya Soru Bankasƒ±',
                author: '√áap Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'AYT kimya konularƒ±nƒ± kapsayan detaylƒ± soru bankasƒ±.',
                thumbnail: 'https://dummyimage.com/320x480/6c5ce7/ffffff&text=CAP',
                isbn: '9786050100013',
                tags: ['ayt', 'kimya', 'soru bankasƒ±'],
                examLevels: ['AYT'],
                publisher: '√áap Yayƒ±nlarƒ±',
                averageRating: 4.75,
                ratingsCount: 1650
            },
            {
                title: 'TYT-AYT Geometri',
                author: 'Apotemi Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'Geometri konularƒ±nda uzmanla≈ümƒ±≈ü kapsamlƒ± kaynak.',
                thumbnail: 'https://dummyimage.com/320x480/00b894/ffffff&text=APOTEMI',
                isbn: '9786050100014',
                tags: ['tyt', 'ayt', 'geometri'],
                examLevels: ['TYT', 'AYT'],
                publisher: 'Apotemi Yayƒ±nlarƒ±',
                averageRating: 4.85,
                ratingsCount: 2340
            },
            {
                title: 'TYT Biyoloji Soru Bankasƒ±',
                author: 'Bilgi Sarmal Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'TYT biyoloji konularƒ±nƒ± kapsayan soru bankasƒ±.',
                thumbnail: 'https://dummyimage.com/320x480/00cec9/ffffff&text=BILGI+SARMAL',
                isbn: '9786050100015',
                tags: ['tyt', 'biyoloji', 'soru bankasƒ±'],
                examLevels: ['TYT'],
                publisher: 'Bilgi Sarmal Yayƒ±nlarƒ±',
                averageRating: 4.7,
                ratingsCount: 1420
            },
            {
                title: 'TYT Matematik Antrenman',
                author: 'Antrenman Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'Matematik problemlerini √ß√∂zmek i√ßin sistematik antrenman programƒ±.',
                thumbnail: 'https://dummyimage.com/320x480/fd79a8/ffffff&text=ANTRENMAN',
                isbn: '9786050100016',
                tags: ['tyt', 'matematik', 'antrenman'],
                examLevels: ['TYT'],
                publisher: 'Antrenman Yayƒ±nlarƒ±',
                averageRating: 4.9,
                ratingsCount: 5890
            },
            {
                title: 'TYT-AYT Fizik Soru Bankasƒ±',
                author: 'Esen Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'Fizik konularƒ±nda kapsamlƒ± soru bankasƒ±.',
                thumbnail: 'https://dummyimage.com/320x480/a29bfe/ffffff&text=ESEN',
                isbn: '9786050100017',
                tags: ['tyt', 'ayt', 'fizik', 'soru bankasƒ±'],
                examLevels: ['TYT', 'AYT'],
                publisher: 'Esen Yayƒ±nlarƒ±',
                averageRating: 4.75,
                ratingsCount: 1780
            },
            {
                title: 'TYT T√ºrk√ße Deneme',
                author: 'A√ßƒ± Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'TYT T√ºrk√ße denemelerle sƒ±nav pratiƒüi.',
                thumbnail: 'https://dummyimage.com/320x480/fdcb6e/333333&text=ACI',
                isbn: '9786050100018',
                tags: ['tyt', 't√ºrk√ße', 'deneme'],
                examLevels: ['TYT'],
                publisher: 'A√ßƒ± Yayƒ±nlarƒ±',
                averageRating: 4.7,
                ratingsCount: 1340
            },
            {
                title: 'TYT 345 Matematik',
                author: '√ú√ß D√∂rt Be≈ü Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'Adƒ±m adƒ±m seviye artƒ±≈üƒ±yla matematik √∂ƒürenimi.',
                thumbnail: 'https://dummyimage.com/320x480/74b9ff/333333&text=345',
                isbn: '9786050100019',
                tags: ['tyt', 'matematik', 'seviyeli'],
                examLevels: ['TYT'],
                publisher: '√ú√ß D√∂rt Be≈ü Yayƒ±nlarƒ±',
                averageRating: 4.8,
                ratingsCount: 2980
            },
            {
                title: 'LGS Fen Bilimleri',
                author: 'Delta K√ºlt√ºr Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'LGS fen bilimleri konularƒ±na hazƒ±rlƒ±k.',
                thumbnail: 'https://dummyimage.com/320x480/55efc4/333333&text=DELTA',
                isbn: '9786050100020',
                tags: ['lgs', 'fen', 'soru bankasƒ±'],
                examLevels: ['LGS'],
                publisher: 'Delta K√ºlt√ºr Yayƒ±nlarƒ±',
                averageRating: 4.7,
                ratingsCount: 1560
            },
            {
                title: 'TYT Coƒürafya Soru Bankasƒ±',
                author: 'K√ºlt√ºr Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'TYT coƒürafya konularƒ±nƒ± kapsayan kapsamlƒ± kaynak.',
                thumbnail: 'https://dummyimage.com/320x480/81ecec/333333&text=KULTUR',
                isbn: '9786050100021',
                tags: ['tyt', 'coƒürafya', 'soru bankasƒ±'],
                examLevels: ['TYT'],
                publisher: 'K√ºlt√ºr Yayƒ±nlarƒ±',
                averageRating: 4.75,
                ratingsCount: 1230
            },
            {
                title: 'AYT Edebiyat Soru Bankasƒ±',
                author: 'Birey Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'AYT T√ºrk dili ve edebiyatƒ± konularƒ±na hazƒ±rlƒ±k.',
                thumbnail: 'https://dummyimage.com/320x480/fab1a0/333333&text=BIREY',
                isbn: '9786050100022',
                tags: ['ayt', 'edebiyat', 'soru bankasƒ±'],
                examLevels: ['AYT'],
                publisher: 'Birey Yayƒ±nlarƒ±',
                averageRating: 4.7,
                ratingsCount: 1890
            },
            {
                title: 'TYT Tarih Soru Bankasƒ±',
                author: 'Final Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'TYT tarih konularƒ±nƒ± kapsayan soru bankasƒ±.',
                thumbnail: 'https://dummyimage.com/320x480/ffeaa7/333333&text=FINAL',
                isbn: '9786050100023',
                tags: ['tyt', 'tarih', 'soru bankasƒ±'],
                examLevels: ['TYT'],
                publisher: 'Final Yayƒ±nlarƒ±',
                averageRating: 4.75,
                ratingsCount: 1670
            },
            {
                title: 'KPSS Vatanda≈ülƒ±k',
                author: 'ƒ∞sem Yayƒ±ncƒ±lƒ±k',
                year: '2025',
                summary: 'KPSS vatanda≈ülƒ±k konularƒ±na kapsamlƒ± hazƒ±rlƒ±k.',
                thumbnail: 'https://dummyimage.com/320x480/dfe6e9/333333&text=ISEM',
                isbn: '9786050100024',
                tags: ['kpss', 'vatanda≈ülƒ±k', 'soru bankasƒ±'],
                examLevels: ['KPSS'],
                publisher: 'ƒ∞sem Yayƒ±ncƒ±lƒ±k',
                averageRating: 4.8,
                ratingsCount: 2340
            },
            {
                title: 'ALES Sayƒ±sal Soru Bankasƒ±',
                author: 'Yediiklim Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'ALES sayƒ±sal b√∂l√ºm hazƒ±rlƒ±ƒüƒ± i√ßin kapsamlƒ± kaynak.',
                thumbnail: 'https://dummyimage.com/320x480/b2bec3/333333&text=YEDIIKLIM',
                isbn: '9786050100025',
                tags: ['ales', 'sayƒ±sal', 'soru bankasƒ±'],
                examLevels: ['ALES'],
                publisher: 'Yediiklim Yayƒ±nlarƒ±',
                averageRating: 4.8,
                ratingsCount: 1980
            },
            {
                title: 'LGS ƒ∞ngilizce Soru Bankasƒ±',
                author: 'Nitelik Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'LGS ƒ∞ngilizce sƒ±navƒ±na hazƒ±rlƒ±k.',
                thumbnail: 'https://dummyimage.com/320x480/636e72/ffffff&text=NITELIK',
                isbn: '9786050100026',
                tags: ['lgs', 'ingilizce', 'soru bankasƒ±'],
                examLevels: ['LGS'],
                publisher: 'Nitelik Yayƒ±nlarƒ±',
                averageRating: 4.7,
                ratingsCount: 1120
            },
            {
                title: 'TYT Fen Bilimleri',
                author: 'Fen Bilimleri Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'TYT fen bilimleri konularƒ±nda uzman kaynak.',
                thumbnail: 'https://dummyimage.com/320x480/2d3436/ffffff&text=FEN+BIL',
                isbn: '9786050100027',
                tags: ['tyt', 'fen', 'soru bankasƒ±'],
                examLevels: ['TYT'],
                publisher: 'Fen Bilimleri Yayƒ±nlarƒ±',
                averageRating: 4.8,
                ratingsCount: 2560
            },
            {
                title: 'AYT Biyoloji Soru Bankasƒ±',
                author: 'Endemik Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'AYT biyoloji konularƒ±nda detaylƒ± soru bankasƒ±.',
                thumbnail: 'https://dummyimage.com/320x480/00b894/ffffff&text=ENDEMIK',
                isbn: '9786050100028',
                tags: ['ayt', 'biyoloji', 'soru bankasƒ±'],
                examLevels: ['AYT'],
                publisher: 'Endemik Yayƒ±nlarƒ±',
                averageRating: 4.85,
                ratingsCount: 1780
            },
            {
                title: 'TYT Matematik Problemler',
                author: 'Miray Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'Problem √ß√∂zme becerisini geli≈ütiren kaynak.',
                thumbnail: 'https://dummyimage.com/320x480/e17055/ffffff&text=MIRAY',
                isbn: '9786050100029',
                tags: ['tyt', 'matematik', 'problem'],
                examLevels: ['TYT'],
                publisher: 'Miray Yayƒ±nlarƒ±',
                averageRating: 4.75,
                ratingsCount: 1340
            },
            {
                title: 'TYT Deneme Seti',
                author: 'Acil Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'TYT sƒ±navƒ±na hazƒ±rlƒ±k i√ßin deneme seti.',
                thumbnail: 'https://dummyimage.com/320x480/d63031/ffffff&text=ACIL',
                isbn: '9786050100030',
                tags: ['tyt', 'deneme', 'sƒ±nav'],
                examLevels: ['TYT'],
                publisher: 'Acil Yayƒ±nlarƒ±',
                averageRating: 4.7,
                ratingsCount: 1560
            },
            {
                title: 'LGS Deneme Sƒ±navlarƒ±',
                author: 'Gezegen Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'LGS formatƒ±nda deneme sƒ±navlarƒ±.',
                thumbnail: 'https://dummyimage.com/320x480/0652DD/ffffff&text=GEZEGEN',
                isbn: '9786050100031',
                tags: ['lgs', 'deneme', 'sƒ±nav'],
                examLevels: ['LGS'],
                publisher: 'Gezegen Yayƒ±nlarƒ±',
                averageRating: 4.8,
                ratingsCount: 1890
            },
            {
                title: 'TYT Sosyal Bilimler',
                author: '√ñrnek Akademi',
                year: '2025',
                summary: 'TYT sosyal bilimler konularƒ±na hazƒ±rlƒ±k.',
                thumbnail: 'https://dummyimage.com/320x480/1289A7/ffffff&text=ORNEK',
                isbn: '9786050100032',
                tags: ['tyt', 'sosyal', 'soru bankasƒ±'],
                examLevels: ['TYT'],
                publisher: '√ñrnek Akademi',
                averageRating: 4.7,
                ratingsCount: 1230
            },
            {
                title: 'TYT T√ºrk√ße',
                author: 'Aydƒ±n Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'TYT T√ºrk√ße soru bankasƒ±.',
                thumbnail: 'https://dummyimage.com/320x480/5758BB/ffffff&text=AYDIN',
                isbn: '9786050100033',
                tags: ['tyt', 't√ºrk√ße', 'soru bankasƒ±'],
                examLevels: ['TYT'],
                publisher: 'Aydƒ±n Yayƒ±nlarƒ±',
                averageRating: 4.75,
                ratingsCount: 1450
            },
            {
                title: 'LGS Matematik',
                author: 'Test Okul Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'LGS matematik konularƒ±na hazƒ±rlƒ±k.',
                thumbnail: 'https://dummyimage.com/320x480/EE5A24/ffffff&text=TEST+OKUL',
                isbn: '9786050100034',
                tags: ['lgs', 'matematik', 'soru bankasƒ±'],
                examLevels: ['LGS'],
                publisher: 'Test Okul Yayƒ±nlarƒ±',
                averageRating: 4.7,
                ratingsCount: 980
            },
            {
                title: 'DGS Sayƒ±sal Soru Bankasƒ±',
                author: 'Kariyer Meslek Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'DGS sƒ±navƒ±na sayƒ±sal hazƒ±rlƒ±k.',
                thumbnail: 'https://dummyimage.com/320x480/A3CB38/333333&text=KARIYER',
                isbn: '9786050100035',
                tags: ['dgs', 'sayƒ±sal', 'soru bankasƒ±'],
                examLevels: ['DGS'],
                publisher: 'Kariyer Meslek Yayƒ±nlarƒ±',
                averageRating: 4.75,
                ratingsCount: 1670
            },
            {
                title: 'YDS ƒ∞ngilizce',
                author: 'Yargƒ± Akademi',
                year: '2025',
                summary: 'YDS sƒ±navƒ±na kapsamlƒ± ƒ∞ngilizce hazƒ±rlƒ±k.',
                thumbnail: 'https://dummyimage.com/320x480/F79F1F/333333&text=YARGI+AK',
                isbn: '9786050100036',
                tags: ['yds', 'ingilizce', 'soru bankasƒ±'],
                examLevels: ['YDS'],
                publisher: 'Yargƒ± Akademi',
                averageRating: 4.8,
                ratingsCount: 2120
            },
            {
                title: 'AYT Felsefe Soru Bankasƒ±',
                author: 'Hocalara Geldik',
                year: '2025',
                summary: 'AYT felsefe konularƒ±na kapsamlƒ± hazƒ±rlƒ±k.',
                thumbnail: 'https://dummyimage.com/320x480/9980FA/ffffff&text=HG',
                isbn: '9786050100037',
                tags: ['ayt', 'felsefe', 'soru bankasƒ±'],
                examLevels: ['AYT'],
                publisher: 'Hocalara Geldik',
                averageRating: 4.85,
                ratingsCount: 1890
            },
            {
                title: 'TYT Problemler',
                author: 'Kƒ±rmƒ±zƒ± Beyaz Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'TYT matematik problemleri i√ßin √∂zel hazƒ±rlanmƒ±≈ü kaynak.',
                thumbnail: 'https://dummyimage.com/320x480/EA2027/ffffff&text=KIRMIZI',
                isbn: '9786050100038',
                tags: ['tyt', 'matematik', 'problem'],
                examLevels: ['TYT'],
                publisher: 'Kƒ±rmƒ±zƒ± Beyaz Yayƒ±nlarƒ±',
                averageRating: 4.7,
                ratingsCount: 1230
            },
            {
                title: 'AYT Matematik',
                author: 'Bilgik√ºp√º Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'AYT matematik konularƒ±nda detaylƒ± kaynak.',
                thumbnail: 'https://dummyimage.com/320x480/006266/ffffff&text=BILGI',
                isbn: '9786050100039',
                tags: ['ayt', 'matematik', 'soru bankasƒ±'],
                examLevels: ['AYT'],
                publisher: 'Bilgik√ºp√º Yayƒ±nlarƒ±',
                averageRating: 4.75,
                ratingsCount: 1120
            },
            {
                title: 'TYT Din K√ºlt√ºr√º',
                author: 'Rty Rota Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'TYT din k√ºlt√ºr√º ve ahlak bilgisi hazƒ±rlƒ±ƒüƒ±.',
                thumbnail: 'https://dummyimage.com/320x480/833471/ffffff&text=RTY',
                isbn: '9786050100040',
                tags: ['tyt', 'din k√ºlt√ºr√º', 'soru bankasƒ±'],
                examLevels: ['TYT'],
                publisher: 'Rty Rota Yayƒ±nlarƒ±',
                averageRating: 4.7,
                ratingsCount: 890
            },
            {
                title: 'LGS T√ºrk√ße',
                author: 'Berkay Yayƒ±ncƒ±lƒ±k',
                year: '2025',
                summary: 'LGS T√ºrk√ße sƒ±navƒ±na hazƒ±rlƒ±k.',
                thumbnail: 'https://dummyimage.com/320x480/6F1E51/ffffff&text=BERKAY',
                isbn: '9786050100041',
                tags: ['lgs', 't√ºrk√ße', 'soru bankasƒ±'],
                examLevels: ['LGS'],
                publisher: 'Berkay Yayƒ±ncƒ±lƒ±k',
                averageRating: 4.7,
                ratingsCount: 980
            },
            {
                title: 'TYT Kimya Soru Bankasƒ±',
                author: 'Puan Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'TYT kimya konularƒ±na detaylƒ± hazƒ±rlƒ±k.',
                thumbnail: 'https://dummyimage.com/320x480/B53471/ffffff&text=PUAN',
                isbn: '9786050100042',
                tags: ['tyt', 'kimya', 'soru bankasƒ±'],
                examLevels: ['TYT'],
                publisher: 'Puan Yayƒ±nlarƒ±',
                averageRating: 4.75,
                ratingsCount: 1340
            },
            {
                title: 'AYT Fizik Deneme',
                author: 'Orbital Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'AYT fizik denemeleri.',
                thumbnail: 'https://dummyimage.com/320x480/1B1464/ffffff&text=ORBITAL',
                isbn: '9786050100043',
                tags: ['ayt', 'fizik', 'deneme'],
                examLevels: ['AYT'],
                publisher: 'Orbital Yayƒ±nlarƒ±',
                averageRating: 4.8,
                ratingsCount: 1120
            },
            {
                title: 'TYT Coƒürafya',
                author: 'S√ºper Kitap Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'TYT coƒürafya hazƒ±rlƒ±ƒüƒ±.',
                thumbnail: 'https://dummyimage.com/320x480/182C61/ffffff&text=SUPER',
                isbn: '9786050100044',
                tags: ['tyt', 'coƒürafya', 'soru bankasƒ±'],
                examLevels: ['TYT'],
                publisher: 'S√ºper Kitap Yayƒ±nlarƒ±',
                averageRating: 4.7,
                ratingsCount: 870
            },
            {
                title: 'LGS ƒ∞nkƒ±lap Tarihi',
                author: 'Mozaik Yayƒ±nlarƒ±',
                year: '2025',
                summary: 'LGS T.C. inkƒ±lap tarihi ve Atat√ºrk√ß√ºl√ºk hazƒ±rlƒ±ƒüƒ±.',
                thumbnail: 'https://dummyimage.com/320x480/3B3B98/ffffff&text=MOZAIK',
                isbn: '9786050100045',
                tags: ['lgs', 'inkƒ±lap tarihi', 'soru bankasƒ±'],
                examLevels: ['LGS'],
                publisher: 'Mozaik Yayƒ±nlarƒ±',
                averageRating: 4.75,
                ratingsCount: 760
            }
        ];

        // Ke≈üfet / √ñnerilen Kitaplar (statik i√ßerik)
        const DISCOVER_BOOKS = [
            {
                title: "1984",
                author: "George Orwell",
                year: "1949",
                summary: "Distopik bir d√ºnyada totaliter rejimi anlatan klasik roman.",
                source: "√ñnerilen",
                thumbnail: null,
                isbn: null
            },
            {
                title: "K√ºrk Mantolu Madonna",
                author: "Sabahattin Ali",
                year: "1943",
                summary: "Raif Efendi'nin derin i√ß d√ºnyasƒ±nƒ± ve a≈ükƒ±nƒ± anlatan roman.",
                source: "√ñnerilen",
                thumbnail: null,
                isbn: null
            },
            {
                title: "Tutunamayanlar",
                author: "Oƒüuz Atay",
                year: "1971",
                summary: "T√ºrk edebiyatƒ±nƒ±n en √∂nemli postmodern romanlarƒ±ndan biri.",
                source: "√ñnerilen",
                thumbnail: null,
                isbn: null
            },
            {
                title: "ƒ∞nce Memed",
                author: "Ya≈üar Kemal",
                year: "1955",
                summary: "√áukurova'da e≈ükƒ±ya olan ƒ∞nce Memed'in hikayesi.",
                source: "√ñnerilen",
                thumbnail: null,
                isbn: null
            },
            {
                title: "Simyacƒ±",
                author: "Paulo Coelho",
                year: "1988",
                summary: "Ki≈üisel efsanesini arayan bir √ßobanƒ±n yolculuƒüu.",
                source: "√ñnerilen",
                thumbnail: null,
                isbn: null
            },
            {
                title: "K√º√ß√ºk Prens",
                author: "Antoine de Saint-Exup√©ry",
                year: "1943",
                summary: "√áocuklar ve yeti≈ükinler i√ßin yazƒ±lmƒ±≈ü felsefi bir masal.",
                source: "√ñnerilen",
                thumbnail: null,
                isbn: null
            },
            {
                title: "Su√ß ve Ceza",
                author: "Fyodor Dostoyevsky",
                year: "1866",
                summary: "Raskolnikov'un i≈ülediƒüi cinayet ve sonrasƒ±ndaki vicdan azabƒ±.",
                source: "√ñnerilen",
                thumbnail: null,
                isbn: null
            },
            {
                title: "Y√ºz√ºklerin Efendisi",
                author: "J.R.R. Tolkien",
                year: "1954",
                summary: "Orta D√ºnya'da ge√ßen epik fantastik macera.",
                source: "√ñnerilen",
                thumbnail: null,
                isbn: null
            }
        ];

        let currentBooks = []; // Mevcut arama sonu√ßlarƒ±nƒ± sakla
        let currentOrderBy = 'relevance'; // Sƒ±ralama se√ßeneƒüi
        
        // T√ºm k√ºt√ºphane kitaplarƒ±nƒ± birle≈ütir (curatedTestBooksLibrary + DISCOVER_BOOKS)
        const FULL_LIBRARY = [...curatedTestBooksLibrary, ...DISCOVER_BOOKS];

        // Tema y√∂netimi
        function getThemePreference() {
            return localStorage.getItem(THEME_STORAGE_KEY) || 'auto'; // 'auto', 'dark', 'light'
        }

        function saveThemePreference(theme) {
            localStorage.setItem(THEME_STORAGE_KEY, theme);
        }

        function setQuoteAuthorColor(color) {
            document.documentElement.style.setProperty('--quote-author-color', color || '#1f2a37');
        }

        function applyTheme(theme) {
            const body = document.body;
            body.classList.remove('dark-mode', 'light-mode');

            if (theme === 'dark') {
                body.classList.add('dark-mode');
                updateThemeButton(true);
                setQuoteAuthorColor('#f5f7ff');
            } else if (theme === 'light') {
                body.classList.add('light-mode');
                updateThemeButton(false);
                setQuoteAuthorColor('#1f2a37');
            } else {
                // Auto mod - sistem tercihini kullan
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (prefersDark) {
                    body.classList.add('dark-mode');
                    updateThemeButton(true);
                    setQuoteAuthorColor('#f5f7ff');
                } else {
                    updateThemeButton(false);
                    setQuoteAuthorColor('#1f2a37');
                }
            }
        }

        function updateThemeButton(isDark) {
            const themeIcon = document.getElementById('themeIcon');
            const themeText = document.getElementById('themeText');

            if (themeIcon && themeText) {
                if (isDark) {
                    themeIcon.textContent = '‚òÄÔ∏è';
                    themeText.textContent = 'A√ßƒ±k Mod';
                } else {
                    themeIcon.textContent = 'üåô';
                    themeText.textContent = 'Koyu Mod';
                }
            }
        }

        function toggleTheme() {
            const currentTheme = getThemePreference();
            let newTheme;

            if (currentTheme === 'auto') {
                // Auto moddan koyu moda ge√ß
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                newTheme = prefersDark ? 'light' : 'dark';
            } else if (currentTheme === 'dark') {
                newTheme = 'light';
            } else {
                newTheme = 'dark';
            }

            saveThemePreference(newTheme);
            applyTheme(newTheme);
        }

        // Arama ge√ßmi≈üi y√∂netimi
        function getSearchHistory() {
            const history = localStorage.getItem(SEARCH_HISTORY_KEY);
            return history ? JSON.parse(history) : [];
        }

        function saveSearchHistory(history) {
            localStorage.setItem(SEARCH_HISTORY_KEY, JSON.stringify(history));
        }

        function addToSearchHistory(searchTerm) {
            if (!searchTerm || searchTerm.trim().length === 0) return;

            let history = getSearchHistory();
            // Aynƒ± terimi kaldƒ±r (varsa)
            history = history.filter(term => term.toLowerCase() !== searchTerm.toLowerCase().trim());
            // En ba≈üa ekle
            history.unshift(searchTerm.trim());
            // Son 5'i sakla
            history = history.slice(0, 5);
            saveSearchHistory(history);
        }

        function showSearchHistory() {
            const dropdown = document.getElementById('searchHistoryDropdown');
            const history = getSearchHistory();

            if (history.length === 0) {
                dropdown.classList.remove('show');
                return;
            }

            // √ñnceki event listener'larƒ± temizle
            dropdown.innerHTML = '';

            history.forEach((term, index) => {
                const item = document.createElement('div');
                item.className = 'search-history-item';
                item.setAttribute('role', 'option');
                item.setAttribute('tabindex', '0');
                item.setAttribute('data-term', term);
                item.innerHTML = `
                    <span class="icon">üïí</span>
                    <span>${escapeHtml(term)}</span>
                `;

                // Event listener ekle
                item.addEventListener('click', function() {
                    selectSearchHistory(term);
                });

                item.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        selectSearchHistory(term);
                    }
                });

                dropdown.appendChild(item);
            });

            dropdown.classList.add('show');
        }

        function hideSearchHistory() {
            const dropdown = document.getElementById('searchHistoryDropdown');
            dropdown.classList.remove('show');
        }

        function selectSearchHistory(term) {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.value = term || '';
                searchInput.focus();
            }
            hideSearchHistory();
            setTimeout(() => {
                // Ba≈üka bir arama s√ºr√ºyorsa iptal et
                if (isSearching) {
                    isSearching = false;
                }
                searchBooks();
            }, 50);
        }

        // Son Aramalar fonksiyonlarƒ±
        function saveRecentSearch(query) {
            if (!query || query.trim().length === 0) return;

            const trimmedQuery = query.trim();
            let recentSearches = [];

            try {
                const stored = localStorage.getItem('recentSearches_v1');
                if (stored) {
                    recentSearches = JSON.parse(stored);
                }
            } catch (e) {
                console.error('Son aramalar y√ºklenirken hata:', e);
                recentSearches = [];
            }

            // Aynƒ± sorguyu kaldƒ±r (varsa)
            recentSearches = recentSearches.filter(item => item.toLowerCase() !== trimmedQuery.toLowerCase());

            // En ba≈üa ekle
            recentSearches.unshift(trimmedQuery);

            // Maksimum 10 kayƒ±t tut
            recentSearches = recentSearches.slice(0, 10);

            // localStorage'a kaydet
            try {
                localStorage.setItem('recentSearches_v1', JSON.stringify(recentSearches));
            } catch (e) {
                console.error('Son aramalar kaydedilirken hata:', e);
            }
        }


        // displayResults i√ßin HTML olu≈üturma fonksiyonu
        function displayResultsHTML(books, uniqueId = 'res') {
            return books.map((book, index) => {
                // displayResults i√ßindeki aynƒ± mantƒ±ƒüƒ± kullan
                let coverImage = '';
                const placeholderId = `placeholder-${uniqueId}-${index}`;
                const imageId = `image-${uniqueId}-${index}`;
                const favoriteId = `favorite-${uniqueId}-${index}`;
                const bookId = book.isbn || `${book.title}_${book.author}`;
                const isFav = isFavorite(book);
                const favoriteClass = isFav ? 'active' : '';
                const favoriteIcon = isFav ? '‚≠ê' : '‚òÜ';
                const links = buildPurchaseLinks(book);

                if (book.thumbnail) {
                    coverImage = `<img id="${imageId}"
                                      src="${book.thumbnail}"
                                      alt="${escapeHtml(book.title)}"
                                      class="book-cover"
                                      loading="lazy"
                                      onerror="const img = document.getElementById('${imageId}'); const pl = document.getElementById('${placeholderId}'); if(img) img.style.display='none'; if(pl) pl.classList.add('show');">
                                  ${createPlaceholderImage(book.title, false, placeholderId)}`;
                } else {
                    coverImage = createPlaceholderImage(book.title, true, placeholderId);
                }

                return `
                    <div class="book-card" role="listitem" data-book-id="${escapeHtml(bookId)}" aria-label="Kitap: ${escapeHtml(book.title)}, Yazar: ${escapeHtml(book.author)}">
                        <button class="favorite-btn ${favoriteClass}"
                                id="${favoriteId}"
                                onclick="toggleFavorite(${index}, false, event)"
                                aria-label="${isFav ? 'Favorilerden √ßƒ±kar' : 'Favorilere ekle'}"
                                title="${isFav ? 'Favorilerden √ßƒ±kar' : 'Favorilere ekle'}">
                            ${favoriteIcon}
                        </button>
                        ${coverImage}
                        <div class="book-info">
                            <div class="book-title">${escapeHtml(book.title)}</div>
                            <div class="book-author">${escapeHtml(book.author)}</div>
                            <div class="book-year">${escapeHtml(book.year || 'Bilinmiyor')}${book.publisher ? ` ‚Ä¢ ${escapeHtml(book.publisher)}` : ''}</div>
                            <div class="book-summary">${escapeHtml(book.summary || '')}</div>
                            <div class="purchase-links" role="group" aria-label="Satƒ±n alma baƒülantƒ±larƒ±">
                                ${links.drLink ? `<a href="${links.drLink}" target="_blank" rel="noopener noreferrer" class="purchase-link dr-link" aria-label="D&R'da ${escapeHtml(book.title)} kitabƒ±nƒ± satƒ±n al">D&R</a>` : ''}
                                ${links.bkmLink ? `<a href="${links.bkmLink}" target="_blank" rel="noopener noreferrer" class="purchase-link bkm-link" aria-label="BKM Kitap'ta ${escapeHtml(book.title)} kitabƒ±nƒ± satƒ±n al">BKM</a>` : ''}
                                ${links.kitapyurduLink ? `<a href="${links.kitapyurduLink}" target="_blank" rel="noopener noreferrer" class="purchase-link kitapyurdu-link" aria-label="Kitapyurdu'nda ${escapeHtml(book.title)} kitabƒ±nƒ± satƒ±n al">Kitapyurdu</a>` : ''}
                                ${links.hepsiburadaLink ? `<a href="${links.hepsiburadaLink}" target="_blank" rel="noopener noreferrer" class="purchase-link hepsiburada-link" aria-label="Hepsiburada'da ${escapeHtml(book.title)} kitabƒ±nƒ± satƒ±n al">Hepsiburada</a>` : ''}
                                ${links.trendyolLink ? `<a href="${links.trendyolLink}" target="_blank" rel="noopener noreferrer" class="purchase-link trendyol-link" aria-label="Trendyol'da ${escapeHtml(book.title)} kitabƒ±nƒ± satƒ±n al">Trendyol</a>` : ''}
                                ${links.amazonLink ? `<a href="${links.amazonLink}" target="_blank" rel="noopener noreferrer" class="purchase-link amazon-link" aria-label="Amazon'da ${escapeHtml(book.title)} kitabƒ±nƒ± satƒ±n al">Amazon</a>` : ''}
                            </div>
                            <button class="price-compare-btn" data-book-title="${escapeHtml(book.title)}" data-book-author="${escapeHtml(book.author)}">üí∞ Fiyat Kar≈üƒ±la≈ütƒ±r</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Ke≈üfet / √ñnerilen Kitaplar fonksiyonu
        function renderDiscoverBooks() {
            const resultsNormal = document.getElementById('results-normal');
            if (!resultsNormal) return;

            // Container'larƒ± y√∂net: Normal g√∂ster, diƒüerlerini gizle
            const resultsRandom = document.getElementById('results-random');
            const resultsTrend = document.getElementById('results-trend');

            if (resultsNormal) resultsNormal.style.display = 'block';
            if (resultsRandom) resultsRandom.style.display = 'none';
            if (resultsTrend) resultsTrend.style.display = 'none';

            // DISCOVER_BOOKS dizisindeki kitaplarƒ± g√∂ster
            // displayResults fonksiyonunu kullanarak mevcut kart yapƒ±sƒ±nƒ± kullan
            displayResults(DISCOVER_BOOKS);
            currentBooks = DISCOVER_BOOKS; // currentBooks'u g√ºncelle (rastgele kitap i√ßin)
        }

        // Trend Rafƒ± fonksiyonlarƒ± - Geni≈ületilmi≈ü Kitap Havuzu
        const TREND_BOOK_POOL = [
            // === T√úRK EDEBƒ∞YATI - ROMANLAR ===
            { title: "Yƒ±rtƒ±cƒ± Ku≈ülar Zamanƒ±", author: "Ahmet √úmit", category: "T√ºrk Roman", year: "2023", summary: "Polisiye t√ºr√ºnde √ßaƒüda≈ü bir roman." },
            { title: "Tutunamayanlar", author: "Oƒüuz Atay", category: "T√ºrk Roman", year: "1972", summary: "T√ºrk edebiyatƒ±nƒ±n ba≈üyapƒ±tlarƒ±ndan." },
            { title: "Saatleri Ayarlama Enstit√ºs√º", author: "Ahmet Hamdi Tanpƒ±nar", category: "T√ºrk Roman", year: "1961", summary: "Zaman ve modernle≈üme √ºzerine derin bir eser." },
            { title: "K√ºrk Mantolu Madonna", author: "Sabahattin Ali", category: "T√ºrk Roman", year: "1943", summary: "A≈ük ve toplum √ºzerine klasik bir roman." },
            { title: "ƒ∞nce Memed", author: "Ya≈üar Kemal", category: "T√ºrk Roman", year: "1955", summary: "Anadolu'nun destansƒ± hikayesi." },
            { title: "Huzur", author: "Ahmet Hamdi Tanpƒ±nar", category: "T√ºrk Roman", year: "1949", summary: "ƒ∞stanbul'un ruhunu anlatan ba≈üyapƒ±t." },
            { title: "Puslu Kƒ±talar Atlasƒ±", author: "ƒ∞hsan Oktay Anar", category: "T√ºrk Roman", year: "1995", summary: "Fantastik ve postmodern bir eser." },
            { title: "Benim Adƒ±m Kƒ±rmƒ±zƒ±", author: "Orhan Pamuk", category: "T√ºrk Roman", year: "1998", summary: "Nobel √∂d√ºll√º yazarƒ±n ba≈üyapƒ±tƒ±." },
            { title: "Masumiyet M√ºzesi", author: "Orhan Pamuk", category: "T√ºrk Roman", year: "2008", summary: "A≈ük ve nostalji dolu bir ƒ∞stanbul hikayesi." },
            { title: "Kar", author: "Orhan Pamuk", category: "T√ºrk Roman", year: "2002", summary: "Kars'ta ge√ßen politik ve felsefi roman." },
            { title: "√áalƒ±ku≈üu", author: "Re≈üat Nuri G√ºntekin", category: "T√ºrk Roman", year: "1922", summary: "Feride'nin Anadolu'daki ya≈üamƒ±." },
            { title: "A≈ük-ƒ± Memnu", author: "Halit Ziya U≈üaklƒ±gil", category: "T√ºrk Roman", year: "1900", summary: "T√ºrk edebiyatƒ±nƒ±n ilk modern romanƒ±." },
            { title: "Mai ve Siyah", author: "Halit Ziya U≈üaklƒ±gil", category: "T√ºrk Roman", year: "1897", summary: "Romantizm ve realizm arasƒ±nda bir gen√ß." },
            { title: "Yaban", author: "Yakup Kadri Karaosmanoƒülu", category: "T√ºrk Roman", year: "1932", summary: "Kurtulu≈ü Sava≈üƒ± d√∂neminde bir aydƒ±n." },
            { title: "Sinekli Bakkal", author: "Halide Edib Adƒ±var", category: "T√ºrk Roman", year: "1936", summary: "ƒ∞stanbul'un bir mahallesi ve sakinleri." },
            { title: "Aylak Adam", author: "Yusuf Atƒ±lgan", category: "T√ºrk Roman", year: "1959", summary: "Varolu≈ü√ßu bir ba≈üyapƒ±t." },
            { title: "Anayurt Oteli", author: "Yusuf Atƒ±lgan", category: "T√ºrk Roman", year: "1973", summary: "Psikolojik gerilim dolu bir roman." },
            { title: "Beyaz Kale", author: "Orhan Pamuk", category: "T√ºrk Roman", year: "1985", summary: "Kimlik ve benlik √ºzerine tarihsel roman." },
            { title: "Tehlikeli Oyunlar", author: "Oƒüuz Atay", category: "T√ºrk Roman", year: "1973", summary: "Aydƒ±n bireyin bunalƒ±mƒ±." },
            { title: "Kuyucaklƒ± Yusuf", author: "Sabahattin Ali", category: "T√ºrk Roman", year: "1937", summary: "Toplumsal ele≈ütiri i√ßeren roman." },
            { title: "Serenad", author: "Z√ºlf√º Livaneli", category: "T√ºrk Roman", year: "2011", summary: "ƒ∞stanbul ve Selanik'te ge√ßen epik bir hikaye." },
            { title: "Bliss", author: "Z√ºlf√º Livaneli", category: "T√ºrk Roman", year: "2002", summary: "Namus cinayeti ve kurtulu≈ü hikayesi." },
            { title: "Sultanƒ±n Korsanlarƒ±", author: "Emrah Safa G√ºrkan", category: "T√ºrk Roman", year: "2022", summary: "Osmanlƒ± denizcilerinin destanƒ±." },
            { title: "Kafamda Bir Tuhaflƒ±k", author: "Orhan Pamuk", category: "T√ºrk Roman", year: "2014", summary: "Boza satƒ±cƒ±sƒ± Mevl√ºt'√ºn hayatƒ±." },
            
            // === T√úRK EDEBƒ∞YATI - ≈ûƒ∞ƒ∞R ===
            { title: "Hasretinden Prangalar Eskittim", author: "Ahmed Arif", category: "T√ºrk ≈ûiir", year: "1968", summary: "T√ºrk ≈üiirinin en etkileyici seslerinden." },
            { title: "Sevda S√∂zleri", author: "Cemal S√ºreya", category: "T√ºrk ≈ûiir", year: "1984", summary: "A≈ük ve sevda √ºzerine ≈üiirler." },
            { title: "G√∂ƒüe Bakma Duraƒüƒ±", author: "Turgut Uyar", category: "T√ºrk ≈ûiir", year: "1958", summary: "ƒ∞kinci Yeni akƒ±mƒ±nƒ±n √∂nemli eseri." },
            { title: "Otuz Be≈ü Ya≈ü", author: "Cahit Sƒ±tkƒ± Tarancƒ±", category: "T√ºrk ≈ûiir", year: "1946", summary: "Ya≈üamƒ±n ge√ßiciliƒüi √ºzerine ≈üiirler." },
            { title: "Sabahattin Ali ≈ûiirleri", author: "Sabahattin Ali", category: "T√ºrk ≈ûiir", year: "1940", summary: "Toplumcu ≈üiirin √∂nemli √∂rnekleri." },
            { title: "Ben Sana Mecburum", author: "Attila ƒ∞lhan", category: "T√ºrk ≈ûiir", year: "1960", summary: "A≈ük ≈üiirlerinin ba≈üyapƒ±tƒ±." },
            { title: "Kendi G√∂k Kubbem", author: "Yahya Kemal Beyatlƒ±", category: "T√ºrk ≈ûiir", year: "1961", summary: "ƒ∞stanbul ve tarih ≈üiirleri." },
            { title: "≈ûiirler", author: "Nazƒ±m Hikmet", category: "T√ºrk ≈ûiir", year: "1950", summary: "D√ºnya √ßapƒ±nda √ºnl√º T√ºrk ≈üairi." },
            { title: "Ya≈üadƒ±klarƒ±mdan √ñƒürendiƒüim Bir ≈ûey Var", author: "Orhan Veli Kanƒ±k", category: "T√ºrk ≈ûiir", year: "1945", summary: "Garip akƒ±mƒ±nƒ±n √∂nc√ºs√º." },
            
            // === D√úNYA EDEBƒ∞YATI - KLASƒ∞KLER ===
            { title: "Su√ß ve Ceza", author: "Fyodor Dostoyevski", category: "D√ºnya Klasik", year: "1866", summary: "Vicdan ve su√ßluluk √ºzerine ba≈üyapƒ±t." },
            { title: "Karamazov Karde≈üler", author: "Fyodor Dostoyevski", category: "D√ºnya Klasik", year: "1880", summary: "Dostoyevski'nin son ve en b√ºy√ºk eseri." },
            { title: "Anna Karenina", author: "Lev Tolstoy", category: "D√ºnya Klasik", year: "1877", summary: "A≈ük, aile ve toplum √ºzerine epik roman." },
            { title: "Sava≈ü ve Barƒ±≈ü", author: "Lev Tolstoy", category: "D√ºnya Klasik", year: "1869", summary: "Rus edebiyatƒ±nƒ±n destansƒ± eseri." },
            { title: "1984", author: "George Orwell", category: "D√ºnya Klasik", year: "1949", summary: "Distopik edebiyatƒ±n ba≈üyapƒ±tƒ±." },
            { title: "Hayvan √áiftliƒüi", author: "George Orwell", category: "D√ºnya Klasik", year: "1945", summary: "Politik hiciv dolu bir alegori." },
            { title: "Y√ºz√ºklerin Efendisi", author: "J.R.R. Tolkien", category: "D√ºnya Klasik", year: "1954", summary: "Fantastik edebiyatƒ±n zirvesi." },
            { title: "K√º√ß√ºk Prens", author: "Antoine de Saint-Exup√©ry", category: "D√ºnya Klasik", year: "1943", summary: "T√ºm zamanlarƒ±n en sevilen kitabƒ±." },
            { title: "Don Ki≈üot", author: "Miguel de Cervantes", category: "D√ºnya Klasik", year: "1605", summary: "ƒ∞lk modern roman olarak kabul edilir." },
            { title: "Sefiller", author: "Victor Hugo", category: "D√ºnya Klasik", year: "1862", summary: "Adalet ve merhamet √ºzerine epik eser." },
            { title: "Monte Cristo Kontu", author: "Alexandre Dumas", category: "D√ºnya Klasik", year: "1844", summary: "ƒ∞ntikam ve kurtulu≈üun destanƒ±." },
            { title: "B√ºlb√ºl√º √ñld√ºrmek", author: "Harper Lee", category: "D√ºnya Klasik", year: "1960", summary: "Irk√ßƒ±lƒ±k ve adalet √ºzerine ba≈üyapƒ±t." },
            { title: "Fahrenheit 451", author: "Ray Bradbury", category: "D√ºnya Klasik", year: "1953", summary: "Kitaplarƒ±n yakƒ±ldƒ±ƒüƒ± bir d√ºnya." },
            { title: "Cesur Yeni D√ºnya", author: "Aldous Huxley", category: "D√ºnya Klasik", year: "1932", summary: "Distopik toplum ele≈ütirisi." },
            { title: "Simyacƒ±", author: "Paulo Coelho", category: "D√ºnya Klasik", year: "1988", summary: "Ki≈üisel efsane arayƒ±≈üƒ±." },
            
            // === D√úNYA EDEBƒ∞YATI - MODERN ===
            { title: "Gece Yarƒ±sƒ± K√ºt√ºphanesi", author: "Matt Haig", category: "D√ºnya Modern", year: "2020", summary: "Paralel hayatlarƒ± ke≈üfeden bir hikaye." },
            { title: "Intermezzo", author: "Sally Rooney", category: "D√ºnya Modern", year: "2024", summary: "Modern ili≈ükileri anlatan √ßaƒüda≈ü roman." },
            { title: "Hyunam-Dong Kitabevi", author: "Hwang Bo-Reum", category: "D√ºnya Modern", year: "2022", summary: "Bir kitap√ßƒ±nƒ±n sakin ya≈üamƒ±nƒ± anlatan roman." },
            { title: "Atomik Alƒ±≈ükanlƒ±klar", author: "James Clear", category: "Ki≈üisel Geli≈üim", year: "2018", summary: "K√º√ß√ºk deƒüi≈üikliklerle b√ºy√ºk sonu√ßlar." },
            { title: "Bin Muhte≈üem G√ºne≈ü", author: "Khaled Hosseini", category: "D√ºnya Modern", year: "2007", summary: "Afganistan'da iki kadƒ±nƒ±n hikayesi." },
            { title: "U√ßurtma Avcƒ±sƒ±", author: "Khaled Hosseini", category: "D√ºnya Modern", year: "2003", summary: "Dostluk, ihanet ve kurtulu≈ü." },
            { title: "Ya≈üamak", author: "Yu Hua", category: "D√ºnya Modern", year: "1993", summary: "Modern √áin edebiyatƒ±nƒ±n klasik eseri." },
            { title: "Algernon'a √ái√ßekler", author: "Daniel Keyes", category: "D√ºnya Modern", year: "1959", summary: "Zeka ve insanlƒ±k √ºzerine." },
            { title: "Vejeteryan", author: "Han Kang", category: "D√ºnya Modern", year: "2007", summary: "Nobel √∂d√ºll√º yazarƒ±n etkileyici eseri." },
            { title: "ƒ∞nsan Neyle Ya≈üar", author: "Han Kang", category: "D√ºnya Modern", year: "2021", summary: "Acƒ± ve hafƒ±za √ºzerine." },
            { title: "Normal ƒ∞nsanlar", author: "Sally Rooney", category: "D√ºnya Modern", year: "2018", summary: "Gen√ßlik ve a≈ük √ºzerine modern roman." },
            { title: "Bir Ada Hikayesi", author: "Elif Shafak", category: "D√ºnya Modern", year: "2021", summary: "Kƒ±brƒ±s'ta ge√ßen etkileyici hikaye." },
            { title: "A≈ük", author: "Elif Shafak", category: "D√ºnya Modern", year: "2009", summary: "Mevlana'nƒ±n hayatƒ± etrafƒ±nda √∂r√ºl√º roman." },
            { title: "≈ûeker Portakalƒ±", author: "Jos√© Mauro de Vasconcelos", category: "D√ºnya Modern", year: "1968", summary: "√áocukluƒüun masum hikayesi." },
            { title: "D√∂n√º≈ü√ºm", author: "Franz Kafka", category: "D√ºnya Modern", year: "1915", summary: "Abs√ºrt edebiyatƒ±n ba≈üyapƒ±tƒ±." },
            { title: "Yabancƒ±", author: "Albert Camus", category: "D√ºnya Modern", year: "1942", summary: "Varolu≈ü√ßu felsefenin roman hali." },
            { title: "Veba", author: "Albert Camus", category: "D√ºnya Modern", year: "1947", summary: "ƒ∞nsanlƒ±k durumu √ºzerine alegorik eser." },
            { title: "Dune", author: "Frank Herbert", category: "D√ºnya Modern", year: "1965", summary: "Bilimkurgunun en b√ºy√ºk destanƒ±." },
            { title: "Sapiens", author: "Yuval Noah Harari", category: "Ki≈üisel Geli≈üim", year: "2011", summary: "ƒ∞nsanlƒ±k tarihinin kƒ±sa hikayesi." },
            { title: "ƒ∞kigai", author: "H√©ctor Garc√≠a", category: "Ki≈üisel Geli≈üim", year: "2016", summary: "Japon ya≈üam felsefesi." },
            { title: "Baƒüƒ±msƒ±z D√º≈ü√ºnme Sanatƒ±", author: "Shane Snow", category: "Ki≈üisel Geli≈üim", year: "2019", summary: "Farklƒ± d√º≈ü√ºnme teknikleri." },
            { title: "Sessizliƒüin G√ºc√º", author: "Thich Nhat Hanh", category: "Ki≈üisel Geli≈üim", year: "2015", summary: "Farkƒ±ndalƒ±k ve huzur √ºzerine." },
            { title: "Homo Deus", author: "Yuval Noah Harari", category: "Ki≈üisel Geli≈üim", year: "2015", summary: "ƒ∞nsanlƒ±ƒüƒ±n geleceƒüi √ºzerine." },
            { title: "21. Y√ºzyƒ±l ƒ∞√ßin 21 Ders", author: "Yuval Noah Harari", category: "Ki≈üisel Geli≈üim", year: "2018", summary: "G√ºn√ºm√ºz d√ºnyasƒ±nƒ± anlamak i√ßin." },
            
            // === D√úNYA EDEBƒ∞YATI - POP√úLER ===
            { title: "Harry Potter ve Felsefe Ta≈üƒ±", author: "J.K. Rowling", category: "D√ºnya Pop√ºler", year: "1997", summary: "Sihirli d√ºnyanƒ±n kapƒ±larƒ± a√ßƒ±lƒ±yor." },
            { title: "A√ßlƒ±k Oyunlarƒ±", author: "Suzanne Collins", category: "D√ºnya Pop√ºler", year: "2008", summary: "Distopik gen√ßlik edebiyatƒ±nƒ±n zirvesi." },
            { title: "Alacakaranlƒ±k", author: "Stephenie Meyer", category: "D√ºnya Pop√ºler", year: "2005", summary: "Vampir a≈ükƒ±nƒ±n ba≈ülangƒ±cƒ±." },
            { title: "Da Vinci ≈ûifresi", author: "Dan Brown", category: "D√ºnya Pop√ºler", year: "2003", summary: "Gerilim ve gizem dolu macera." },
            { title: "Melekler ve ≈ûeytanlar", author: "Dan Brown", category: "D√ºnya Pop√ºler", year: "2000", summary: "Vatikan'da ge√ßen heyecanlƒ± macera." },
            { title: "Sherlock Holmes", author: "Arthur Conan Doyle", category: "D√ºnya Pop√ºler", year: "1887", summary: "Dedektif edebiyatƒ±nƒ±n ba≈üyapƒ±tƒ±." },
            { title: "Agatha Christie Se√ßkisi", author: "Agatha Christie", category: "D√ºnya Pop√ºler", year: "1920", summary: "Polisiye edebiyatƒ±nƒ±n krali√ßesi." },
            { title: "Hobbit", author: "J.R.R. Tolkien", category: "D√ºnya Pop√ºler", year: "1937", summary: "Orta D√ºnya'ya giri≈ü." },
            { title: "Narnia G√ºnl√ºkleri", author: "C.S. Lewis", category: "D√ºnya Pop√ºler", year: "1950", summary: "B√ºy√ºl√º bir d√ºnyanƒ±n kapƒ±larƒ±." },
            { title: "G√ºnl√ºƒüe Yazƒ±lanlar", author: "Anne Frank", category: "D√ºnya Pop√ºler", year: "1947", summary: "Sava≈üƒ±n en dokunaklƒ± tanƒ±klƒ±ƒüƒ±." }
        ];

        const TREND_QUOTES = [
            // Genel kitap s√∂zleri
            "ƒ∞yi bir kitap, tekrar tekrar a√ßƒ±labilen bir hediyedir.",
            "Bir sayfa, bazen bir √∂m√ºrden daha √ßok ≈üey anlatƒ±r.",
            "Okuduk√ßa hayat b√ºy√ºmez, sen b√ºy√ºrs√ºn.",
            "Kitaplar, ba≈ükalarƒ±nƒ±n kalbinden yazƒ±lmƒ±≈ü haritalardƒ±r.",
            "Bir k√ºt√ºphane, zamanƒ±n i√ßinden a√ßƒ±lan sessiz bir kapƒ±dƒ±r.",
            "Kitap okumak, bin yƒ±l ya≈üamaktƒ±r.",
            "Her kitap, yeni bir d√ºnyaya a√ßƒ±lan kapƒ±dƒ±r.",
            "Okumak, ruhun yolculuƒüudur.",
            "Kitaplar sessiz ama g√º√ßl√º dostlardƒ±r.",
            "Bir kitabƒ± bitirmek, bir dostla vedala≈ümak gibidir.",
            
            // √únl√º yazarlardan
            "Okuyan bir insan, iki hayat ya≈üar. ‚Äî Umberto Eco",
            "Kitaplar, ruhun ilacƒ±dƒ±r. ‚Äî Antik Yunan atas√∂z√º",
            "Bir oda kitapsƒ±zsa, ruhsuz bir beden gibidir. ‚Äî Cicero",
            "Kitap, sessiz bir √∂ƒüretmendir. ‚Äî Aulus Gellius",
            "Okumak, ba≈üka birinin d√º≈ü√ºncesiyle d√º≈ü√ºnmektir. ‚Äî Arthur Schopenhauer",
            "Bazƒ± kitaplar tadƒ±lmalƒ±, bazƒ±larƒ± yutulmalƒ±, √ßok azƒ± ise √ßiƒünenip sindirilmelidir. ‚Äî Francis Bacon",
            "Kitaplar gemilerin ta≈üƒ±yamadƒ±ƒüƒ± y√ºkleri ta≈üƒ±r. ‚Äî Emily Dickinson",
            "Okuduƒüum iyi kitaplarƒ±n sayƒ±sƒ± kadar zenginim. ‚Äî Henry David Thoreau",
            
            // T√ºrk yazarlardan
            "ƒ∞nsan okumalƒ±, ama ya≈üamak i√ßin okumalƒ±. ‚Äî Sabahattin Ali",
            "Kitap, insanƒ±n i√ßine a√ßƒ±lan penceredir. ‚Äî Ya≈üar Kemal",
            "Her kitap, binlerce yƒ±lƒ±n birikimidir. ‚Äî Cemil Meri√ß",
            "Okumak, d√º≈ü√ºnmenin ta kendisidir. ‚Äî Ahmet Hamdi Tanpƒ±nar",
            "Bir kitap bazen bir √∂mre bedeldir. ‚Äî Oƒüuz Atay",
            "Kelimeler, insanƒ± insan yapan tek ≈üeydir. ‚Äî Nazƒ±m Hikmet",
            
            // D√ºnya edebiyatƒ±ndan
            "Bir kitabƒ± okumak, ba≈üka bir hayatƒ± ya≈üamaktƒ±r. ‚Äî Jorge Luis Borges",
            "Kitaplar, √∂l√ºms√ºzl√ºƒü√ºn kanƒ±tƒ±dƒ±r. ‚Äî Carl Sagan",
            "ƒ∞yi edebiyat, insanlƒ±ƒüƒ±n aynasƒ±dƒ±r. ‚Äî Virginia Woolf",
            "Her yeni kitap, yeni bir yolculuktur. ‚Äî Paulo Coelho",
            "Kitaplar, en sadƒ±k arkada≈ülardƒ±r. ‚Äî Ernest Hemingway",
            "Bir roman, hayatƒ±n yoƒüunla≈ütƒ±rƒ±lmƒ±≈ü halidir. ‚Äî Milan Kundera",
            
            // ƒ∞lham verici
            "Bug√ºn okuduƒüun bir satƒ±r, yarƒ±n hayatƒ±nƒ± deƒüi≈ütirebilir.",
            "Kitaplar d√º≈ü√ºnd√ºr√ºr, d√º≈ü√ºnce √∂zg√ºrle≈ütirir.",
            "Her okunan sayfa, zihnine eklenen bir tuƒüladƒ±r.",
            "Okumak, sessiz bir devrimdir.",
            "En g√ºzel yolculuklar, sayfalarda yapƒ±lƒ±r.",
            "Bir kitap, zamana meydan okuyan bir sestir.",
            "Okuyan g√∂z, g√∂ren kalpten gelir.",
            "Kitaplar √∂lmez, sadece yeni okuyucularƒ±nƒ± bekler.",
            
            // ≈ûiirsel
            "Harfler sessiz, kelimeler g√ºr√ºlt√ºl√º, kitaplar ise sonsuz.",
            "Bir kitabƒ±n kokusu, d√º≈ü√ºncelerin parf√ºm√ºd√ºr.",
            "Sayfalar d√∂nd√ºk√ße, ruh yenilenir.",
            "Her kitap, yazarƒ±nƒ±n kalp atƒ±≈üƒ±dƒ±r.",
            "Kelimeler akar, fikirler kalƒ±r.",
            "Okumak, kendi sesini ba≈üka seslerde bulmaktƒ±r."
        ];

        // 12 saatlik periyot hesaplama (Sabah/Ak≈üam)
        function getTrendPeriod() {
            const now = new Date();
            const today = now.toISOString().split('T')[0]; // YYYY-MM-DD
            const hour = now.getHours();
            // Sabah periyodu: 00:00-11:59, Ak≈üam periyodu: 12:00-23:59
            const period = hour < 12 ? 'morning' : 'evening';
            return `${today}_${period}`;
        }

        // G√∂sterilen kitaplarƒ± takip et
        function getShownBooks() {
            try {
                const stored = localStorage.getItem('trendShownBooks_v2');
                return stored ? JSON.parse(stored) : [];
            } catch (e) {
                return [];
            }
        }

        function setShownBooks(books) {
            try {
                localStorage.setItem('trendShownBooks_v2', JSON.stringify(books));
            } catch (e) {
                console.error('G√∂sterilen kitaplar kaydedilirken hata:', e);
            }
        }

        function getTrendData() {
            try {
                const stored = localStorage.getItem('trendData_v2');
                if (stored) {
                    return JSON.parse(stored);
                }
            } catch (e) {
                console.error('Trend verisi y√ºklenirken hata:', e);
            }
            return null;
        }

        function setTrendData(data) {
            try {
                localStorage.setItem('trendData_v2', JSON.stringify(data));
                // Android tarafƒ±na da g√∂nder
                if (window.AndroidBridge && typeof AndroidBridge.saveTrendData === 'function') {
                    AndroidBridge.saveTrendData(JSON.stringify(data));
                }
            } catch (e) {
                console.error('Trend verisi kaydedilirken hata:', e);
            }
        }

        // API'den pop√ºler kitaplarƒ± √ßek
        async function fetchTrendingBooks() {
            const trendingSearchTerms = [
                // T√ºrk Edebiyatƒ± - Romanlar (subject:fiction kullanarak)
                { query: 'subject:fiction inauthor:orhan pamuk', lang: 'tr', category: 'T√ºrk Roman' },
                { query: 'subject:fiction inauthor:z√ºlf√º livaneli', lang: 'tr', category: 'T√ºrk Roman' },
                { query: 'subject:fiction inauthor:ahmet √ºmit', lang: 'tr', category: 'T√ºrk Roman' },
                { query: 'subject:fiction inauthor:sabahattin ali', lang: 'tr', category: 'T√ºrk Roman' },
                { query: 'subject:fiction inauthor:ya≈üar kemal', lang: 'tr', category: 'T√ºrk Roman' },
                { query: 'subject:fiction inauthor:oƒüuz atay', lang: 'tr', category: 'T√ºrk Roman' },
                // T√ºrk Edebiyatƒ± - ≈ûiir
                { query: 'subject:poetry inauthor:nazƒ±m hikmet', lang: 'tr', category: 'T√ºrk ≈ûiir' },
                { query: 'subject:poetry inauthor:cemal s√ºreya', lang: 'tr', category: 'T√ºrk ≈ûiir' },
                { query: 'subject:poetry inauthor:attila ilhan', lang: 'tr', category: 'T√ºrk ≈ûiir' },
                { query: 'subject:poetry inauthor:ahmed arif', lang: 'tr', category: 'T√ºrk ≈ûiir' },
                // D√ºnya Edebiyatƒ± - Romanlar
                { query: 'subject:fiction inauthor:dostoevsky', lang: '', category: 'D√ºnya Roman' },
                { query: 'subject:fiction inauthor:tolstoy', lang: '', category: 'D√ºnya Roman' },
                { query: 'subject:fiction inauthor:kafka', lang: '', category: 'D√ºnya Roman' },
                { query: 'subject:fiction inauthor:hemingway', lang: '', category: 'D√ºnya Roman' },
                { query: 'subject:fiction inauthor:gabriel garcia marquez', lang: '', category: 'D√ºnya Roman' },
                { query: 'subject:fiction inauthor:haruki murakami', lang: '', category: 'D√ºnya Roman' },
                { query: 'subject:fiction booker prize winner', lang: '', category: 'D√ºnya Roman' },
                // D√ºnya Edebiyatƒ± - ≈ûiir
                { query: 'subject:poetry inauthor:rumi', lang: '', category: 'D√ºnya ≈ûiir' },
                { query: 'subject:poetry inauthor:neruda', lang: '', category: 'D√ºnya ≈ûiir' },
                { query: 'subject:poetry inauthor:shakespeare sonnets', lang: '', category: 'D√ºnya ≈ûiir' }
            ];
            
            // ƒ∞nceleme, dergi vb. filtreleme i√ßin yasaklƒ± kelimeler
            const excludedTerms = [
                'dergi', 'magazine', 'journal', 'review', 'inceleme', 'analiz',
                'ele≈ütiri', 'critique', 'study', 'analysis', 'guide', 'rehber',
                's√∂zl√ºk', 'dictionary', 'encyclopedia', 'ansiklopedi', 'handbook',
                'textbook', 'ders kitabƒ±', 'workbook', '√ßalƒ±≈üma kitabƒ±', 'anthology',
                'antoloji', 'collection of essays', 'deneme', 'makale', 'article'
            ];

            // G√ºn√ºn periyoduna g√∂re farklƒ± arama terimleri se√ß (karƒ±≈üƒ±k T√ºrk + D√ºnya)
            const hour = new Date().getHours();
            const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            const periodSeed = dayOfYear * 2 + (hour < 12 ? 0 : 1);
            
            // T√ºrk edebiyatƒ± terimleri (roman + ≈üiir)
            const turkTerms = trendingSearchTerms.filter(t => t.lang === 'tr');
            // D√ºnya edebiyatƒ± terimleri (roman + ≈üiir)
            const dunyaTerms = trendingSearchTerms.filter(t => t.lang === '');
            
            // Her periyotta 1 T√ºrk + 1 D√ºnya terimi se√ß
            const turkTerm = turkTerms[periodSeed % turkTerms.length];
            const dunyaTerm = dunyaTerms[periodSeed % dunyaTerms.length];
            
            const allBooks = [];
            
            // Kitabƒ±n roman/≈üiir olup olmadƒ±ƒüƒ±nƒ± kontrol et (dergi, inceleme vb. deƒüil)
            function isValidBook(info) {
                if (!info || !info.title || !info.authors || info.authors.length === 0) return false;
                
                const title = (info.title || '').toLowerCase();
                const description = (info.description || '').toLowerCase();
                const categories = (info.categories || []).join(' ').toLowerCase();
                
                // Yasaklƒ± terimleri kontrol et
                for (const term of excludedTerms) {
                    if (title.includes(term) || categories.includes(term)) {
                        return false;
                    }
                }
                
                // Sayfa sayƒ±sƒ± kontrol√º (√ßok az sayfalƒ± olanlarƒ± √ßƒ±kar - muhtemelen dergi)
                if (info.pageCount && info.pageCount < 50) return false;
                
                // Periyodik yayƒ±n kontrol√º
                if (info.printType === 'MAGAZINE') return false;
                
                return true;
            }
            
            try {
                // T√ºrk edebiyatƒ±ndan kitap √ßek
                const turkUrl = `${API_BASE_URL}?q=${encodeURIComponent(turkTerm.query)}&maxResults=20&orderBy=relevance&langRestrict=tr&printType=books`;
                const turkResponse = await fetch(turkUrl);
                
                if (turkResponse.ok) {
                    const turkData = await turkResponse.json();
                    if (turkData.items) {
                        const turkBooks = turkData.items
                            .filter(item => isValidBook(item.volumeInfo))
                            .map(item => {
                                const info = item.volumeInfo;
                                return {
                                    title: info.title,
                                    author: info.authors ? info.authors[0] : 'Bilinmeyen',
                                    year: info.publishedDate ? info.publishedDate.substring(0, 4) : 'Bilinmiyor',
                                    summary: info.description ? truncateSummary(info.description, 180) : `${turkTerm.category} kategorisinde bir eser.`,
                                    thumbnail: info.imageLinks ? (info.imageLinks.thumbnail || info.imageLinks.smallThumbnail) : null,
                                    isbn: info.industryIdentifiers ? info.industryIdentifiers[0]?.identifier : null,
                                    category: turkTerm.category,
                                    rating: info.averageRating || 0,
                                    ratingsCount: info.ratingsCount || 0,
                                    publisher: info.publisher || '',
                                    pageCount: info.pageCount || 0,
                                    source: 'turk'
                                };
                            });
                        allBooks.push(...turkBooks);
                    }
                }
                
                // D√ºnya edebiyatƒ±ndan kitap √ßek
                const dunyaUrl = `${API_BASE_URL}?q=${encodeURIComponent(dunyaTerm.query)}&maxResults=20&orderBy=relevance&printType=books`;
                const dunyaResponse = await fetch(dunyaUrl);
                
                if (dunyaResponse.ok) {
                    const dunyaData = await dunyaResponse.json();
                    if (dunyaData.items) {
                        const dunyaBooks = dunyaData.items
                            .filter(item => isValidBook(item.volumeInfo))
                            .map(item => {
                                const info = item.volumeInfo;
                                return {
                                    title: info.title,
                                    author: info.authors ? info.authors[0] : 'Bilinmeyen',
                                    year: info.publishedDate ? info.publishedDate.substring(0, 4) : 'Bilinmiyor',
                                    summary: info.description ? truncateSummary(info.description, 180) : `${dunyaTerm.category} kategorisinde bir eser.`,
                                    thumbnail: info.imageLinks ? (info.imageLinks.thumbnail || info.imageLinks.smallThumbnail) : null,
                                    isbn: info.industryIdentifiers ? info.industryIdentifiers[0]?.identifier : null,
                                    category: dunyaTerm.category,
                                    rating: info.averageRating || 0,
                                    ratingsCount: info.ratingsCount || 0,
                                    publisher: info.publisher || '',
                                    pageCount: info.pageCount || 0,
                                    source: 'dunya'
                                };
                            });
                        allBooks.push(...dunyaBooks);
                    }
                }
                
                if (allBooks.length === 0) {
                    return null;
                }

                // Puanlamaya g√∂re sƒ±rala
                allBooks.sort((a, b) => {
                    const scoreA = (a.rating * 100) + (a.ratingsCount * 0.1);
                    const scoreB = (b.rating * 100) + (b.ratingsCount * 0.1);
                    return scoreB - scoreA;
                });

                // Dengeli se√ßim: 2-3 T√ºrk + 2-3 D√ºnya
                const turkFiltered = allBooks.filter(b => b.source === 'turk').slice(0, 3);
                const dunyaFiltered = allBooks.filter(b => b.source === 'dunya').slice(0, 3);
                
                let selectedBooks = [];
                // Karƒ±≈üƒ±k sƒ±ralama: T√ºrk, D√ºnya, T√ºrk, D√ºnya...
                const maxLen = Math.max(turkFiltered.length, dunyaFiltered.length);
                for (let i = 0; i < maxLen && selectedBooks.length < 5; i++) {
                    if (turkFiltered[i]) selectedBooks.push(turkFiltered[i]);
                    if (dunyaFiltered[i] && selectedBooks.length < 5) selectedBooks.push(dunyaFiltered[i]);
                }
                
                // Eƒüer 5'ten az kitap varsa, kalanlardan tamamla
                if (selectedBooks.length < 5) {
                    const remaining = allBooks.filter(b => !selectedBooks.some(s => s.title === b.title));
                    selectedBooks = [...selectedBooks, ...remaining.slice(0, 5 - selectedBooks.length)];
                }

                return selectedBooks.slice(0, 5);
            } catch (error) {
                console.error('Trend kitaplarƒ± √ßekilirken hata:', error);
                return null;
            }
        }

        // Yedek olarak sabit havuzdan kitap se√ß
        function getBackupTrendBooks() {
            const shuffled = [...TREND_BOOK_POOL].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, 5);
        }

        async function initializeTrendData() {
            const currentPeriod = getTrendPeriod(); // "2025-01-15_morning" veya "2025-01-15_evening"
            const existingData = getTrendData();

            // Eƒüer bu periyodun verisi varsa ve ge√ßerliyse, yeniden olu≈üturma
            if (existingData && existingData.period === currentPeriod && existingData.books && existingData.books.length > 0) {
                return existingData;
            }

            // API'den pop√ºler kitaplarƒ± √ßek
            let selectedBooks = await fetchTrendingBooks();
            
            // API ba≈üarƒ±sƒ±z olursa yedek havuzdan al
            if (!selectedBooks || selectedBooks.length < 5) {
                console.log('API\'den kitap alƒ±namadƒ±, yedek havuz kullanƒ±lƒ±yor...');
                selectedBooks = getBackupTrendBooks();
            }

            // G√ºn√ºn s√∂z√ºn√º se√ß
            const randomQuote = TREND_QUOTES[Math.floor(Math.random() * TREND_QUOTES.length)];

            // Trend verisini olu≈ütur
            const trendData = {
                period: currentPeriod,
                date: new Date().toISOString().split('T')[0],
                books: selectedBooks,
                quote: randomQuote,
                source: selectedBooks[0]?.isbn ? 'api' : 'backup'
            };

            // Veriyi kaydet
            setTrendData(trendData);

            return trendData;
        }
        async function renderTrendRaft() {
            const trendData = await initializeTrendData();
            if (!trendData) return;

            // Container'larƒ± y√∂net: Trend g√∂ster, diƒüerlerini gizle
            const resultsNormal = document.getElementById('results-normal');
            const resultsRandom = document.getElementById('results-random');
            const resultsTrend = document.getElementById('results-trend');

            if (resultsNormal) resultsNormal.style.display = 'none';
            if (resultsRandom) resultsRandom.style.display = 'none';
            if (resultsTrend) resultsTrend.style.display = 'block';

            if (resultsTrend && trendData.books) {
                // Trend kitaplarƒ±nƒ± results-trend container'ƒ±na yaz
                const booksHtml = trendData.books.map((book, index) => {
                    const bookId = book.isbn || `${book.title}_${book.author}`;
                    const isFav = isFavorite(book);
                    const favoriteClass = isFav ? 'active' : '';
                    const favoriteIcon = isFav ? '‚≠ê' : '‚òÜ';
                    const links = buildPurchaseLinks(book);

                    let coverImage = '';
                    const placeholderId = `placeholder-trend-${index}`;
                    const imageId = `image-trend-${index}`;
                    const favoriteId = `favorite-trend-${index}`;

                    if (book.thumbnail) {
                        coverImage = `<img id="${imageId}"
                                      src="${book.thumbnail}"
                                      alt="${escapeHtml(book.title)}"
                                      class="book-cover"
                                      loading="lazy"
                                      onerror="const img = document.getElementById('${imageId}'); const pl = document.getElementById('${placeholderId}'); if(img) img.style.display='none'; if(pl) pl.classList.add('show');">
                                  ${createPlaceholderImage(book.title, false, placeholderId)}`;
                    } else {
                        coverImage = createPlaceholderImage(book.title, true, placeholderId);
                    }

                    return `
                    <div class="book-card" role="listitem" data-book-id="${escapeHtml(bookId)}" aria-label="Kitap: ${escapeHtml(book.title)}, Yazar: ${escapeHtml(book.author)}">
                        <button class="favorite-btn ${favoriteClass}"
                                id="${favoriteId}"
                                onclick="toggleFavorite(${index}, false, event)"
                                aria-label="${isFav ? 'Favorilerden √ßƒ±kar' : 'Favorilere ekle'}"
                                title="${isFav ? 'Favorilerden √ßƒ±kar' : 'Favorilere ekle'}">
                            ${favoriteIcon}
                        </button>
                        ${coverImage}
                        <div class="book-info">
                            <div class="book-title">${escapeHtml(book.title)}</div>
                            <div class="book-author">Yazar: ${escapeHtml(book.author)}</div>
                            <div class="book-year">Basƒ±m Yƒ±lƒ±: ${escapeHtml(book.year)}${book.publisher ? ` ‚Ä¢ Yayƒ±nevi: ${escapeHtml(book.publisher)}` : ''}</div>
                            <div class="book-summary">${escapeHtml(book.summary)}</div>
                            <div class="purchase-links" role="group" aria-label="Satƒ±n alma linkleri">
                                <a href="${links.drLink}" target="_blank" rel="noopener noreferrer" class="purchase-link dr-link" aria-label="D&R'da ${escapeHtml(book.title)} kitabƒ±nƒ± satƒ±n al">D&R</a>
                                <a href="${links.bkmLink}" target="_blank" rel="noopener noreferrer" class="purchase-link bkm-link" aria-label="BKM Kitap'ta ${escapeHtml(book.title)} kitabƒ±nƒ± satƒ±n al">BKM</a>
                                <a href="${links.kitapyurduLink}" target="_blank" rel="noopener noreferrer" class="purchase-link kitapyurdu-link" aria-label="Kitapyurdu'nda ${escapeHtml(book.title)} kitabƒ±nƒ± satƒ±n al">Kitapyurdu</a>
                                <a href="${links.hepsiburadaLink}" target="_blank" rel="noopener noreferrer" class="purchase-link hepsiburada-link" aria-label="Hepsiburada'da ${escapeHtml(book.title)} kitabƒ±nƒ± satƒ±n al">Hepsiburada</a>
                                <a href="${links.trendyolLink}" target="_blank" rel="noopener noreferrer" class="purchase-link trendyol-link" aria-label="Trendyol'da ${escapeHtml(book.title)} kitabƒ±nƒ± satƒ±n al">Trendyol</a>
                                <a href="${links.amazonLink}" target="_blank" rel="noopener noreferrer" class="purchase-link amazon-link" aria-label="Amazon'da ${escapeHtml(book.title)} kitabƒ±nƒ± satƒ±n al">Amazon</a>
                            </div>
                            <button class="price-compare-btn" data-book-title="${escapeHtml(book.title)}" data-book-author="${escapeHtml(book.author)}">üí∞ Fiyat Kar≈üƒ±la≈ütƒ±r</button>
                        </div>
                    </div>
                    `;
                }).join('');

                // Periyot bilgisini al (Sabah/Ak≈üam)
                const hour = new Date().getHours();
                const periodText = hour < 12 ? '‚òÄÔ∏è Sabah Se√ßkisi' : 'üåô Ak≈üam Se√ßkisi';

                // Trend ba≈ülƒ±ƒüƒ± ve kitaplarƒ± results-trend'e yaz
                const trendHeader = `<div style="background: var(--card-bg, rgba(255, 255, 255, 0.1)); backdrop-filter: blur(10px); border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <h2 style="color: var(--text-primary, white); font-size: 1.5em; margin-bottom: 10px; text-align: center; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">üî• Trend Rafƒ± ‚Äî ${periodText}</h2>
                    <div id="trendQuote" style="color: var(--text-primary, white); font-size: 1.1em; font-style: italic; text-align: center; margin-bottom: 20px; padding: 15px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; text-shadow: 0 1px 3px rgba(0,0,0,0.3);">
                        <div style="margin-bottom: 8px;">üìö</div>
                        <div id="trendQuoteText">${trendData.quote || 'G√ºn√ºn s√∂z√º y√ºkleniyor...'}</div>
                    </div>
                </div>`;
                resultsTrend.innerHTML = trendHeader + booksHtml;
                
                // Trend Rafƒ± fiyat kar≈üƒ±la≈ütƒ±rma butonlarƒ±na event listener ekle
                resultsTrend.querySelectorAll('.price-compare-btn').forEach(btn => {
                    const title = btn.getAttribute('data-book-title');
                    const author = btn.getAttribute('data-book-author');
                    if (title && trendData.books) {
                        const book = trendData.books.find(b => b.title === title && b.author === author);
                        if (book) {
                            const links = buildPurchaseLinks(book);
                            btn.onclick = () => showPriceModal(book, links);
                        }
                    }
                });
            }
        }

        // Blog a√ßma fonksiyonu - Android uygulamasƒ±nƒ±n i√ßinden
        function openBlog() {
            window.location.href = 'blog/index.html';
        }

        async function openTrendSection() {
            // Y√ºkleniyor g√∂ster
            const resultsTrend = document.getElementById('results-trend');
            const resultsNormal = document.getElementById('results-normal');
            const resultsRandom = document.getElementById('results-random');
            
            if (resultsNormal) resultsNormal.style.display = 'none';
            if (resultsRandom) resultsRandom.style.display = 'none';
            if (resultsTrend) {
                resultsTrend.style.display = 'block';
                resultsTrend.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-primary, white);"><div style="font-size: 2em; margin-bottom: 15px;">üîÑ</div><div>Pop√ºler kitaplar y√ºkleniyor...</div></div>';
            }

            // Trend Rafƒ± b√∂l√ºm√ºn√º g√∂ster
            await renderTrendRaft();

            // Trend Rafƒ± b√∂l√ºm√ºne kaydƒ±r
            if (resultsTrend) {
                resultsTrend.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function escapeHtml(text) {
            if (text === null || text === undefined) return '';
            const div = document.createElement('div');
            div.textContent = String(text);
            return div.innerHTML;
        }

        // Favorileri y√∂netme fonksiyonlarƒ±
        function getFavorites() {
            const favorites = localStorage.getItem(FAVORITES_STORAGE_KEY);
            return favorites ? JSON.parse(favorites) : [];
        }

        function saveFavorites(favorites) {
            localStorage.setItem(FAVORITES_STORAGE_KEY, JSON.stringify(favorites));
            updateFavoritesCount();
        }

        function addToFavorites(book) {
            const favorites = getFavorites();
            // Aynƒ± kitabƒ± kontrol et (ISBN veya ba≈ülƒ±k + yazar kombinasyonu ile)
            const bookId = book.isbn || `${book.title}_${book.author}`;
            const exists = favorites.some(fav => {
                const favId = fav.isbn || `${fav.title}_${fav.author}`;
                return favId === bookId;
            });

            if (!exists) {
                favorites.push(book);
                saveFavorites(favorites);
                return true;
            }
            return false;
        }

        function removeFromFavorites(book) {
            const favorites = getFavorites();
            const bookId = book.isbn || `${book.title}_${book.author}`;
            const filtered = favorites.filter(fav => {
                const favId = fav.isbn || `${fav.title}_${fav.author}`;
                return favId !== bookId;
            });
            saveFavorites(filtered);
        }

        function isFavorite(book) {
            const favorites = getFavorites();
            const bookId = book.isbn || `${book.title}_${book.author}`;
            return favorites.some(fav => {
                const favId = fav.isbn || `${fav.title}_${fav.author}`;
                return favId === bookId;
            });
        }

        function updateFavoritesCount() {
            const favorites = getFavorites();
            const countElement = document.getElementById('favoritesCount');
            if (countElement) {
                countElement.textContent = favorites.length;
            }
        }

        function showFavorites() {
            // Modal olarak a√ß
            openFavoritesModal();
        }

        function openFavoritesModal() {
            const modal = document.getElementById('favoritesModal');
            modal.classList.add('active');
            displayFavoritesInModal();
        }

        function closeFavoritesModal() {
            const modal = document.getElementById('favoritesModal');
            modal.classList.remove('active');
        }

        // Modal dƒ±≈üƒ±na tƒ±klandƒ±ƒüƒ±nda kapat
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('favoritesModal');
            if (e.target === modal) {
                closeFavoritesModal();
            }
        });

        function showSearch() {
            document.getElementById('favoritesView').classList.remove('active');
            document.getElementById('searchView').classList.add('active');
        }

        function displayFavorites() {
            const favorites = getFavorites();
            const favoritesContainer = document.getElementById('favoritesContainer');

            if (favorites.length === 0) {
                favoritesContainer.innerHTML = '<div class="empty-favorites" role="status" aria-live="polite">Hen√ºz favori kitabƒ±nƒ±z yok.<br><small>Favorilere eklemek i√ßin kitaplarƒ±n yanƒ±ndaki ‚≠ê butonuna tƒ±klayƒ±n.</small></div>';
                currentBooks = [];
                return;
            }

            currentBooks = favorites; // Favorileri sakla (toggleFavorite i√ßin)
            displayResults(favorites, true);
        }

        function displayFavoritesInModal() {
            const favorites = getFavorites();
            const favoritesContainer = document.getElementById('favoritesModalContainer');

            if (favorites.length === 0) {
                favoritesContainer.innerHTML = '<div class="empty-favorites" style="color: #333; background: #f8f9fa;" role="status" aria-live="polite">Hen√ºz favori kitabƒ±nƒ±z yok.<br><small>Favorilere eklemek i√ßin kitaplarƒ±n yanƒ±ndaki ‚≠ê butonuna tƒ±klayƒ±n.</small></div>';
                currentBooks = [];
                return;
            }

            currentBooks = favorites;
            displayResultsWithPrices(favorites);
        }

        function setFilter(filter, buttonElement) {
            currentFilter = filter;
            // T√ºm butonlardan active class'ƒ±nƒ± kaldƒ±r ve aria-pressed'i false yap
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-pressed', 'false');
                // aria-label'dan "(se√ßili)" kƒ±smƒ±nƒ± kaldƒ±r
                const currentLabel = btn.getAttribute('aria-label');
                if (currentLabel && currentLabel.includes('(se√ßili)')) {
                    btn.setAttribute('aria-label', currentLabel.replace(' (se√ßili)', ''));
                }
            });
            // Tƒ±klanan butona active class'ƒ±nƒ± ekle ve aria-pressed'i true yap
            if (buttonElement) {
                buttonElement.classList.add('active');
                buttonElement.setAttribute('aria-pressed', 'true');
                // aria-label'a "(se√ßili)" ekle
                const currentLabel = buttonElement.getAttribute('aria-label');
                if (currentLabel && !currentLabel.includes('(se√ßili)')) {
                    buttonElement.setAttribute('aria-label', currentLabel + ' (se√ßili)');
                }
            }

            // Eƒüer arama terimi varsa otomatik olarak arama yap
            const searchInput = document.getElementById('searchInput');
            if (searchInput && searchInput.value.trim()) {
                // Kƒ±sa bir gecikme ile arama yap (UI g√ºncellemesi i√ßin)
                setTimeout(() => {
                    searchBooks();
                }, 100);
            }
        }

        function isTestBook(title, description) {
            // Daha kapsamlƒ± test kitabƒ± anahtar kelimeleri
            const testKeywords = [
                'test', 'soru bankasƒ±', 'soru bankasi', 'soru bankasƒ±',
                'sƒ±nav', 'sinav', 'yks', 'tyt', 'ayt', 'lys', 'ms√º', 'msu',
                'konu anlatƒ±mlƒ±', 'konu anlatimli', 'konu anlatimi',
                '√ß√∂z√ºml√º', 'cozumlu', '√ß√∂z√ºm', 'cozum',
                'deneme', 'deneme sƒ±navƒ±', 'deneme sinavi',
                '√∂zet', 'ozet', '√∂zet kitap', 'ozet kitap',
                'hazƒ±rlƒ±k', 'hazirlik', 'hazƒ±rlƒ±k kitabƒ±', 'hazirlik kitabi',
                '√ßalƒ±≈üma kitabƒ±', 'calisma kitabi', 'workbook',
                'alƒ±≈ütƒ±rma', 'alistirma', 'practice',
                'final', 'vize', 'quiz', 'sƒ±nav hazƒ±rlƒ±k', 'sinav hazirlik'
            ];
            const searchText = (title + ' ' + (description || '')).toLowerCase();
            // T√ºrk√ße karakterleri normalize et
            const normalizedText = searchText
                .replace(/ƒ±/g, 'i').replace(/ƒ∞/g, 'I')
                .replace(/ƒü/g, 'g').replace(/ƒû/g, 'G')
                .replace(/√º/g, 'u').replace(/√ú/g, 'U')
                .replace(/≈ü/g, 's').replace(/≈û/g, 'S')
                .replace(/√∂/g, 'o').replace(/√ñ/g, 'O')
                .replace(/√ß/g, 'c').replace(/√á/g, 'C');

            return testKeywords.some(keyword => {
                const normalizedKeyword = keyword.toLowerCase()
                    .replace(/ƒ±/g, 'i').replace(/ƒ∞/g, 'I')
                    .replace(/ƒü/g, 'g').replace(/ƒû/g, 'G')
                    .replace(/√º/g, 'u').replace(/√ú/g, 'U')
                    .replace(/≈ü/g, 's').replace(/≈û/g, 'S')
                    .replace(/√∂/g, 'o').replace(/√ñ/g, 'O')
                    .replace(/√ß/g, 'c').replace(/√á/g, 'C');
                return normalizedText.includes(normalizedKeyword);
            });
        }

        function isValidBook(title, author, description) {
            // Ba≈ülƒ±k kontrol√º
            if (!title || title.trim().length === 0) {
                return false;
            }

            const titleLower = title.toLowerCase().trim();

            // Ge√ßersiz ba≈ülƒ±klar
            const invalidTitles = [
                'ba≈ülƒ±k bulunamadƒ±',
                'undefined',
                'null',
                'none',
                'n/a',
                'no title',
                'untitled'
            ];

            if (invalidTitles.some(invalid => titleLower === invalid)) {
                return false;
            }

            // √áok kƒ±sa ba≈ülƒ±klar (1 karakterden az)
            if (title.trim().length < 2) {
                return false;
            }

            // Sadece √∂zel karakterler veya sayƒ±lar i√ßeren ba≈ülƒ±klar
            const onlySpecialChars = /^[^a-zA-Z√ßƒüƒ±√∂≈ü√º√áƒûIƒ∞√ñ≈û√ú0-9]+$/g.test(title);
            if (onlySpecialChars) {
                return false;
            }

            // √áok fazla √∂zel karakter i√ßeren ba≈ülƒ±klar (%50'den fazla)
            const specialCharCount = (title.match(/[^a-zA-Z√ßƒüƒ±√∂≈ü√º√áƒûIƒ∞√ñ≈û√ú0-9\s]/g) || []).length;
            const specialCharRatio = specialCharCount / title.length;
            if (specialCharRatio > 0.5) {
                return false;
            }

            // URL i√ßeren ba≈ülƒ±klar
            if (/https?:\/\//i.test(title) || /www\./i.test(title)) {
                return false;
            }

            // Yazar kontrol√º - "Yazar bilgisi yok" gibi ge√ßersiz yazarlarƒ± filtrele
            if (author && author.toLowerCase().includes('yazar bilgisi yok')) {
                // Yazar yoksa ama ba≈ülƒ±k ge√ßerliyse kabul et
                // Sadece ba≈ülƒ±k √ßok garipse reddet
            }

            // √áok uzun ba≈ülƒ±klar (200 karakterden fazla) genelde hatalƒ± veri
            if (title.length > 200) {
                return false;
            }

            // En az bir harf i√ßermeli
            if (!/[a-zA-Z√ßƒüƒ±√∂≈ü√º√áƒûIƒ∞√ñ≈û√ú]/.test(title)) {
                return false;
            }

            return true;
        }

        function normalizeTextForSearch(text) {
            return (text || '')
                .toString()
                .toLowerCase()
                .replace(/ƒ±/g, 'i')
                .replace(/ƒ∞/g, 'i')
                .replace(/ƒü/g, 'g')
                .replace(/ƒû/g, 'g')
                .replace(/√º/g, 'u')
                .replace(/√ú/g, 'u')
                .replace(/≈ü/g, 's')
                .replace(/≈û/g, 's')
                .replace(/√∂/g, 'o')
                .replace(/√ñ/g, 'o')
                .replace(/√ß/g, 'c')
                .replace(/√á/g, 'c')
                .trim();
        }

        function getCuratedTestBooks(searchTerm) {
            const normalizedTerm = normalizeTextForSearch(searchTerm);
            const matches = curatedTestBooksLibrary.filter(book => {
                if (!normalizedTerm) {
                    return true;
                }
                const searchableText = normalizeTextForSearch([
                    book.title,
                    book.author,
                    book.summary,
                    book.publisher,
                    ...(book.tags || []),
                    ...(book.examLevels || [])
                ].join(' '));
                return searchableText.includes(normalizedTerm);
            }).slice(0, 15);

            return matches.map((book, index) => ({
                title: book.title,
                author: book.author,
                year: book.year,
                summary: book.summary,
                thumbnail: book.thumbnail,
                isbn: book.isbn,
                isbn13: book.isbn,
                isbn10: null,
                publisher: book.publisher || '',
                isTestBook: true,
                averageRating: book.averageRating || 4.8,
                ratingsCount: book.ratingsCount || 0,
                popularityScore: 250 - index * 10,
                fallbackUrls: [],
                source: 'curated-test-library'
            }));
        }
        
        // Yayƒ±nevi aramasƒ± i√ßin k√ºt√ºphaneden kitap getir
        function getCuratedBooksByPublisher(searchTerm) {
            const normalizedTerm = normalizeTextForSearch(searchTerm);
            if (!normalizedTerm || normalizedTerm.length < 2) {
                return [];
            }
            
            // Hem test kitaplarƒ± hem de ke≈üfet kitaplarƒ±ndan ara
            const allCuratedBooks = [...curatedTestBooksLibrary, ...DISCOVER_BOOKS];
            
            const matches = allCuratedBooks.filter(book => {
                const publisher = normalizeTextForSearch(book.publisher || '');
                const author = normalizeTextForSearch(book.author || '');
                const title = normalizeTextForSearch(book.title || '');
                
                // Yayƒ±nevi adƒ± e≈üle≈ümesi (√∂ncelikli)
                if (publisher.includes(normalizedTerm) || normalizedTerm.includes(publisher)) {
                    return true;
                }
                
                // Kelime bazlƒ± e≈üle≈üme
                const searchWords = normalizedTerm.split(' ').filter(w => w.length > 2);
                if (searchWords.some(word => publisher.includes(word))) {
                    return true;
                }
                
                // Yazar veya ba≈ülƒ±kta yayƒ±nevi adƒ± ge√ßiyorsa
                if (author.includes(normalizedTerm) || title.includes(normalizedTerm)) {
                    return true;
                }
                
                return false;
            });
            
            // Yayƒ±nevi e≈üle≈ümesine g√∂re sƒ±rala (tam e≈üle≈üme √∂nce)
            matches.sort((a, b) => {
                const pubA = normalizeTextForSearch(a.publisher || '');
                const pubB = normalizeTextForSearch(b.publisher || '');
                const exactA = pubA.includes(normalizedTerm);
                const exactB = pubB.includes(normalizedTerm);
                if (exactA && !exactB) return -1;
                if (!exactA && exactB) return 1;
                return 0;
            });
            
            return matches.slice(0, 20).map((book, index) => ({
                title: book.title,
                author: book.author,
                year: book.year || 'Bilinmiyor',
                summary: book.summary || '',
                thumbnail: book.thumbnail || null,
                isbn: book.isbn || null,
                isbn13: book.isbn || null,
                isbn10: null,
                publisher: book.publisher || '',
                isTestBook: book.tags ? true : false,
                averageRating: book.averageRating || 4.5,
                ratingsCount: book.ratingsCount || 0,
                popularityScore: 200 - index * 5,
                fallbackUrls: [],
                source: 'curated-library'
            }));
        }

        function mergeUniqueBooks(primaryBooks = [], extraBooks = []) {
            if (!Array.isArray(extraBooks) || extraBooks.length === 0) {
                return primaryBooks;
            }

            const merged = [...primaryBooks];
            const seenKeys = new Set(
                primaryBooks.map(book => `${(book.title || '').toLowerCase()}_${(book.author || '').toLowerCase()}`)
            );

            extraBooks.forEach(book => {
                const key = `${(book.title || '').toLowerCase()}_${(book.author || '').toLowerCase()}`;
                if (!seenKeys.has(key)) {
                    merged.push(book);
                    seenKeys.add(key);
                }
            });

            return merged;
        }

        function buildSearchQuery(searchTerm) {
            let query = searchTerm.trim();

            if (currentFilter === 'book') {
                query = `intitle:${query}`;
            } else if (currentFilter === 'author') {
                query = `inauthor:${query}`;
            } else if (currentFilter === 'publisher') {
                query = `inpublisher:${query}`;
            } else if (currentFilter === 'test') {
                // Test kitabƒ± i√ßin daha iyi bir query olu≈ütur
                // Kullanƒ±cƒ±nƒ±n arama terimi + test kitabƒ± anahtar kelimeleri
                if (query) {
                    query = `${query} (test OR "soru bankasƒ±" OR "soru bankasi" OR sƒ±nav OR sinav OR yks OR tyt OR ayt OR lys OR deneme OR "konu anlatƒ±mlƒ±" OR "konu anlatimli" OR √ß√∂z√ºml√º OR cozumlu OR √∂zet OR ozet OR hazƒ±rlƒ±k OR hazirlik)`;
                } else {
                    // Eƒüer arama terimi yoksa sadece test kitabƒ± anahtar kelimelerini ara
                    query = 'test OR "soru bankasƒ±" OR "soru bankasi" OR sƒ±nav OR sinav OR yks OR tyt OR ayt OR lys OR deneme OR "konu anlatƒ±mlƒ±" OR "konu anlatimli" OR √ß√∂z√ºml√º OR cozumlu OR √∂zet OR ozet OR hazƒ±rlƒ±k OR hazirlik';
                }
            }

            return query;
        }

        // Google Books API'den arama fonksiyonu
        async function searchGoogleBooks(query) {
            const maxApiResults = 40;
            let allItems = [];
            let startIndex = 0;

            // Kullanƒ±cƒ±nƒ±n se√ßtiƒüi sƒ±ralama se√ßeneƒüini kullan
            // Not: Google Books API sadece 'relevance' ve 'newest' destekliyor
            // 'popular' i√ßin 'relevance' kullanƒ±p sonra client-side sƒ±ralama yapacaƒüƒ±z
            const orderBy = currentOrderBy === 'popular' ? 'relevance' : currentOrderBy;
            
            // Yayƒ±nevi aramasƒ± i√ßin langRestrict'i kaldƒ±r (daha fazla sonu√ß i√ßin)
            const useLangRestrict = currentFilter !== 'publisher';
            const langParam = useLangRestrict ? '&langRestrict=tr' : '';
            
            let url = `${API_BASE_URL}?q=${encodeURIComponent(query)}&maxResults=${maxApiResults}&startIndex=${startIndex}${langParam}&orderBy=${orderBy}`;

            let response = await fetch(url);
            if (!response.ok) {
                return [];
            }

            let data = await response.json();
            if (data.items && data.items.length > 0) {
                allItems = [...data.items];

                // ƒ∞kinci sayfa i√ßin istek yap
                if (data.totalItems > maxApiResults && MAX_RESULTS > maxApiResults) {
                    const remainingNeeded = Math.min(MAX_RESULTS - maxApiResults, maxApiResults);
                    startIndex = maxApiResults;
                    url = `${API_BASE_URL}?q=${encodeURIComponent(query)}&maxResults=${remainingNeeded}&startIndex=${startIndex}${langParam}&orderBy=${orderBy}`;

                    try {
                        response = await fetch(url);
                        if (response.ok) {
                            data = await response.json();
                            if (data.items && data.items.length > 0) {
                                allItems = [...allItems, ...data.items];
                            }
                        }
                    } catch (e) {
                        console.warn('ƒ∞kinci sayfa y√ºklenemedi:', e);
                    }
                }
            }
            
            // Yayƒ±nevi filtresi i√ßin ek arama yap (inpublisher: ile sonu√ß az geldiyse)
            if (currentFilter === 'publisher' && allItems.length < 15) {
                const searchTerm = document.getElementById('searchInput').value.trim();
                // Genel arama ile de dene
                const generalUrl = `${API_BASE_URL}?q=${encodeURIComponent(searchTerm)}&maxResults=${maxApiResults}&orderBy=${orderBy}`;
                
                try {
                    const generalResponse = await fetch(generalUrl);
                    if (generalResponse.ok) {
                        const generalData = await generalResponse.json();
                        if (generalData.items && generalData.items.length > 0) {
                            // Yayƒ±nevi adƒ±nƒ± i√ßeren sonu√ßlarƒ± filtrele
                            const normalizedSearchTerm = normalizeTextForSearch(searchTerm);
                            const filteredItems = generalData.items.filter(item => {
                                const publisher = item.volumeInfo?.publisher || '';
                                const normalizedPublisher = normalizeTextForSearch(publisher);
                                return normalizedPublisher.includes(normalizedSearchTerm) || 
                                       normalizedSearchTerm.includes(normalizedPublisher);
                            });
                            
                            // Mevcut sonu√ßlara ekle (tekrarlarƒ± √∂nle)
                            const existingIds = new Set(allItems.map(item => item.id));
                            filteredItems.forEach(item => {
                                if (!existingIds.has(item.id)) {
                                    allItems.push(item);
                                    existingIds.add(item.id);
                                }
                            });
                        }
                    }
                } catch (e) {
                    console.warn('Ek yayƒ±nevi aramasƒ± ba≈üarƒ±sƒ±z:', e);
                }
            }

            return allItems;
        }

        // Open Library API'den kitap arama
        async function searchOpenLibrary(searchTerm, filter) {
            try {
                let searchParams = {};

                if (filter === 'author') {
                    searchParams = { author: searchTerm, limit: 30 };
                } else if (filter === 'book') {
                    searchParams = { title: searchTerm, limit: 30 };
                } else if (filter === 'publisher') {
                    // Open Library API'de publisher parametresi desteklenmiyor
                    // Genel arama yapƒ±p sonra yayƒ±nevine g√∂re filtreleyeceƒüiz
                    searchParams = { q: searchTerm, limit: 50 };
                } else {
                    // T√ºm√º veya test i√ßin genel arama
                    searchParams = { q: searchTerm, limit: 30 };
                }

                const params = new URLSearchParams(searchParams);
                const url = `${OPEN_LIBRARY_API_URL}?${params.toString()}`;

                const response = await fetch(url);
                if (!response.ok) {
                    return [];
                }

                const data = await response.json();
                if (!data.docs || data.docs.length === 0) {
                    return [];
                }
                
                // Yayƒ±nevi filtresi i√ßin, yayƒ±nevi bilgisini i√ßeren sonu√ßlarƒ± √∂ne √ßƒ±kar
                let docs = data.docs;
                if (filter === 'publisher') {
                    const normalizedSearchTerm = normalizeTextForSearch(searchTerm);
                    // Yayƒ±nevi bilgisi olan ve e≈üle≈üen kitaplarƒ± √∂ncelikli sƒ±rala
                    docs = docs.sort((a, b) => {
                        const pubA = normalizeTextForSearch((a.publisher || []).join(' '));
                        const pubB = normalizeTextForSearch((b.publisher || []).join(' '));
                        const matchA = pubA.includes(normalizedSearchTerm) || normalizedSearchTerm.split(' ').some(w => w.length > 2 && pubA.includes(w));
                        const matchB = pubB.includes(normalizedSearchTerm) || normalizedSearchTerm.split(' ').some(w => w.length > 2 && pubB.includes(w));
                        if (matchA && !matchB) return -1;
                        if (!matchA && matchB) return 1;
                        return 0;
                    });
                }

                // Open Library sonu√ßlarƒ±nƒ± Google Books formatƒ±na √ßevir
                return docs.map(doc => {
                    const title = doc.title || doc.title_suggest || '';
                    if (!title || title.trim().length === 0) {
                        return null;
                    }

                    const authors = doc.author_name || [];
                    const author = authors.length > 0 ? authors.join(', ') : 'Yazar bilgisi yok';
                    const publishedYear = doc.first_publish_year || doc.publish_year?.[0] || 'Bilinmiyor';

                    // ISBN'leri bul (hem ISBN-13 hem ISBN-10 olabilir)
                    let isbn = null;
                    let isbnType = null;
                    if (doc.isbn && Array.isArray(doc.isbn)) {
                        // √ñnce 13 haneli ISBN'i ara
                        isbn = doc.isbn.find(i => i && i.length === 13);
                        if (isbn) {
                            isbnType = 'ISBN_13';
                        } else {
                            // 10 haneli ISBN'i ara
                            isbn = doc.isbn.find(i => i && i.length === 10);
                            if (isbn) {
                                isbnType = 'ISBN_10';
                            } else {
                                // ƒ∞lk ge√ßerli ISBN'i al
                                isbn = doc.isbn.find(i => i && (i.length === 10 || i.length === 13));
                                if (isbn) {
                                    isbnType = isbn.length === 13 ? 'ISBN_13' : 'ISBN_10';
                                }
                            }
                        }
                    }

                    // Kapak resmi URL'i
                    let thumbnail = null;
                    if (doc.cover_i) {
                        thumbnail = `https://covers.openlibrary.org/b/id/${doc.cover_i}-L.jpg`;
                    } else if (isbn) {
                        thumbnail = `https://covers.openlibrary.org/b/isbn/${isbn}-L.jpg`;
                    }

                    // √ñzet
                    const description = doc.first_sentence?.[0] || doc.subtitle || 'Bu kitap hakkƒ±nda √∂zet bilgisi bulunmamaktadƒ±r.';
                    
                    // Yayƒ±nevi bilgisi
                    const publishers = doc.publisher || [];
                    const publisher = publishers.length > 0 ? publishers[0] : '';

                    return {
                        volumeInfo: {
                            title: title,
                            authors: authors,
                            publisher: publisher,
                            publishedDate: publishedYear.toString(),
                            description: description,
                            imageLinks: thumbnail ? { thumbnail: thumbnail, medium: thumbnail, large: thumbnail, extraLarge: thumbnail } : null,
                            industryIdentifiers: isbn ? [
                                { type: isbnType, identifier: isbn }
                            ] : null,
                            averageRating: 0,
                            ratingsCount: 0
                        },
                        source: 'openlibrary'
                    };
                }).filter(item => item !== null && item.volumeInfo.title);
            } catch (error) {
                console.error('Open Library API hatasƒ±:', error);
                return [];
            }
        }

        function extractYearFromDate(dateString) {
            if (!dateString) return 'Bilinmiyor';
            const match = dateString.match(/\d{4}/);
            if (match) {
                return match[0];
            }
            const normalized = dateString.replace(/[^\d]/g, '');
            if (normalized.length >= 4) {
                return normalized.substring(0, 4);
            }
            return 'Bilinmiyor';
        }

        // Akƒ±llƒ± √∂zet kesme fonksiyonu - c√ºmle veya kelime sonunda keser
        function truncateSummary(text, maxLength = 200) {
            if (!text) return '';
            
            // HTML etiketlerini temizle
            const cleaned = text.replace(/<[^>]*>?/gm, ' ').replace(/\s+/g, ' ').trim();
            
            // Zaten yeterince kƒ±sa
            if (cleaned.length <= maxLength) {
                return cleaned;
            }
            
            // maxLength'e kadar al
            let truncated = cleaned.substring(0, maxLength);
            
            // Son c√ºmle sonunu bul (. ! ? karakterleri)
            const lastSentenceEnd = Math.max(
                truncated.lastIndexOf('. '),
                truncated.lastIndexOf('! '),
                truncated.lastIndexOf('? '),
                truncated.lastIndexOf('."'),
                truncated.lastIndexOf('.)'),
            );
            
            // C√ºmle sonu bulunduysa ve √ßok kƒ±sa deƒüilse orada kes
            if (lastSentenceEnd > maxLength * 0.4) {
                return truncated.substring(0, lastSentenceEnd + 1).trim();
            }
            
            // C√ºmle sonu bulunamadƒ±, son kelimeyi bul
            const lastSpace = truncated.lastIndexOf(' ');
            if (lastSpace > maxLength * 0.6) {
                return truncated.substring(0, lastSpace).trim() + '...';
            }
            
            // Hi√ßbir ≈üey bulunamadƒ±, direkt kes
            return truncated.trim() + '...';
        }

        function sanitizeSummary(text) {
            if (!text) {
                return 'Bu kitap hakkƒ±nda √∂zet bilgisi bulunmamaktadƒ±r.';
            }
            const withoutHtml = text.replace(/<[^>]*>?/gm, ' ');
            const normalized = withoutHtml.replace(/\s+/g, ' ').trim();
            if (!normalized) {
                return 'Bu kitap hakkƒ±nda √∂zet bilgisi bulunmamaktadƒ±r.';
            }
            return truncateSummary(normalized, 400);
        }

        function convertApiItemToBook(item) {
            if (!item || !item.volumeInfo) return null;

            const info = item.volumeInfo;
            const title = (info.title || '').trim();
            const authors = Array.isArray(info.authors) ? info.authors : [];
            const author = authors.length > 0 ? authors.join(', ') : 'Yazar bilgisi yok';
            const descriptionRaw = info.description || info.subtitle || '';
            const description = Array.isArray(descriptionRaw) ? descriptionRaw.join(' ') : descriptionRaw;

            if (!isValidBook(title, author, description)) {
                return null;
            }

            const publishedDate = info.publishedDate || '';
            const year = extractYearFromDate(publishedDate);

            const identifiers = Array.isArray(info.industryIdentifiers) ? info.industryIdentifiers : [];
            const isbn13Entry = identifiers.find(id => id.type === 'ISBN_13');
            const isbn10Entry = identifiers.find(id => id.type === 'ISBN_10');
            const isbn13 = isbn13Entry ? isbn13Entry.identifier : null;
            const isbn10 = isbn10Entry ? isbn10Entry.identifier : null;
            const isbn = isbn13 || isbn10 || null;

            const imageLinks = info.imageLinks || {};
            const imageCandidates = [
                imageLinks.extraLarge,
                imageLinks.large,
                imageLinks.medium,
                imageLinks.small,
                imageLinks.thumbnail,
                imageLinks.smallThumbnail
            ].filter(Boolean);

            let thumbnail = imageCandidates.length > 0 ? imageCandidates[0] : null;
            const fallbackUrls = [];

            imageCandidates.slice(1).forEach(url => {
                if (url && !fallbackUrls.includes(url)) {
                    fallbackUrls.push(url);
                }
            });

            if (!thumbnail && isbn) {
                thumbnail = getBookCoverFromMultipleSources(isbn, isbn13, isbn10);
            }

            if (isbn) {
                const isbnFallbacks = getBookCoverFallbackUrls(isbn, isbn13, isbn10);
                isbnFallbacks.forEach(url => {
                    if (url && !fallbackUrls.includes(url)) {
                        fallbackUrls.push(url);
                    }
                });
            }

            const averageRating = info.averageRating || 0;
            const ratingsCount = info.ratingsCount || 0;
            const popularityScore = ratingsCount > 0 ? Math.round((averageRating * ratingsCount) / 100) : 0;

            return {
                title: title || 'ƒ∞simsiz',
                author,
                year: year || 'Bilinmiyor',
                summary: sanitizeSummary(description),
                thumbnail: thumbnail || null,
                fallbackUrls,
                isbn,
                isbn13,
                isbn10,
                pageCount: info.pageCount || null,
                publisher: info.publisher || '',
                categories: info.categories || [],
                averageRating,
                ratingsCount,
                popularityScore,
                language: info.language || '',
                previewLink: info.previewLink || '',
                infoLink: info.infoLink || item.selfLink || '',
                source: item.source || 'google',
                isTestBook: isTestBook(title, description),
                isPopularInStores: false
            };
        }

        function buildBooksFromApiResults(apiItems = [], searchTerm = '') {
            let formattedBooks = Array.isArray(apiItems)
                ? apiItems.map(convertApiItemToBook).filter(Boolean)
                : [];

            if (formattedBooks.length === 0 && currentFilter === 'test') {
                return getCuratedTestBooks(searchTerm).slice(0, MAX_RESULTS);
            }

            let booksToShow = formattedBooks;

            if (currentFilter === 'test') {
                const curated = getCuratedTestBooks(searchTerm);
                const apiTestBooks = formattedBooks.filter(book => book.isTestBook);
                booksToShow = mergeUniqueBooks(curated, apiTestBooks);
            }
            
            // Yayƒ±nevi filtresi i√ßin client-side filtreleme ve k√ºt√ºphane aramasƒ±
            if (currentFilter === 'publisher' && searchTerm) {
                const normalizedSearchTerm = normalizeTextForSearch(searchTerm);
                
                // √ñnce kendi k√ºt√ºphanemizden (test kitaplarƒ± + ke≈üfet) yayƒ±nevine g√∂re ara
                const curatedPublisherBooks = getCuratedBooksByPublisher(searchTerm);
                
                // API sonu√ßlarƒ±ndan yayƒ±nevi bilgisi e≈üle≈üen kitaplarƒ± al
                const publisherMatches = formattedBooks.filter(book => {
                    const publisher = book.publisher || '';
                    const normalizedPublisher = normalizeTextForSearch(publisher);
                    // Yayƒ±nevi adƒ± arama terimini i√ßeriyor mu veya tam e≈üle≈üme var mƒ±?
                    return normalizedPublisher.includes(normalizedSearchTerm) || 
                           normalizedSearchTerm.includes(normalizedPublisher) ||
                           // Kƒ±smi e≈üle≈üme kontrol√º (kelime bazlƒ±)
                           normalizedSearchTerm.split(' ').some(word => 
                               word.length > 2 && normalizedPublisher.includes(word)
                           );
                });
                
                // K√ºt√ºphane sonu√ßlarƒ±nƒ± √∂ncelikli olarak birle≈ütir
                if (curatedPublisherBooks.length > 0 || publisherMatches.length > 0) {
                    // √ñnce k√ºt√ºphane sonu√ßlarƒ±, sonra API sonu√ßlarƒ±
                    booksToShow = mergeUniqueBooks(curatedPublisherBooks, publisherMatches);
                    
                    // Sƒ±rala: tam e≈üle≈üenler √∂nce
                    booksToShow.sort((a, b) => {
                        const pubA = normalizeTextForSearch(a.publisher || '');
                        const pubB = normalizeTextForSearch(b.publisher || '');
                        const exactMatchA = pubA === normalizedSearchTerm || pubA.includes(normalizedSearchTerm);
                        const exactMatchB = pubB === normalizedSearchTerm || pubB.includes(normalizedSearchTerm);
                        if (exactMatchA && !exactMatchB) return -1;
                        if (!exactMatchA && exactMatchB) return 1;
                        return 0;
                    });
                } else {
                    // Yayƒ±nevi e≈üle≈ümesi bulunamadƒ±ysa, ba≈ülƒ±k veya yazarda yayƒ±nevi adƒ± ge√ßenleri de dahil et
                    const titleAuthorMatches = formattedBooks.filter(book => {
                        const title = normalizeTextForSearch(book.title || '');
                        const author = normalizeTextForSearch(book.author || '');
                        return title.includes(normalizedSearchTerm) || author.includes(normalizedSearchTerm);
                    });
                    booksToShow = titleAuthorMatches.length > 0 ? titleAuthorMatches : formattedBooks;
                }
            }

            const uniqueBooks = [];
            const seenKeys = new Set();

            booksToShow.forEach(book => {
                const key = `${(book.title || '').toLowerCase()}_${(book.author || '').toLowerCase()}`;
                if (!seenKeys.has(key)) {
                    seenKeys.add(key);
                    uniqueBooks.push(book);
                }
            });
            
            // Pop√ºlerlik sƒ±ralamasƒ± (currentOrderBy === 'popular' ise)
            if (currentOrderBy === 'popular') {
                uniqueBooks.sort((a, b) => {
                    // √ñncelik sƒ±rasƒ±: ratingsCount > averageRating > popularityScore
                    const scoreA = (a.ratingsCount || 0) * 10 + (a.averageRating || 0) * 100 + (a.popularityScore || 0);
                    const scoreB = (b.ratingsCount || 0) * 10 + (b.averageRating || 0) * 100 + (b.popularityScore || 0);
                    return scoreB - scoreA; // Y√ºksekten d√º≈ü√ºƒüe
                });
            }

            return uniqueBooks.slice(0, MAX_RESULTS);
        }

        async function searchBooks() {
            // √áift tƒ±klama korumasƒ±: Eƒüer zaten bir arama yapƒ±lƒ±yorsa, yeni arama ba≈ülatma
            if (isSearching) {
                return;
            }

            const searchTerm = document.getElementById('searchInput').value.trim();
            const resultsNormal = document.getElementById('results-normal');
            const resultsRandom = document.getElementById('results-random');
            const resultsTrend = document.getElementById('results-trend');
            const searchBtn = document.getElementById('searchBtn');

            // Container'larƒ± y√∂net: Normal g√∂ster, diƒüerlerini gizle
            if (resultsNormal) resultsNormal.style.display = 'block';
            if (resultsRandom) resultsRandom.style.display = 'none';
            if (resultsTrend) resultsTrend.style.display = 'none';

            if (!searchTerm) {
                if (resultsNormal) {
                    resultsNormal.innerHTML = '<div class="no-results" role="status" aria-live="polite">L√ºtfen arama terimi girin.</div>';
                }
                isSearching = false; // Flag'i sƒ±fƒ±rla
                return;
            }

            // G√ºvenlik: Arama terimi maksimum uzunluk kontrol√º
            const MAX_SEARCH_LENGTH = 100;
            if (searchTerm.length > MAX_SEARCH_LENGTH) {
                if (resultsNormal) {
                    resultsNormal.innerHTML = `<div class="no-results" role="status" aria-live="polite">Arama terimi √ßok uzun. Maksimum ${MAX_SEARCH_LENGTH} karakter kullanabilirsiniz.<br><small>Girdiƒüiniz terim: ${searchTerm.length} karakter</small></div>`;
                }
                isSearching = false; // Flag'i sƒ±fƒ±rla
                if (searchBtn) {
                    searchBtn.disabled = false;
                    searchBtn.textContent = 'Ara';
                    searchBtn.setAttribute('aria-label', 'Ara');
                }
                return;
            }

            // Arama ba≈üladƒ±: flag'i true yap ve butonu disable et
            isSearching = true;
            if (searchBtn) {
                searchBtn.disabled = true;
                searchBtn.textContent = 'Aranƒ±yor...';
                searchBtn.setAttribute('aria-label', 'Arama yapƒ±lƒ±yor, l√ºtfen bekleyin');
            }
            if (window.AndroidBridge && typeof AndroidBridge.onSearchTriggered === 'function') {
                AndroidBridge.onSearchTriggered();
            }

            // S√∂z havuzu - Atat√ºrk s√∂z√º her zaman ilk sƒ±rada
            const ataturkQuote = "Uyuyan milletler ya √∂l√ºr, ya da k√∂le olarak uyanƒ±rlar.";
            const otherQuotes = [
                "Su√ß ve Ceza: ƒ∞nsanƒ±n kendi i√ß sesi en y√ºksek mahkemedir.",
                "D√∂n√º≈ü√ºm: ƒ∞nsan bazen uyandƒ±ƒüƒ±nda sadece ger√ßek y√ºz√ºn√º g√∂r√ºr.",
                "Dirili≈ü: ƒ∞nsanƒ±n kendini bulmasƒ±, ba≈ükalarƒ±nƒ± anlamasƒ±yla ba≈ülar.",
                "K√ºrk Mantolu Madonna: A≈ük, bazen sessizliƒüin en y√ºksek sesidir.",
                "Sefiller: Kalbinle sev, √ß√ºnk√º akƒ±l √ßoƒüu zaman yanƒ±lƒ±r.",
                "Tutunamayanlar: ƒ∞nsan bazen kendini bile anlayamaz."
            ];
            const randomOtherQuote = otherQuotes[Math.floor(Math.random() * otherQuotes.length)];
            const selectedQuote = ataturkQuote;
            if (resultsNormal) {
                resultsNormal.innerHTML = '<div class="loading" role="status" aria-live="polite">Aranƒ±yor... ‚Äî <span style="opacity: 0.75; font-size: 0.9em; font-style: italic; margin-left: 4px;">"' + selectedQuote + '"</span></div>';
            }

            // Arama ge√ßmi≈üine ekle
            addToSearchHistory(searchTerm);
            hideSearchHistory(); // Dropdown'ƒ± kapat

            // Arama sayacƒ±nƒ± artƒ±r
            let c = Number(localStorage.getItem("searchCount") || 0);
            localStorage.setItem("searchCount", c + 1);
            
            // Yeni rozet kazanƒ±ldƒ± mƒ± kontrol et (kƒ±rmƒ±zƒ± bildirim noktasƒ±)
            checkForNewBadges();

            try {
                const query = buildSearchQuery(searchTerm);

                // Paralel olarak hem Google Books hem Open Library'den ara
                const [googleBooksResult, openLibraryResult] = await Promise.allSettled([
                    searchGoogleBooks(query),
                    searchOpenLibrary(searchTerm, currentFilter)
                ]);

                // Sonu√ßlarƒ± birle≈ütir
                let allItems = [];
                if (googleBooksResult.status === 'fulfilled') {
                    allItems = [...allItems, ...googleBooksResult.value];
                }
                if (openLibraryResult.status === 'fulfilled') {
                    allItems = [...allItems, ...openLibraryResult.value];
                }

                const booksToShow = buildBooksFromApiResults(allItems, searchTerm);

                if (!booksToShow || booksToShow.length === 0) {
                    currentBooks = [];
                    if (resultsNormal) {
                        const safeTerm = escapeHtml(searchTerm);
                        resultsNormal.innerHTML = `<div class="no-results" role="status" aria-live="polite">"${safeTerm}" i√ßin sonu√ß bulunamadƒ±.<br><small>Farklƒ± anahtar kelimeler veya filtreler denemeyi d√º≈ü√ºnebilirsiniz.</small></div>`;
                    }
                    return;
                }

                matchWithPopularBooks(booksToShow);
                currentBooks = booksToShow;
                displayResults(booksToShow);
            } catch (error) {
                console.error('Hata:', error);
                if (resultsNormal) {
                    resultsNormal.innerHTML = '<div class="no-results" role="status" aria-live="polite">Bir hata olu≈ütu. L√ºtfen tekrar deneyin.<br><small>' + escapeHtml(error.message) + '</small></div>';
                }
            } finally {
                // Arama bitti: flag'i false yap ve butonu tekrar aktif et
                isSearching = false;
                if (searchBtn) {
                    searchBtn.disabled = false;
                    searchBtn.textContent = 'Ara';
                    searchBtn.setAttribute('aria-label', 'Ara');
                }
            }
        }

        function buildPurchaseLinks(book) {
            // Kitap adƒ±nƒ± temizle (gereksiz karakterleri kaldƒ±r)
            function cleanBookTitle(title) {
                if (!title) return '';
                // Fazla bo≈üluklarƒ± temizle, √∂zel karakterleri koru
                return title.trim().replace(/\s+/g, ' ');
            }

            // Yazar adƒ±nƒ± temizle
            function cleanAuthorName(author) {
                if (!author || author.toLowerCase().includes('yazar bilgisi yok')) return '';
                // ƒ∞lk yazarƒ± al ve temizle
                const firstAuthor = author.split(',')[0].trim();
                // "Yazar:" gibi √∂n ekleri kaldƒ±r
                return firstAuthor.replace(/^yazar:\s*/i, '').trim();
            }

            // √ñncelik sƒ±rasƒ±: ISBN > Kitap Adƒ± + Yazar > Sadece Kitap Adƒ±
            let searchQuery = '';
            // cleanTitle'ƒ± her durumda kullanmak i√ßin ba≈üta tanƒ±mla
            const cleanTitle = cleanBookTitle(book.title);

            if (book.isbn) {
                // ISBN ile arama (en kesin sonu√ß)
                searchQuery = book.isbn.replace(/[-\s]/g, ''); // ISBN'deki tire ve bo≈üluklarƒ± kaldƒ±r
            } else {
                // Kitap adƒ± ve yazar ile arama (daha spesifik)
                const authorFirst = cleanAuthorName(book.author);
                if (authorFirst) {
                    searchQuery = `${cleanTitle} ${authorFirst}`;
                } else {
                    searchQuery = cleanTitle;
                }
            }

            // Android kontrol√º (t√ºm linklerde kullanƒ±lacak)
            const isAndroid = /Android/i.test(navigator.userAgent);
            
            // D&R linki - ISBN yerine kitap adƒ± + yazar kullan (D&R ISBN aramasƒ±nda sorun var)
            const drAuthor = cleanAuthorName(book.author);
            let drSearchQuery = cleanTitle;
            if (drAuthor && drAuthor.length > 0) {
                drSearchQuery = `${cleanTitle} ${drAuthor}`;
            }
            const drLink = `https://www.dr.com.tr/search?q=${encodeURIComponent(drSearchQuery)}`;

            // BKM Kitap linki - ISBN yerine kitap adƒ± + yazar kullan (daha g√ºvenilir sonu√ß)
            const bkmAuthor = cleanAuthorName(book.author);
            let bkmSearchQuery = cleanTitle;
            if (bkmAuthor && bkmAuthor.length > 0) {
                // √áok uzun ba≈ülƒ±klarƒ± kƒ±salt
                let bkmTitle = cleanTitle;
                if (cleanTitle.length > 50) {
                    const titleWords = cleanTitle.split(' ');
                    bkmTitle = titleWords.slice(0, 6).join(' ');
                }
                bkmSearchQuery = `${bkmTitle} ${bkmAuthor}`;
            }
            let bkmLink = `https://www.bkmkitap.com/arama?q=${encodeURIComponent(bkmSearchQuery.trim())}`;
            
            // BKM Kitap i√ßin Android deep linking
            const bkmWebUrl = bkmLink;
            if (isAndroid) {
                // BKM i√ßin Intent ile web URL'i a√ß (app link sistemi kullanƒ±lacak)
                bkmLink = bkmWebUrl; // Intent ile a√ßƒ±lacak
            }

            // Kitapyurdu linki - ISBN yerine kitap adƒ± + yazar kullan (daha g√ºvenilir sonu√ß)
            const kyAuthor = cleanAuthorName(book.author);
            let kitapyurduLink = '';
            if (kyAuthor && kyAuthor.length > 0) {
                // Kitapyurdu'nda kitap adƒ± ve yazar ayrƒ± parametrelerle arama
                kitapyurduLink = `https://www.kitapyurdu.com/index.php?route=product/search&filter_name=${encodeURIComponent(cleanTitle)}&filter_author=${encodeURIComponent(kyAuthor)}`;
            } else {
                kitapyurduLink = `https://www.kitapyurdu.com/index.php?route=product/search&filter_name=${encodeURIComponent(cleanTitle)}`;
            }
            
            // Kitapyurdu linki - normal web URL (MainActivity'de √∂zel i≈ülem yapƒ±lacak)
            // kitapyurduLink zaten web URL'i

            // Ortak optimizasyon fonksiyonu - Trendyol ve Hepsi Burada i√ßin
            // Sorun: "Portakal" gibi genel kelimeler ba≈üka √ºr√ºnler getiriyor
            // √á√∂z√ºm: Kitap adƒ± + yazar + "kitap" kelimesi ekle
            function optimizeTitleForEcommerce(title, authorName) {
                if (!title || title.trim().length === 0) return 'kitap';
                
                // Alt ba≈ülƒ±klarƒ± kaldƒ±r: ":" veya " - " sonrasƒ±
                let optimized = title.trim();
                
                // √ñnce ":" kontrol√º (alt ba≈ülƒ±k ayracƒ±)
                const colonIndex = optimized.indexOf(':');
                if (colonIndex > 0 && colonIndex < 50) {
                    optimized = optimized.substring(0, colonIndex).trim();
                }
                
                // Sonra " - " kontrol√º (bo≈üluklu tire - alt ba≈ülƒ±k ayracƒ±)
                const dashWithSpaceIndex = optimized.indexOf(' - ');
                if (dashWithSpaceIndex > 0 && dashWithSpaceIndex < 50) {
                    optimized = optimized.substring(0, dashWithSpaceIndex).trim();
                }
                
                // √áok uzun ba≈ülƒ±klarƒ± kƒ±salt (ilk 5 kelime veya 40 karakter)
                if (optimized.length > 40) {
                    const titleWords = optimized.split(' ').filter(word => word.length > 0);
                    if (titleWords.length > 5) {
                        optimized = titleWords.slice(0, 5).join(' ');
                    } else {
                        optimized = optimized.substring(0, 40).trim();
                    }
                }
                
                // √áok kƒ±sa kontrolleri (2 karakterden kƒ±sa ise orijinal ba≈ülƒ±ƒüƒ± kullan)
                if (optimized.length < 2) {
                    const originalWords = title.trim().split(' ').filter(word => word.length > 0);
                    optimized = originalWords.slice(0, Math.min(3, originalWords.length)).join(' ');
                }
                
                // Yazar adƒ±nƒ± temizle ve ekle
                let author = '';
                if (authorName && !authorName.toLowerCase().includes('yazar bilgisi yok')) {
                    author = authorName.split(',')[0].trim(); // ƒ∞lk yazarƒ± al
                    if (author.length > 20) {
                        // √áok uzun yazar adlarƒ±nƒ± kƒ±salt (sadece soyad)
                        const nameParts = author.split(' ');
                        if (nameParts.length > 1) {
                            author = nameParts[nameParts.length - 1]; // Son kelime (soyad)
                        }
                    }
                }
                
                // "kitap" kelimesi zaten ba≈ülƒ±kta var mƒ± kontrol et
                const hasBookWord = optimized.toLowerCase().includes('kitap') || 
                                    optimized.toLowerCase().includes('roman') ||
                                    optimized.toLowerCase().includes('soru bankasƒ±') ||
                                    optimized.toLowerCase().includes('hikaye') ||
                                    optimized.toLowerCase().includes('√∂yk√º');
                
                // Final arama sorgusu: "kitap adƒ±" + "yazar" + "kitap"
                let finalQuery = optimized;
                
                if (author && author.length > 0) {
                    finalQuery = `${optimized} ${author}`;
                }
                
                if (!hasBookWord) {
                    finalQuery = `${finalQuery} kitap`;
                }
                
                return finalQuery.trim();
            }
            
            // Hepsi Burada linki - optimize edilmi≈ü: kitap adƒ± + yazar + "kitap"
            const optimizedTitle = optimizeTitleForEcommerce(cleanTitle, book.author);
            // Android'de HepsiBurada'nƒ±n ger√ßek app link formatƒ±: hbapp://search?searchTerm=...
            let hepsiburadaLink = `https://www.hepsiburada.com/ara?q=${encodeURIComponent(optimizedTitle)}`;
            if (isAndroid) { // isAndroid zaten yukarƒ±da tanƒ±mlƒ±
                const searchTerm = encodeURIComponent(optimizedTitle);
                hepsiburadaLink = `hbapp://search?searchTerm=${searchTerm}`;
            }

            // Trendyol linki - optimize edilmi≈ü: kitap adƒ± + yazar + "kitap"
            const trendyolWebUrl = `https://www.trendyol.com/sr?q=${encodeURIComponent(optimizedTitle)}`;
            // Android'de Trendyol'un ger√ßek app link formatƒ± (HepsiBurada gibi)
            let trendyolLink = trendyolWebUrl;
            if (isAndroid) {
                // Trendyol app link formatƒ±: trendyol://sr?q=...
                const searchTerm = encodeURIComponent(optimizedTitle);
                trendyolLink = `trendyol://sr?q=${searchTerm}`;
            }

            // Amazon linki - kitap adƒ± + yazar + "kitap"
            const amazonLink = `https://www.amazon.com.tr/s?k=${encodeURIComponent(optimizedTitle)}`;

            return { drLink, bkmLink, kitapyurduLink, hepsiburadaLink, trendyolLink, amazonLink };
        }

        // üìå Fiyat Kar≈üƒ±la≈ütƒ±rma Bile≈üeni
        function createPriceButton(book, links) {
            const btn = document.createElement("button");
            btn.className = "price-compare-btn";
            btn.innerText = "üí∞ Fiyat Kar≈üƒ±la≈ütƒ±r";

            btn.onclick = () => showPriceModal(book, links);

            return btn;
        }

        async function showPriceModal(book, links) {
            const modal = document.createElement("div");
            modal.className = "price-modal";

            // Dinamik y√ºkleme durumu i√ßin maƒüaza listesi
            const stores = [
                { name: "Amazon", key: "Amazon" },
                { name: "Kitapyurdu", key: "Kitapyurdu" },
                { name: "D&R", key: "DR" },
                { name: "Trendyol", key: "Trendyol" },
                { name: "Hepsiburada", key: "Hepsiburada" },
                { name: "BKM", key: "BKM" }
            ];

            // Loading state - dinamik ve animasyonlu
            modal.innerHTML = `
                <div class="price-content">
                    <h3>üìä Fiyat Kar≈üƒ±la≈ütƒ±rma</h3>
                    <div class="price-loading-container">
                        <div class="price-loading-spinner"></div>
                        <div class="price-loading-text" id="loadingMainText">Fiyatlar aranƒ±yor...</div>
                        <div class="price-loading-stores" id="loadingStores">
                            ${stores.map(store => `
                                <div class="price-loading-store" data-store="${store.key}">
                                    <span class="store-name">${store.name}</span>
                                    <span class="store-status">Aranƒ±yor</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <button class="close-modal">Kapat</button>
                </div>
            `;

            document.body.appendChild(modal);

            // Close handlers
            modal.querySelector(".close-modal").onclick = () => modal.remove();
            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            };

            // Dinamik y√ºkleme mesajlarƒ±
            const loadingTexts = [
                "Fiyatlar aranƒ±yor...",
                "Maƒüazalar taranƒ±yor...",
                "En iyi fiyatlar bulunuyor...",
                "Neredeyse hazƒ±r..."
            ];
            let textIndex = 0;
            const mainTextEl = document.getElementById('loadingMainText');
            let textInterval = null;
            if (mainTextEl) {
                textInterval = setInterval(() => {
                    textIndex = (textIndex + 1) % loadingTexts.length;
                    mainTextEl.textContent = loadingTexts[textIndex];
                }, 2000);
            }

            // Maƒüaza durumlarƒ±nƒ± g√ºncelle
            const updateStoreStatus = (storeKey, status) => {
                const storeEl = modal.querySelector(`[data-store="${storeKey}"]`);
                if (storeEl) {
                    const statusEl = storeEl.querySelector('.store-status');
                    if (statusEl) {
                        statusEl.textContent = status;
                        if (status === 'Bulundu ‚úì') {
                            storeEl.classList.add('active');
                            statusEl.style.color = '#1db954';
                        } else if (status === 'Aranƒ±yor' || status === 'Aranƒ±yor...') {
                            statusEl.style.color = '#1db954';
                        } else if (status === 'Bulunamadƒ±') {
                            statusEl.style.color = '#999';
                        }
                    }
                }
            };

            // Maƒüaza durumlarƒ±nƒ± ba≈ülat (rastgele sƒ±rayla)
            stores.forEach((store, index) => {
                setTimeout(() => {
                    updateStoreStatus(store.key, 'Aranƒ±yor...');
                }, index * 200 + Math.random() * 300);
            });

            try {
                // API'den fiyatlarƒ± √ßek (Port 3002 - Hybrid scraper)
                const response = await fetch(`http://localhost:3002/api/price?name=${encodeURIComponent(book.title)}`);
                const prices = await response.json();
                
                // Y√ºkleme mesajƒ±nƒ± durdur
                if (textInterval) {
                    clearInterval(textInterval);
                }

                // Fiyatlarƒ± bulundu olarak i≈üaretle (animasyonlu)
                Object.entries(prices).forEach(([store, data], index) => {
                    setTimeout(() => {
                        const storeKey = stores.find(s => s.name === store)?.key || store;
                        const price = typeof data === 'object' ? (data?.price || "-") : data;
                        if (price !== "-" && price !== null && price !== undefined) {
                            updateStoreStatus(storeKey, 'Bulundu ‚úì');
                        } else {
                            updateStoreStatus(storeKey, 'Bulunamadƒ±');
                        }
                    }, index * 150);
                });

                // Maƒüaza linklerini hazƒ±rla (6 maƒüaza)
                const storeLinks = {
                    "Amazon": links.amazonLink || "#",
                    "Kitapyurdu": links.kitapyurduLink || "#",
                    "DR": links.drLink || "#",
                    "Trendyol": links.trendyolLink || "#",
                    "Hepsiburada": links.hepsiburadaLink || "#",
                    "BKM": links.bkmLink || "#"
                };

                // Kƒ±sa bir gecikme sonra sonu√ßlarƒ± g√∂ster (animasyon i√ßin)
                setTimeout(() => {
                    // Modal i√ßeriƒüini g√ºncelle - Sepete Git butonu ile
                    modal.innerHTML = `
                    <div class="price-content">
                        <h3>üìä Fiyat Kar≈üƒ±la≈ütƒ±rma</h3>
                        ${Object.entries(prices).map(([store, data]) => {
                            // Eski format (sadece string) veya yeni format (obje) desteƒüi
                            const price = typeof data === 'string' ? data : (data?.price || "-");
                            const productLink = typeof data === 'object' ? (data?.link || data?.deeplink || storeLinks[store]) : (storeLinks[store] || "#");
                            const deeplink = typeof data === 'object' ? (data?.deeplink || data?.link) : null;
                            const cartLink = typeof data === 'object' ? (data?.cartLink || data?.link) : null;
                            // Sepete ekleme i√ßin √∂ncelik: cartLink > deeplink > productLink
                            const finalLink = cartLink || deeplink || productLink || "#";
                            
                            return `
                            <div class="price-row">
                                <span>${escapeHtml(store)}</span>
                                <strong>${price === "-" ? "-" : "‚Ç∫" + escapeHtml(price)}</strong>
                                ${price !== "-" ? `<button class="go-buy-btn" onclick="(function(){const link='${finalLink}';if(link&&(link.startsWith('trendyol://')||link.startsWith('hepsiburada://'))){window.location.href=link;}else if(link&&link!=='#'&&link!=='null'){window.open(link,'_blank');}})()">üõí Sepete Ekle</button>` : '<span>-</span>'}
                            </div>
                        `;
                        }).join("")}
                            <button class="close-modal">Kapat</button>
                        </div>
                    `;

                    // Close handlers'ƒ± yeniden ekle
                    modal.querySelector(".close-modal").onclick = () => modal.remove();
                    modal.onclick = (e) => {
                        if (e.target === modal) {
                            modal.remove();
                        }
                    };
                }, 1200);
            } catch (error) {
                console.error("Fiyat y√ºkleme hatasƒ±:", error);
                clearInterval(textInterval);
                
                // T√ºm maƒüazalarƒ± hata olarak i≈üaretle
                stores.forEach(store => {
                    updateStoreStatus(store.key, 'Hata ‚úó');
                });
                
                // Hata durumunda fallback g√∂ster
                setTimeout(() => {
                    modal.innerHTML = `
                        <div class="price-content">
                            <h3>üìä Fiyat Kar≈üƒ±la≈ütƒ±rma</h3>
                            <div style="text-align: center; padding: 20px; color: var(--text-primary);">
                                <div style="font-size: 2em; margin-bottom: 10px;">‚ö†Ô∏è</div>
                                <div>Fiyatlar y√ºklenemedi. L√ºtfen daha sonra tekrar deneyin.</div>
                            </div>
                            <button class="close-modal">Kapat</button>
                        </div>
                    `;
                    modal.querySelector(".close-modal").onclick = () => modal.remove();
                }, 1000);
            }
        }

        function getBookCoverInitials(title) {
            // Kitap ba≈ülƒ±ƒüƒ±nƒ±n ilk harflerini al (maksimum 2 harf)
            if (!title || title.trim().length === 0) {
                return 'KB';
            }

            // Sadece harf ve sayƒ±larƒ± al
            const cleanTitle = title.trim().replace(/[^a-zA-Z√ßƒüƒ±√∂≈ü√º√áƒûIƒ∞√ñ≈û√ú0-9\s]/g, '');
            const words = cleanTitle.split(/\s+/).filter(word => word.length > 0);

            if (words.length >= 2) {
                // ƒ∞ki kelime varsa, her birinin ilk harfini al
                const first = words[0][0] || '';
                const second = words[1][0] || '';
                if (first && second) {
                    return (first + second).toUpperCase();
                }
            }

            if (words.length === 1 && words[0].length >= 2) {
                // Tek kelime varsa, ilk 2 harfini al
                return words[0].substring(0, 2).toUpperCase();
            } else if (words.length === 1 && words[0].length === 1) {
                // Tek harf varsa, onu iki kez g√∂ster
                return (words[0] + words[0]).toUpperCase();
            }

            // Varsayƒ±lan olarak "KB" (Kitap)
            return 'KB';
        }

        function createPlaceholderImage(title, show = false, id = '') {
            const initials = getBookCoverInitials(title);
            const showClass = show ? 'show' : '';
            const idAttr = id ? `id="${id}"` : '';
            return `<div class="book-cover-placeholder ${showClass}" ${idAttr}>${escapeHtml(initials)}</div>`;
        }

        function displayResults(books, isFavoritesView = false) {
            const containerId = isFavoritesView ? 'favoritesContainer' : 'results-normal';
            const resultsContainer = document.getElementById(containerId);
            const uniqueId = isFavoritesView ? 'fav' : 'res';

            resultsContainer.innerHTML = books.map((book, index) => {
                // G√∂rsel y√ºkleme i√ßin daha iyi bir mekanizma
                let coverImage = '';
                const placeholderId = `placeholder-${uniqueId}-${index}`;
                const imageId = `image-${uniqueId}-${index}`;
                const favoriteId = `favorite-${uniqueId}-${index}`;
                const bookId = book.isbn || `${book.title}_${book.author}`;
                const isFav = isFavorite(book);

                if (book.thumbnail) {
                    // G√∂rsel varsa, y√ºkleme hatasƒ± durumunda placeholder g√∂ster
                    // ISBN varsa alternatif g√∂rsel kaynaƒüƒ± da dene
                    let imageSrc = book.thumbnail;
                    let fallbackSrc = '';

                    // Fallback URL'leri kullan (birden fazla kaynak)
                    const fallbackUrls = book.fallbackUrls || [];
                    if (fallbackUrls.length > 0) {
                        fallbackSrc = fallbackUrls[0]; // ƒ∞lk fallback URL'i kullan
                    } else if (book.isbn) {
                        // Eƒüer fallback URL'leri yoksa, ISBN ile olu≈ütur
                        const cleanIsbn = book.isbn.replace(/[-\s]/g, '');
                        fallbackSrc = `https://covers.openlibrary.org/b/isbn/${cleanIsbn}-L.jpg`;
                    }

                    coverImage = `<img id="${imageId}"
                                      src="${imageSrc}"
                                      alt="${escapeHtml(book.title)}"
                                      class="book-cover"
                                      loading="lazy"
                                      onerror="const img = document.getElementById('${imageId}'); const pl = document.getElementById('${placeholderId}'); ${fallbackSrc ? `if(img && img.src !== '${fallbackSrc}') { img.src = '${fallbackSrc}'; } else {` : ''} if(img) img.style.display='none'; if(pl) pl.classList.add('show'); ${fallbackSrc ? '}' : ''}">
                                  ${createPlaceholderImage(book.title, false, placeholderId)}`;
                } else {
                    // G√∂rsel yoksa, fallback URL'leri veya ISBN ile diƒüer kaynaklardan dene
                    const fallbackUrls = book.fallbackUrls || [];
                    if (fallbackUrls.length > 0) {
                        // Birden fazla fallback URL'i var, sƒ±rayla dene
                        const firstUrl = fallbackUrls[0];
                        const remainingUrls = fallbackUrls.slice(1);
                        let onErrorCode = '';

                        if (remainingUrls.length > 0) {
                            // Birden fazla fallback URL'i varsa, sƒ±rayla dene
                            onErrorCode = `const img = document.getElementById('${imageId}'); const urls = ${JSON.stringify(remainingUrls)}; let currentIndex = 0; if(img && currentIndex < urls.length) { img.src = urls[currentIndex]; currentIndex++; } else { if(img) img.style.display='none'; const pl = document.getElementById('${placeholderId}'); if(pl) pl.classList.add('show'); }`;
                        } else {
                            // Tek fallback URL'i varsa
                            onErrorCode = `const img = document.getElementById('${imageId}'); const pl = document.getElementById('${placeholderId}'); if(img) img.style.display='none'; if(pl) pl.classList.add('show');`;
                        }

                        coverImage = `<img id="${imageId}"
                                          src="${firstUrl}"
                                          alt="${escapeHtml(book.title)}"
                                          class="book-cover"
                                          loading="lazy"
                                          onerror="${onErrorCode}">
                                      ${createPlaceholderImage(book.title, false, placeholderId)}`;
                    } else if (book.isbn) {
                        // Fallback URL'leri yoksa, ISBN ile Open Library'den dene
                        const cleanIsbn = book.isbn.replace(/[-\s]/g, '');
                        const openLibrarySrc = `https://covers.openlibrary.org/b/isbn/${cleanIsbn}-L.jpg`;
                        coverImage = `<img id="${imageId}"
                                          src="${openLibrarySrc}"
                                          alt="${escapeHtml(book.title)}"
                                          class="book-cover"
                                          loading="lazy"
                                          onerror="const img = document.getElementById('${imageId}'); const pl = document.getElementById('${placeholderId}'); if(img) img.style.display='none'; if(pl) pl.classList.add('show');">
                                      ${createPlaceholderImage(book.title, false, placeholderId)}`;
                    } else {
                        // G√∂rsel yoksa direkt placeholder g√∂ster
                        coverImage = createPlaceholderImage(book.title, true, placeholderId);
                    }
                }

                const links = buildPurchaseLinks(book);
                const favoriteClass = isFav ? 'active' : '';
                const favoriteIcon = isFav ? '‚≠ê' : '‚òÜ';

                // Maƒüazalarda pop√ºler olup olmadƒ±ƒüƒ±nƒ± kontrol et
                const isPopular = book.isPopularInStores || false;
                const popularBadge = isPopular ? '<span class="popular-badge" title="Maƒüazalarda pop√ºler">üî• Pop√ºler</span>' : '';

                // BookId'yi g√ºvenli bir ≈üekilde encode et
                const safeBookId = bookId.replace(/'/g, "\\'");

                // Favoriler g√∂r√ºn√ºm√º i√ßin k√º√ß√ºk kart class'ƒ±
                const favoriteSmallClass = isFavoritesView ? 'favorite-small' : '';

                return `
                <div class="book-card ${isPopular ? 'popular-book' : ''} ${favoriteSmallClass}" role="listitem" data-book-id="${escapeHtml(bookId)}" aria-label="Kitap: ${escapeHtml(book.title)}, Yazar: ${escapeHtml(book.author)}">
                    <button class="favorite-btn ${favoriteClass}"
                            id="${favoriteId}"
                            onclick="toggleFavorite(${index}, ${isFavoritesView}, event)"
                            aria-label="${isFav ? 'Favorilerden √ßƒ±kar' : 'Favorilere ekle'}"
                            title="${isFav ? 'Favorilerden √ßƒ±kar' : 'Favorilere ekle'}">
                        ${favoriteIcon}
                    </button>
                    ${coverImage}
                    <div class="book-info">
                        <div class="book-title">
                            ${escapeHtml(book.title)}
                            ${popularBadge}
                        </div>
                        <div class="book-author">Yazar: ${escapeHtml(book.author)}</div>
                        <div class="book-year">Basƒ±m Yƒ±lƒ±: ${escapeHtml(book.year)}${book.publisher ? ` ‚Ä¢ Yayƒ±nevi: ${escapeHtml(book.publisher)}` : ''}</div>
                        <div class="book-summary">${escapeHtml(book.summary)}</div>
                        <div class="purchase-links" role="group" aria-label="Satƒ±n alma linkleri">
                            <a href="${links.drLink}"
                               target="_blank"
                               rel="noopener noreferrer"
                               class="purchase-link dr-link"
                               aria-label="D&R'da ${escapeHtml(book.title)} kitabƒ±nƒ± satƒ±n al">D&R</a>
                            <a href="${links.bkmLink}"
                               target="_blank"
                               rel="noopener noreferrer"
                               class="purchase-link bkm-link"
                               aria-label="BKM Kitap'ta ${escapeHtml(book.title)} kitabƒ±nƒ± satƒ±n al">BKM</a>
                            <a href="${links.kitapyurduLink}"
                               target="_blank"
                               rel="noopener noreferrer"
                               class="purchase-link kitapyurdu-link"
                               aria-label="Kitapyurdu'nda ${escapeHtml(book.title)} kitabƒ±nƒ± satƒ±n al">Kitapyurdu</a>
                            <a href="${links.hepsiburadaLink}"
                               target="_blank"
                               rel="noopener noreferrer"
                               class="purchase-link hepsiburada-link"
                               aria-label="Hepsiburada'da ${escapeHtml(book.title)} kitabƒ±nƒ± satƒ±n al">Hepsiburada</a>
                            <a href="${links.trendyolLink}"
                               target="_blank"
                               rel="noopener noreferrer"
                               class="purchase-link trendyol-link"
                               aria-label="Trendyol'da ${escapeHtml(book.title)} kitabƒ±nƒ± satƒ±n al">Trendyol</a>
                            <a href="${links.amazonLink}"
                               target="_blank"
                               rel="noopener noreferrer"
                               class="purchase-link amazon-link"
                               aria-label="Amazon'da ${escapeHtml(book.title)} kitabƒ±nƒ± satƒ±n al">Amazon</a>
                        </div>
                        <button class="price-compare-btn" data-book-index="${index}" data-unique-id="${uniqueId}">üí∞ Fiyat Kar≈üƒ±la≈ütƒ±r</button>
                    </div>
                </div>
            `;
            }).join('');

            // Fiyat kar≈üƒ±la≈ütƒ±rma butonlarƒ±na event listener ekle
            setTimeout(() => {
                const priceButtons = resultsContainer.querySelectorAll('.price-compare-btn[data-book-index]');
                priceButtons.forEach(btn => {
                    const bookIndex = parseInt(btn.getAttribute('data-book-index'));
                    const uniqueIdAttr = btn.getAttribute('data-unique-id');
                    if (bookIndex >= 0 && bookIndex < books.length) {
                        const book = books[bookIndex];
                        const links = buildPurchaseLinks(book);
                        btn.onclick = () => showPriceModal(book, links);
                    }
                });
            }, 100);

            // G√∂rsel y√ºkleme hatalarƒ±nƒ± kontrol et (fallback - 2 saniye sonra)
            setTimeout(() => {
                books.forEach((book, index) => {
                    const imageId = `image-${uniqueId}-${index}`;
                    const placeholderId = `placeholder-${uniqueId}-${index}`;
                    const img = document.getElementById(imageId);
                    const placeholder = document.getElementById(placeholderId);

                    if (img && placeholder) {
                        // G√∂rsel y√ºklenemedi mi kontrol et
                        if (!img.complete || img.naturalHeight === 0 || img.naturalWidth === 0) {
                            img.style.display = 'none';
                            placeholder.classList.add('show');
                        }
                    }
                });
            }, 2000);
            
            // Native reklamƒ± kitaplarƒ±n arasƒ±na ekle (eƒüer reklam y√ºklenmi≈üse)
            if (!isFavoritesView) {
                setTimeout(() => {
                    insertNativeAdIntoResults();
                }, 100);
            }
        }

        function toggleFavorite(index, isFavoritesView, eventOrBookId) {
            // event parametresi artƒ±k 3. parametrede geliyor
            const event = eventOrBookId?.target ? eventOrBookId : null;
            let book = null;

            if (isFavoritesView) {
                // Favoriler g√∂r√ºn√ºm√ºnden
                const favorites = getFavorites();
                if (index < favorites.length) {
                    book = favorites[index];
                    removeFromFavorites(book);
                    displayFavorites(); // Favorileri yeniden g√∂ster
                    
                    // Modal a√ßƒ±ksa g√ºncelle
                    const modal = document.getElementById('favoritesModal');
                    if (modal && modal.classList.contains('active')) {
                        displayFavoritesInModal();
                    }
                }
            } else {
                // Arama sonu√ßlarƒ±ndan veya trend rafƒ±ndan
                if (currentBooks && index < currentBooks.length) {
                    book = currentBooks[index];
                }
                
                // currentBooks'ta yoksa veya eksikse, DOM'dan al
                if (!book || !book.title) {
                    const btn = event?.target?.closest?.('.favorite-btn');
                    if (btn) {
                        const card = btn.closest('.book-card');
                        if (card) {
                            const titleEl = card.querySelector('.book-title');
                            const authorEl = card.querySelector('.book-author');
                            const yearEl = card.querySelector('.book-year');
                            const summaryEl = card.querySelector('.book-summary');
                            const imgEl = card.querySelector('.book-cover');
                            
                            const title = titleEl?.textContent?.trim() || '';
                            const author = authorEl?.textContent?.replace('Yazar: ', '').trim() || '';
                            const yearText = yearEl?.textContent || '';
                            const yearMatch = yearText.match(/Basƒ±m Yƒ±lƒ±:\s*(\d{4})/);
                            const year = yearMatch ? yearMatch[1] : 'Bilinmiyor';
                            const summary = summaryEl?.textContent?.trim() || '';
                            const thumbnail = imgEl?.src || null;
                            
                            book = { 
                                title, 
                                author, 
                                year,
                                summary,
                                thumbnail,
                                isbn: null
                            };
                        }
                    }
                }

                if (book && book.title) {
                    const wasActive = isFavorite(book);
                    
                    if (wasActive) {
                        removeFromFavorites(book);
                    } else {
                        // Kitap bilgilerini eksiksiz kaydet
                        const bookToSave = {
                            title: book.title || '',
                            author: book.author || 'Bilinmeyen',
                            year: book.year || 'Bilinmiyor',
                            summary: book.summary || '',
                            thumbnail: book.thumbnail || null,
                            isbn: book.isbn || null,
                            publisher: book.publisher || ''
                        };
                        addToFavorites(bookToSave);
                    }
                    
                    // T√ºm olasƒ± buton ID'lerini g√ºncelle
                    const possibleIds = [
                        `favorite-res-${index}`,
                        `favorite-fav-${index}`,
                        `favorite-modal-${index}`,
                        `favorite-trend-${index}`
                    ];
                    
                    possibleIds.forEach(id => {
                        const btn = document.getElementById(id);
                        if (btn) {
                            if (wasActive) {
                                btn.classList.remove('active');
                                btn.innerHTML = '‚òÜ';
                                btn.title = 'Favorilere ekle';
                                btn.setAttribute('aria-label', 'Favorilere ekle');
                            } else {
                                btn.classList.add('active');
                                btn.innerHTML = '‚≠ê';
                                btn.title = 'Favorilerden √ßƒ±kar';
                                btn.setAttribute('aria-label', 'Favorilerden √ßƒ±kar');
                            }
                        }
                    });

                    // Modal a√ßƒ±ksa g√ºncelle
                    const modal = document.getElementById('favoritesModal');
                    if (modal && modal.classList.contains('active')) {
                        displayFavoritesInModal();
                    }
                    
                    // Ba≈üarƒ±lƒ± animasyonu
                    const clickedBtn = event?.target?.closest?.('.favorite-btn');
                    if (clickedBtn) {
                        clickedBtn.style.transform = 'scale(1.3)';
                        setTimeout(() => {
                            clickedBtn.style.transform = '';
                        }, 200);
                    }
                } else {
                    console.error('Kitap bilgisi alƒ±namadƒ±');
                }
            }
        }

        function escapeHtml(text) {
            if (text === null || text === undefined) return '';
            const str = String(text);
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return str.replace(/[&<>"']/g, m => map[m]);
        }

        // Enter tu≈üu ile arama
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchBooks();
            }
        });

        // Fiyat y√∂netimi fonksiyonlarƒ±
        function getPrices() {
            const prices = localStorage.getItem(PRICES_STORAGE_KEY);
            return prices ? JSON.parse(prices) : {};
        }

        function savePrices(prices) {
            localStorage.setItem(PRICES_STORAGE_KEY, JSON.stringify(prices));
        }

        function getBookPriceKey(book) {
            return book.isbn || `${book.title}_${book.author}`;
        }

        function getBookPrices(book) {
            const prices = getPrices();
            const key = getBookPriceKey(book);
            return prices[key] || {};
        }

        function saveBookPrices(book, priceData) {
            const prices = getPrices();
            const key = getBookPriceKey(book);
            prices[key] = priceData;
            savePrices(prices);
        }

        function displayResultsWithPrices(books) {
            const container = document.getElementById('favoritesModalContainer');
            const prices = getPrices();

            container.innerHTML = books.map((book, index) => {
                const bookKey = getBookPriceKey(book);
                const bookPrices = prices[bookKey] || {};
                const isFav = isFavorite(book);
                const favoriteClass = isFav ? 'active' : '';
                const favoriteIcon = isFav ? '‚≠ê' : '‚òÜ';
                const isPopular = book.isPopularInStores || false;
                const popularBadge = isPopular ? '<span class="popular-badge" title="Maƒüazalarda pop√ºler">üî• Pop√ºler</span>' : '';

                let coverImage = '';
                const placeholderId = `placeholder-modal-${index}`;
                const imageId = `image-modal-${index}`;
                const favoriteId = `favorite-modal-${index}`;

                if (book.thumbnail) {
                    coverImage = `<img id="${imageId}"
                                      src="${book.thumbnail}"
                                      alt="${escapeHtml(book.title)}"
                                      class="book-cover"
                                      loading="lazy"
                                      onerror="const img = document.getElementById('${imageId}'); const pl = document.getElementById('${placeholderId}'); if(img) img.style.display='none'; if(pl) pl.classList.add('show');">
                                  ${createPlaceholderImage(book.title, false, placeholderId)}`;
                } else {
                    coverImage = createPlaceholderImage(book.title, true, placeholderId);
                }

                const links = buildPurchaseLinks(book);

                return `
                <div class="book-card" data-book-id="${escapeHtml(bookKey)}">
                    <button class="favorite-btn ${favoriteClass}"
                            id="${favoriteId}"
                            onclick="toggleFavorite(${index}, false, event)"
                            title="${isFav ? 'Favorilerden √ßƒ±kar' : 'Favorilere ekle'}">
                        ${favoriteIcon}
                    </button>
                    ${coverImage}
                    <div class="book-info">
                        <div class="book-title">
                            ${escapeHtml(book.title)}
                            ${popularBadge}
                        </div>
                        <div class="book-author">Yazar: ${escapeHtml(book.author)}</div>
                        <div class="book-year">Basƒ±m Yƒ±lƒ±: ${escapeHtml(book.year)}</div>
                        <div class="book-summary">${escapeHtml(book.summary)}</div>

                        <div class="price-comparison-section">
                            <div id="priceFetchStatus-${index}"></div>
                            <div id="priceTableContainer-${index}">
                                ${generatePriceComparisonTable(bookPrices)}
                            </div>
                        </div>

                        <div class="purchase-links">
                            <a href="${links.drLink}"
                               target="_blank"
                               rel="noopener noreferrer"
                               class="purchase-link dr-link">D&R</a>
                            <a href="${links.bkmLink}"
                               target="_blank"
                               rel="noopener noreferrer"
                               class="purchase-link bkm-link">BKM</a>
                            <a href="${links.kitapyurduLink}"
                               target="_blank"
                               rel="noopener noreferrer"
                               class="purchase-link kitapyurdu-link">Kitapyurdu</a>
                            <a href="${links.hepsiburadaLink}"
                               target="_blank"
                               rel="noopener noreferrer"
                               class="purchase-link hepsiburada-link">Hepsiburada</a>
                            <a href="${links.trendyolLink}"
                               target="_blank"
                               rel="noopener noreferrer"
                               class="purchase-link trendyol-link">Trendyol</a>
                            <a href="${links.amazonLink}"
                               target="_blank"
                               rel="noopener noreferrer"
                               class="purchase-link amazon-link">Amazon</a>
                        </div>
                        <button class="price-compare-btn" data-book-title="${escapeHtml(book.title)}" data-book-author="${escapeHtml(book.author)}">üí∞ Fiyat Kar≈üƒ±la≈ütƒ±r</button>
                    </div>
                </div>
            `;
            }).join('');
            
            // Favorilerim fiyat kar≈üƒ±la≈ütƒ±rma butonlarƒ±na event listener ekle
            container.querySelectorAll('.price-compare-btn').forEach(btn => {
                const title = btn.getAttribute('data-book-title');
                const author = btn.getAttribute('data-book-author');
                if (title) {
                    const book = books.find(b => b.title === title && (b.author === author || !author));
                    if (book) {
                        const links = buildPurchaseLinks(book);
                        btn.onclick = () => showPriceModal(book, links);
                    }
                }
            });
        }

        function generatePriceComparisonTable(bookPrices) {
            const sites = [
                { key: 'dr', name: 'D&R' },
                { key: 'bkm', name: 'BKM Kitap' },
                { key: 'kitapyurdu', name: 'Kitapyurdu' },
                { key: 'hepsiburada', name: 'Hepsiburada' },
                { key: 'trendyol', name: 'Trendyol' },
                { key: 'amazon', name: 'Amazon' }
            ];

            // T√ºm siteleri g√∂ster, fiyat olmayanlarƒ± da dahil et
            const allPrices = sites.map(site => ({
                name: site.name,
                key: site.key,
                price: bookPrices[site.key] ? parseFloat(bookPrices[site.key]) : null
            }));

            const validPrices = allPrices.filter(p => p.price !== null && p.price > 0);

            if (validPrices.length === 0) {
                return '';
            }

            const minPrice = Math.min(...validPrices.map(p => p.price));

            let tableHTML = '<table class="price-table"><thead><tr><th>Site</th><th>Fiyat</th></tr></thead><tbody>';

            // √ñnce fiyatƒ± olanlarƒ± g√∂ster
            validPrices.forEach(p => {
                const isBest = p.price === minPrice && p.price > 0;
                const rowClass = isBest ? 'best-price' : '';
                const priceDisplay = `${p.price.toFixed(2)} ‚Ç∫`;

                tableHTML += `<tr class="${rowClass}">
                    <td><strong>${p.name}</strong></td>
                    <td class="price-value">${priceDisplay} ${isBest ? 'üèÜ' : ''}</td>
                </tr>`;
            });

            // Fiyatƒ± olmayan siteleri de g√∂ster (gri renkte)
            const sitesWithoutPrice = allPrices.filter(p => !p.price || p.price <= 0);
            sitesWithoutPrice.forEach(p => {
                tableHTML += `<tr>
                    <td><strong style="color: #999;">${p.name}</strong></td>
                    <td class="price-value empty">Fiyat bulunamadƒ±</td>
                </tr>`;
            });

            tableHTML += '</tbody></table>';

            // En iyi fiyat bilgisi
            if (validPrices.length > 1) {
                const bestSite = validPrices.find(p => p.price === minPrice);
                tableHTML += `<p style="margin-top: 10px; padding: 10px; background: #d4edda; border-radius: 5px; color: #155724; font-size: 13px;">
                    üèÜ <strong>En iyi fiyat:</strong> ${bestSite.name} - ${minPrice.toFixed(2)} ‚Ç∫
                </p>`;
            }

            return tableHTML;
        }


        function showAllPricesComparison() {
            const favorites = getFavorites();
            const prices = getPrices();

            if (favorites.length === 0) {
                alert('Kar≈üƒ±la≈ütƒ±rƒ±lacak favori kitap yok.');
                return;
            }

            let comparisonHTML = '<div style="background: white; padding: 30px; border-radius: 15px; margin-top: 20px;"><h2 style="color: #333; margin-bottom: 20px;">üìä T√ºm Kitaplarƒ±n Fiyat Kar≈üƒ±la≈ütƒ±rmasƒ±</h2>';

            favorites.forEach((book, bookIndex) => {
                const bookKey = getBookPriceKey(book);
                const bookPrices = prices[bookKey] || {};

                const sites = [
                    { key: 'dr', name: 'D&R' },
                    { key: 'bkm', name: 'BKM Kitap' },
                    { key: 'kitapyurdu', name: 'Kitapyurdu' },
                    { key: 'hepsiburada', name: 'Hepsiburada' },
                    { key: 'trendyol', name: 'Trendyol' },
                    { key: 'amazon', name: 'Amazon' }
                ];

                const validPrices = sites
                    .map(site => ({
                        name: site.name,
                        price: bookPrices[site.key] ? parseFloat(bookPrices[site.key]) : null
                    }))
                    .filter(p => p.price !== null && p.price > 0);

                if (validPrices.length === 0) {
                    return; // Bu kitap i√ßin fiyat yoksa atla
                }

                const minPrice = Math.min(...validPrices.map(p => p.price));

                comparisonHTML += `<div style="margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h3 style="color: #333; margin-bottom: 15px;">${escapeHtml(book.title)}</h3>
                    <table class="price-table" style="width: 100%;">
                        <thead>
                            <tr>
                                <th>Site</th>
                                <th>Fiyat</th>
                            </tr>
                        </thead>
                        <tbody>`;

                sites.forEach(site => {
                    const price = bookPrices[site.key] ? parseFloat(bookPrices[site.key]) : null;
                    if (price && price > 0) {
                        const isBest = price === minPrice;
                        const rowClass = isBest ? 'best-price' : '';
                        comparisonHTML += `<tr class="${rowClass}">
                            <td><strong>${site.name}</strong></td>
                            <td class="price-value">${price.toFixed(2)} ‚Ç∫ ${isBest ? 'üèÜ' : ''}</td>
                        </tr>`;
                    }
                });

                comparisonHTML += `</tbody></table></div>`;
            });

            comparisonHTML += '</div>';

            // Yeni bir modal veya alert ile g√∂ster
            const comparisonModal = document.createElement('div');
            comparisonModal.className = 'favorites-modal active';
            comparisonModal.innerHTML = `
                <div class="favorites-modal-content">
                    <div class="modal-header">
                        <h2>üìä T√ºm Fiyat Kar≈üƒ±la≈ütƒ±rmasƒ±</h2>
                        <button class="close-modal-btn" onclick="this.closest('.favorites-modal').remove()">‚úï Kapat</button>
                    </div>
                    ${comparisonHTML}
                </div>
            `;
            document.body.appendChild(comparisonModal);

            // Modal dƒ±≈üƒ±na tƒ±klandƒ±ƒüƒ±nda kapat
            comparisonModal.addEventListener('click', function(e) {
                if (e.target === comparisonModal) {
                    comparisonModal.remove();
                }
            });
        }

        // Tekil kitap fiyat kar≈üƒ±la≈ütƒ±rma modal fonksiyonlarƒ±
        function openPriceComparisonModal(index, isFavoritesView) {
            if (index >= currentBooks.length) return;

            const book = currentBooks[index];
            const modal = document.getElementById('singleBookPriceModal');
            const content = document.getElementById('singleBookPriceContent');
            const bookKey = getBookPriceKey(book);
            const bookPrices = getBookPrices(book);

            let coverImage = '';
            if (book.thumbnail) {
                coverImage = `<img src="${book.thumbnail}" alt="${escapeHtml(book.title)}" class="book-cover" style="max-width: 200px; margin: 0 auto 20px; display: block;">`;
            } else {
                const initials = getBookCoverInitials(book.title);
                coverImage = `<div class="book-cover-placeholder show" style="max-width: 200px; margin: 0 auto 20px;">${escapeHtml(initials)}</div>`;
            }

            const links = buildPurchaseLinks(book);

            content.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    ${coverImage}
                    <h3 style="color: #333; margin-bottom: 10px;">${escapeHtml(book.title)}</h3>
                    <p style="color: #666; margin-bottom: 5px;">${escapeHtml(book.author)}</p>
                    <p style="color: #888; font-size: 0.9em;">Basƒ±m Yƒ±lƒ±: ${escapeHtml(book.year)}</p>
                </div>

                <div class="price-comparison-section">
                    <button class="fetch-prices-btn" id="fetchPricesBtn" onclick="fetchAllPrices('${escapeHtml(bookKey).replace(/'/g, "\\'")}', '${escapeHtml(book.title).replace(/'/g, "\\'")}', '${escapeHtml(book.isbn || '').replace(/'/g, "\\'")}')">
                        üìã Fiyatlarƒ± Listele
                    </button>
                    <div id="priceFetchStatus"></div>
                    <div id="singleBookPriceTable">${generatePriceComparisonTable(bookPrices)}</div>
                </div>

                <div style="margin-top: 30px;">
                    <h4 style="color: #333; margin-bottom: 15px;">üõí Satƒ±n Al</h4>
                    <div class="purchase-links">
                        <a href="${links.drLink}"
                           target="_blank"
                           rel="noopener noreferrer"
                           class="purchase-link dr-link">D&R</a>
                        <a href="${links.bkmLink}"
                           target="_blank"
                           rel="noopener noreferrer"
                           class="purchase-link bkm-link">BKM</a>
                        <a href="${links.kitapyurduLink}"
                           target="_blank"
                           rel="noopener noreferrer"
                           class="purchase-link kitapyurdu-link">Kitapyurdu</a>
                        <a href="${links.hepsiburadaLink}"
                           target="_blank"
                           rel="noopener noreferrer"
                           class="purchase-link hepsiburada-link">Hepsiburada</a>
                        <a href="${links.trendyolLink}"
                           target="_blank"
                           rel="noopener noreferrer"
                           class="purchase-link trendyol-link">Trendyol</a>
                        <a href="${links.amazonLink}"
                           target="_blank"
                           rel="noopener noreferrer"
                           class="purchase-link amazon-link">Amazon</a>
                    </div>
                </div>
            `;

            modal.classList.add('active');
        }

        function closeSingleBookPriceModal() {
            const modal = document.getElementById('singleBookPriceModal');
            modal.classList.remove('active');
        }

        // T√ºm favori kitaplar i√ßin fiyat √ßekme (API kullanarak)
        async function fetchAllFavoritesPrices() {
            const btn = document.getElementById('fetchAllPricesBtn');
            const statusDiv = document.getElementById('fetchAllPricesStatus');

            if (!btn || btn.disabled) return;

            const favorites = getFavorites();
            if (favorites.length === 0) {
                alert('Favori kitap bulunamadƒ±.');
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<span class="price-loading"></span> T√ºm fiyatlar √ßekiliyor...';
            if (statusDiv) {
                statusDiv.innerHTML = '<div class="price-status">T√ºm kitaplar i√ßin fiyatlar √ßekiliyor, l√ºtfen bekleyin...</div>';
            }

            let totalFound = 0;
            let totalProcessed = 0;

            // Her kitap i√ßin sƒ±rayla fiyat √ßek (√ßok fazla istek olmamasƒ± i√ßin)
            for (let i = 0; i < favorites.length; i++) {
                const book = favorites[i];
                const bookKey = getBookPriceKey(book);
                const bookTitle = book.title;
                const isbn = book.isbn || '';

                try {
                    // Client-side fiyat √ßekme
                    const result = await fetchPricesClientSide(bookTitle, isbn);

                    if (result.success && result.data.success && result.data.totalFound > 0) {
                        const prices = result.data.prices;
                    saveBookPrices(book, prices);
                    totalFound += Object.keys(prices).length;

                    // Tabloyu g√ºncelle
                    const tableContainer = document.getElementById(`priceTableContainer-${i}`);
                    if (tableContainer) {
                        tableContainer.innerHTML = generatePriceComparisonTable(prices);
                    }
                    }
                } catch (error) {
                    console.warn(`Kitap "${bookTitle}" i√ßin fiyat √ßekilemedi:`, error);
                }

                totalProcessed++;

                // ƒ∞lerleme durumunu g√ºncelle
                if (statusDiv) {
                    statusDiv.innerHTML = `<div class="price-status">ƒ∞≈üleniyor: ${totalProcessed}/${favorites.length} kitap... (${totalFound} fiyat bulundu)</div>`;
                }

                // Her kitap arasƒ±nda kƒ±sa bir bekleme (rate limiting i√ßin)
                if (i < favorites.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
            }

            // Sonu√ßlarƒ± g√∂ster
            if (statusDiv) {
                if (totalFound > 0) {
                    statusDiv.innerHTML = `<div class="price-status success">‚úì Tamamlandƒ±! ${totalProcessed} kitap i√ßin toplam ${totalFound} fiyat bulundu.</div>`;
                } else {
                    statusDiv.innerHTML = '<div class="price-status error">Fiyat bulunamadƒ±. L√ºtfen daha sonra tekrar deneyin.</div>';
                }
            }

            btn.disabled = false;
            btn.innerHTML = 'üîÑ T√ºm Fiyatlarƒ± Otomatik √áek';
        }

        // CORS proxy servisleri listesi (daha fazla alternatif)
        const CORS_PROXIES = [
            {
                name: 'allorigins',
                url: (u) => `https://api.allorigins.win/get?url=${encodeURIComponent(u)}`,
                parseResponse: async (res) => {
                    const data = await res.json();
                    if (data.contents) {
                        return JSON.parse(data.contents);
                    }
                    return data;
                }
            },
            {
                name: 'cors-anywhere',
                url: (u) => `https://cors-anywhere.herokuapp.com/${u}`,
                parseResponse: async (res) => await res.json()
            },
            {
                name: 'codetabs',
                url: (u) => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(u)}`,
                parseResponse: async (res) => await res.json()
            },
            {
                name: 'corsproxy',
                url: (u) => `https://corsproxy.io/?${encodeURIComponent(u)}`,
                parseResponse: async (res) => await res.json()
            }
        ];

        // CORS proxy ile fetch (file:// protokol√º i√ßin)
        function getCorsProxyUrl(url) {
            // Eƒüer file:// protokol√º kullanƒ±lƒ±yorsa CORS proxy kullan
            if (window.location.protocol === 'file:' || !window.location.origin || window.location.origin === 'null') {
                // ƒ∞lk proxy'yi d√∂nd√ºr (fallback mekanizmasƒ± fetchWithTimeout i√ßinde)
                return CORS_PROXIES[0].url(url);
            }
            return url; // Normal URL kullan
        }

        // Timeout ile fetch wrapper (CORS proxy desteƒüi ile, fallback mekanizmasƒ±)
        async function fetchWithTimeout(url, options, timeout = 30000) {
            const useProxy = window.location.protocol === 'file:' || !window.location.origin || window.location.origin === 'null';

            // √ñnce direkt deneme (API CORS ayarlarƒ± d√ºzeltildi, belki √ßalƒ±≈üƒ±r)
            if (useProxy) {
                // file:// protokol√º i√ßin √∂nce direkt deneme yap (bazƒ± API'ler CORS'u d√ºzelttiyse √ßalƒ±≈üabilir)
                try {
                    const directResponse = await new Promise((resolve, reject) => {
                        const timer = setTimeout(() => reject(new Error('Timeout')), 5000);
                        fetch(url, options)
                            .then(res => {
                                clearTimeout(timer);
                                resolve(res);
                            })
                            .catch(err => {
                                clearTimeout(timer);
                                reject(err);
                            });
                    });
                    if (directResponse.ok) {
                        console.log('‚úÖ Direkt fetch ba≈üarƒ±lƒ± (CORS √ßalƒ±≈üƒ±yor)');
                        return directResponse;
                    }
                } catch (e) {
                    console.log('‚ö†Ô∏è Direkt fetch ba≈üarƒ±sƒ±z, proxy deneniyor...');
                }
            } else {
                // http/https protokol√º i√ßin direkt fetch
                return new Promise((resolve, reject) => {
                    const timer = setTimeout(() => {
                        reject(new Error('ƒ∞stek zaman a≈üƒ±mƒ±na uƒüradƒ±'));
                    }, timeout);

                    fetch(url, options)
                        .then(response => {
                            clearTimeout(timer);
                            resolve(response);
                        })
                        .catch(error => {
                            clearTimeout(timer);
                            reject(error);
                        });
                });
            }

            // POST istekleri i√ßin √∂zel i≈ülem (proxy ile)
            if (options.method === 'POST' && options.body) {
                const bodyData = JSON.parse(options.body);
                const params = new URLSearchParams();
                params.append('bookTitle', bodyData.bookTitle || '');
                params.append('isbn', bodyData.isbn || '');
                const getUrl = url + '?' + params.toString();

                // √ñnce AllOrigins'i dene (en g√ºvenilir)
                try {
                    const allOriginsUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(getUrl)}`;
                    console.log('üîÑ AllOrigins proxy deneniyor...');
                    console.log('üìç Proxy URL:', allOriginsUrl);

                    const response = await new Promise((resolve, reject) => {
                        const timer = setTimeout(() => reject(new Error('Timeout')), 20000);
                        fetch(allOriginsUrl, {
                            method: 'GET',
                            headers: { 'Accept': 'application/json' }
                        })
                            .then(res => {
                                clearTimeout(timer);
                                resolve(res);
                            })
                            .catch(err => {
                                clearTimeout(timer);
                                reject(err);
                            });
                    });

                    if (response.ok) {
                        const data = await response.json();
                        console.log('üì¶ AllOrigins yanƒ±tƒ±:', data);

                        if (data.contents) {
                            try {
                                const parsed = JSON.parse(data.contents);
                                console.log('üì¶ Parse edilmi≈ü veri:', parsed);

                                if (parsed && (parsed.success !== undefined || parsed.prices || parsed.status || parsed.error)) {
                                    console.log('‚úÖ AllOrigins proxy ba≈üarƒ±lƒ±!');
                                    return {
                                        ok: true,
                                        status: 200,
                                        json: async () => parsed
                                    };
                                }
                            } catch (e) {
                                console.warn('‚ö†Ô∏è AllOrigins parse hatasƒ±:', e.message);
                                console.warn('üì¶ Ham i√ßerik:', data.contents);

                                // Eƒüer "Not Found" hatasƒ± varsa, API √ßalƒ±≈ümƒ±yor demektir
                                if (data.contents && data.contents.includes('Not Found')) {
                                    console.error('‚ùå API bulunamadƒ± - API deploy edilmemi≈ü olabilir');
                                }
                            }
                        } else if (data.status) {
                            // AllOrigins hata yanƒ±tƒ±
                            console.warn('‚ö†Ô∏è AllOrigins hata:', data.status);
                        }
                    } else {
                        console.warn('‚ö†Ô∏è AllOrigins HTTP hatasƒ±:', response.status, response.statusText);
                    }
                } catch (error) {
                    console.warn('‚ùå AllOrigins ba≈üarƒ±sƒ±z:', error.message);
                }

                // Diƒüer proxy'leri dene
                for (let i = 1; i < CORS_PROXIES.length; i++) {
                    try {
                        const proxy = CORS_PROXIES[i];
                        let proxyUrl = proxy.url(getUrl);

                        console.log(`üîÑ Proxy deneniyor: ${proxy.name}`);

                        const response = await new Promise((resolve, reject) => {
                            const timer = setTimeout(() => reject(new Error('Timeout')), 15000);

                            fetch(proxyUrl, {
                                method: 'GET',
                                headers: {
                                    'Accept': 'application/json',
                                    'X-Requested-With': 'XMLHttpRequest'
                                }
                            })
                                .then(res => {
                                    clearTimeout(timer);
                                    resolve(res);
                                })
                                .catch(err => {
                                    clearTimeout(timer);
                                    reject(err);
                                });
                        });

                        if (response.ok) {
                            try {
                                const data = proxy.parseResponse ? await proxy.parseResponse(response) : await response.json();

                                if (data && (data.success !== undefined || data.prices || data.status)) {
                                    console.log(`‚úÖ Proxy ba≈üarƒ±lƒ±: ${proxy.name}`);
                                    return {
                                        ok: true,
                                        status: 200,
                                        json: async () => data
                                    };
                                }
                            } catch (parseError) {
                                console.warn(`Proxy ${proxy.name} parse hatasƒ±:`, parseError.message);
                                continue;
                            }
                        } else {
                            console.warn(`Proxy ${proxy.name} HTTP hatasƒ±:`, response.status);
                        }
                    } catch (error) {
                        console.warn(`‚ùå Proxy ${CORS_PROXIES[i].name} ba≈üarƒ±sƒ±z:`, error.message);
                        continue;
                    }
                }

                throw new Error('T√ºm proxy servisleri ba≈üarƒ±sƒ±z. L√ºtfen API\'yi yeniden deploy edin (Render.com dashboard > Redeploy) veya bir web sunucusu √ºzerinden √ßalƒ±≈ütƒ±rƒ±n.');
            }

            // GET istekleri i√ßin proxy denemesi
            // √ñnce AllOrigins'i dene
            try {
                const allOriginsUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
                console.log('üîÑ AllOrigins proxy deneniyor (GET)...');

                const response = await new Promise((resolve, reject) => {
                    const timer = setTimeout(() => reject(new Error('Timeout')), 20000);
                    fetch(allOriginsUrl, {
                        method: 'GET',
                        headers: { 'Accept': 'application/json' }
                    })
                        .then(res => {
                            clearTimeout(timer);
                            resolve(res);
                        })
                        .catch(err => {
                            clearTimeout(timer);
                            reject(err);
                        });
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.contents) {
                        try {
                            const parsed = JSON.parse(data.contents);
                            if (parsed && (parsed.status || parsed.success !== undefined)) {
                                console.log('‚úÖ AllOrigins proxy ba≈üarƒ±lƒ± (GET)!');
                                return {
                                    ok: true,
                                    status: 200,
                                    json: async () => parsed
                                };
                            }
                        } catch (e) {
                            // "Not Found" kontrol√º
                            if (data.contents && data.contents.includes('Not Found')) {
                                console.error('‚ùå API bulunamadƒ± (GET)');
                            }
                        }
                    }
                }
            } catch (error) {
                console.warn('AllOrigins ba≈üarƒ±sƒ±z (GET):', error.message);
            }

            // Diƒüer proxy'leri dene
            for (let i = 1; i < CORS_PROXIES.length; i++) {
                try {
                    const proxy = CORS_PROXIES[i];
                    const proxyUrl = proxy.url(url);

                    const response = await new Promise((resolve, reject) => {
                        const timer = setTimeout(() => reject(new Error('Timeout')), 10000);

                        fetch(proxyUrl, { method: 'GET' })
                            .then(res => {
                                clearTimeout(timer);
                                resolve(res);
                            })
                            .catch(err => {
                                clearTimeout(timer);
                                reject(err);
                            });
                    });

                    if (response.ok) {
                        return response;
                    }
                } catch (error) {
                    console.warn(`Proxy ${CORS_PROXIES[i].name} ba≈üarƒ±sƒ±z:`, error.message);
                    continue;
                }
            }

            throw new Error('T√ºm proxy servisleri ba≈üarƒ±sƒ±z');
        }

        // API kodlarƒ± kaldƒ±rƒ±ldƒ±, direkt client-side kullanƒ±lƒ±yor
        // Client-side fiyat √ßekme (API olmadan, fallback)
        async function fetchPricesClientSide(bookTitle, isbn) {
            const sites = [
                { key: 'dr', name: 'D&R', fetchFn: fetchDRPrice },
                { key: 'bkm', name: 'BKM Kitap', fetchFn: fetchBKMPrice },
                { key: 'kitapyurdu', name: 'Kitapyurdu', fetchFn: fetchKitapyurduPrice },
                { key: 'hepsiburada', name: 'Hepsiburada', fetchFn: fetchHepsiburadaPrice },
                { key: 'trendyol', name: 'Trendyol', fetchFn: fetchTrendyolPrice },
                { key: 'amazon', name: 'Amazon', fetchFn: fetchAmazonPrice }
            ];

            const prices = {};
            const results = [];

            // Paralel olarak t√ºm sitelerden fiyat √ßek
            const fetchPromises = sites.map(async (site) => {
                try {
                    const price = await site.fetchFn(bookTitle, isbn);
                    if (price && price > 0) {
                        prices[site.key] = price;
                        results.push({
                            site: site.key,
                            siteName: site.name,
                            price: price,
                            success: true
                        });
                    } else {
                        results.push({
                            site: site.key,
                            siteName: site.name,
                            price: null,
                            success: false
                        });
                    }
                } catch (error) {
                    console.warn(`${site.name} fiyat √ßekilemedi:`, error.message);
                    results.push({
                        site: site.key,
                        siteName: site.name,
                        price: null,
                        success: false,
                        error: error.message
                    });
                }
            });

            await Promise.allSettled(fetchPromises);

            // En iyi fiyatƒ± bul
            const validPrices = Object.entries(prices).map(([key, price]) => ({
                site: key,
                siteName: sites.find(s => s.key === key)?.name || key,
                price: price
            }));

            let bestPrice = null;
            if (validPrices.length > 0) {
                bestPrice = validPrices.reduce((min, current) =>
                    current.price < min.price ? current : min
                );
            }

            console.log(`üìä Client-side fiyat √ßekme tamamlandƒ±: ${validPrices.length} fiyat bulundu`);

            return {
                success: validPrices.length > 0,
                data: {
                    success: validPrices.length > 0,
                    bookTitle: bookTitle,
                    isbn: isbn,
                    prices: prices,
                    results: results,
                    bestPrice: bestPrice,
                    totalFound: validPrices.length,
                    timestamp: new Date().toISOString()
                },
                error: validPrices.length === 0 ? 'Client-side fiyat √ßekme ba≈üarƒ±sƒ±z - T√ºm sitelerden fiyat √ßekilmeye √ßalƒ±≈üƒ±ldƒ± ancak sonu√ß alƒ±namadƒ±' : null
            };
        }

        // Favoriler modal'ƒ±ndaki tek bir kitap i√ßin fiyat √ßekme (API kullanarak)
        async function fetchPricesForBook(index, bookKey, bookTitle, isbn) {
            const btn = document.getElementById(`fetchPricesBtn-${index}`);
            const statusDiv = document.getElementById(`priceFetchStatus-${index}`);

            if (!btn || btn.disabled) return;

            btn.disabled = true;
            btn.innerHTML = '<span class="price-loading"></span> Fiyatlar √ßekiliyor...';
            if (statusDiv) {
                statusDiv.innerHTML = '<div class="price-status">Fiyatlar √ßekiliyor, l√ºtfen bekleyin...</div>';
            }

            try {
                // Client-side fiyat √ßekme
                const result = await fetchPricesClientSide(bookTitle, isbn || '');

                if (!result.success) {
                    if (result.data && result.data.totalFound === 0) {
                        throw new Error('Fiyat bulunamadƒ±. T√ºm sitelerden fiyat √ßekilmeye √ßalƒ±≈üƒ±ldƒ± ancak sonu√ß alƒ±namadƒ±. L√ºtfen daha sonra tekrar deneyin veya fiyatlarƒ± manuel olarak kontrol edin.');
                    }
                    throw new Error(result.error || 'Fiyat √ßekme hatasƒ±');
                }

                const data = result.data;

                // API yanƒ±tƒ±nƒ± kontrol et - farklƒ± formatlarƒ± destekle
                let prices = {};
                let totalFound = 0;
                let results = [];
                let bestPrice = null;

                if (data) {
                    // Format 1: { success: true, prices: {...}, totalFound: ... }
                    if (data.prices && typeof data.prices === 'object') {
                        prices = data.prices;
                        totalFound = Object.keys(prices).filter(k => prices[k] && prices[k] > 0).length;
                        results = Object.entries(prices)
                            .filter(([k, v]) => v && v > 0)
                            .map(([k, v]) => ({ site: k, siteName: k, price: v, success: true }));
                    }
                    // Format 2: { success: true, data: { prices: {...} } }
                    else if (data.data && data.data.prices) {
                        prices = data.data.prices;
                        totalFound = data.data.totalFound || Object.keys(prices).filter(k => prices[k] && prices[k] > 0).length;
                        results = data.data.results || [];
                    }
                    // Format 3: Direkt prices objesi
                    else if (data.success && data.totalFound !== undefined) {
                        prices = data.prices || {};
                        totalFound = data.totalFound || 0;
                        results = data.results || [];
                        bestPrice = data.bestPrice || null;
                    }
                }

                if (totalFound > 0 && Object.keys(prices).length > 0) {
                    // En iyi fiyatƒ± bul
                    if (!bestPrice) {
                        const validPrices = Object.entries(prices)
                            .filter(([k, v]) => v && v > 0)
                            .map(([k, v]) => ({ site: k, siteName: k, price: v }));
                        if (validPrices.length > 0) {
                            bestPrice = validPrices.reduce((min, current) =>
                                current.price < min.price ? current : min
                            );
                        }
                    }

                    // Bulunan fiyatlarƒ± listeleyelim - daha okunabilir format
                    const foundPricesList = results.length > 0
                        ? results
                            .filter(r => r.success && r.price)
                            .map(r => `<strong>${r.siteName || r.site}</strong>: ${r.price.toFixed(2)} ‚Ç∫`)
                            .join(' | ')
                        : Object.entries(prices)
                            .filter(([k, v]) => v && v > 0)
                            .map(([k, v]) => `<strong>${k}</strong>: ${v.toFixed(2)} ‚Ç∫`)
                            .join(' | ');

                    if (statusDiv) {
                        statusDiv.innerHTML = `<div class="price-status success">‚úì ${totalFound} siteden fiyat bulundu!<br><div style="margin-top: 8px; font-size: 13px;">${foundPricesList}</div>${bestPrice ? `<br>üèÜ <strong>En iyi fiyat:</strong> ${bestPrice.siteName || bestPrice.site} - ${bestPrice.price.toFixed(2)} ‚Ç∫` : ''}</div>`;
                    }

                    // Tabloyu g√ºncelle
                    const tableContainer = document.getElementById(`priceTableContainer-${index}`);
                    if (tableContainer) {
                        tableContainer.innerHTML = generatePriceComparisonTable(prices);
                    }

                    // Otomatik kaydet
                    const book = currentBooks[index];
                    if (book) {
                        saveBookPrices(book, prices);
                    }
                } else {
                    // Fiyat bulunamadƒ±
                    if (statusDiv) {
                    statusDiv.innerHTML = `<div class="price-status error">
                            ‚ùå Fiyat bulunamadƒ±.<br>
                        <small style="display: block; margin-top: 8px; color: #666;">
                            üí° <strong>√á√∂z√ºm √∂nerileri:</strong><br>
                            ‚Ä¢ Fiyatlarƒ± manuel olarak kontrol etmek i√ßin kitap kartƒ±ndaki site linklerine tƒ±klayƒ±n<br>
                                ‚Ä¢ Internet baƒülantƒ±nƒ±zƒ± kontrol edin<br>
                                ‚Ä¢ Birka√ß dakika sonra tekrar deneyin<br>
                                ‚Ä¢ Console'da hata mesajlarƒ±nƒ± kontrol edin (F12)
                            </small>
                        </div>`;
                    }
                }
            } catch (error) {
                console.error('Fiyat √ßekme hatasƒ±:', error);
                if (statusDiv) {
                    // file:// protokol√º kontrol√º
                    const isFileProtocol = window.location.protocol === 'file:';
                    let errorMsg = error.message;

                    if (isFileProtocol) {
                        errorMsg = '‚ö†Ô∏è Dosya doƒürudan a√ßƒ±ldƒ±ƒüƒ± i√ßin CORS hatasƒ± olu≈üuyor.';
                    }

                    statusDiv.innerHTML = `<div class="price-status error">
                        ‚ùå ${errorMsg}<br>
                        <small style="display: block; margin-top: 12px; color: #666; line-height: 1.6;">
                            ${isFileProtocol ? `
                            <strong style="color: #d32f2f; display: block; margin-bottom: 8px;">üî¥ √ñNEMLƒ∞: Web Sunucusu Gerekli!</strong>
                            Dosyayƒ± doƒürudan a√ßtƒ±ƒüƒ±nƒ±z i√ßin (file://) CORS kƒ±sƒ±tlamalarƒ± nedeniyle fiyatlar √ßekilemiyor.<br><br>
                            <strong>‚úÖ √á√∂z√ºm - Web Sunucusu Kullanƒ±n:</strong><br>
                            <code style="background: #f5f5f5; padding: 4px 8px; border-radius: 4px; display: inline-block; margin: 4px 0;">
                                cd www<br>
                                python -m http.server 8000
                            </code><br><br>
                            Sonra tarayƒ±cƒ±da ≈üu adresi a√ßƒ±n:<br>
                            <code style="background: #f5f5f5; padding: 4px 8px; border-radius: 4px; display: inline-block; margin: 4px 0;">
                                http://localhost:8000/index.html
                            </code>
                            ` : `
                            üí° <strong>Otomatik API algƒ±lama aktif</strong> - T√ºm API'ler deneniyor...<br>
                            ‚Ä¢ Birka√ß saniye bekleyip tekrar deneyin<br>
                            ‚Ä¢ API'ler ge√ßici olarak kullanƒ±lamƒ±yor olabilir<br>
                            ‚Ä¢ Fiyatlarƒ± manuel olarak kontrol etmek i√ßin site linklerine tƒ±klayƒ±n
                            `}
                        </small>
                    </div>`;
                }
            }

            btn.disabled = false;
            btn.innerHTML = 'üìã Fiyatlarƒ± Listele';
        }

        // Fiyat √ßekme fonksiyonlarƒ± (API kullanarak)
        async function fetchAllPrices(bookKey, bookTitle, isbn) {
            const btn = document.getElementById('fetchPricesBtn');
            const statusDiv = document.getElementById('priceFetchStatus');

            if (!btn || btn.disabled) return;

            btn.disabled = true;
            btn.innerHTML = '<span class="price-loading"></span> Fiyatlar √ßekiliyor...';
            statusDiv.innerHTML = '<div class="price-status">Fiyatlar √ßekiliyor, l√ºtfen bekleyin...</div>';

            try {
                // Client-side fiyat √ßekme
                const result = await fetchPricesClientSide(bookTitle, isbn || '');

                if (!result.success) {
                    if (result.data && result.data.totalFound === 0) {
                        throw new Error('Fiyat bulunamadƒ±. T√ºm sitelerden fiyat √ßekilmeye √ßalƒ±≈üƒ±ldƒ± ancak sonu√ß alƒ±namadƒ±. L√ºtfen daha sonra tekrar deneyin veya fiyatlarƒ± manuel olarak kontrol edin.');
                    }
                    throw new Error(result.error || 'Fiyat √ßekme hatasƒ±');
                }

                const data = result.data;

                // API yanƒ±tƒ±nƒ± kontrol et - farklƒ± formatlarƒ± destekle
                let prices = {};
                let totalFound = 0;
                let results = [];
                let bestPrice = null;

                if (data) {
                    // Format 1: { success: true, prices: {...}, totalFound: ... }
                    if (data.prices && typeof data.prices === 'object') {
                        prices = data.prices;
                        totalFound = Object.keys(prices).filter(k => prices[k] && prices[k] > 0).length;
                        results = Object.entries(prices)
                            .filter(([k, v]) => v && v > 0)
                            .map(([k, v]) => ({ site: k, siteName: k, price: v, success: true }));
                    }
                    // Format 2: { success: true, data: { prices: {...} } }
                    else if (data.data && data.data.prices) {
                        prices = data.data.prices;
                        totalFound = data.data.totalFound || Object.keys(prices).filter(k => prices[k] && prices[k] > 0).length;
                        results = data.data.results || [];
                    }
                    // Format 3: Direkt prices objesi
                    else if (data.success && data.totalFound !== undefined) {
                        prices = data.prices || {};
                        totalFound = data.totalFound || 0;
                        results = data.results || [];
                        bestPrice = data.bestPrice || null;
                    }
                }

                if (totalFound > 0 && Object.keys(prices).length > 0) {
                    // En iyi fiyatƒ± bul
                    if (!bestPrice) {
                        const validPrices = Object.entries(prices)
                            .filter(([k, v]) => v && v > 0)
                            .map(([k, v]) => ({ site: k, siteName: k, price: v }));
                        if (validPrices.length > 0) {
                            bestPrice = validPrices.reduce((min, current) =>
                                current.price < min.price ? current : min
                            );
                        }
                    }

                // Bulunan fiyatlarƒ± listeleyelim - daha okunabilir format
                    const foundPricesList = results.length > 0
                        ? results
                            .filter(r => r.success && r.price)
                            .map(r => `<strong>${r.siteName || r.site}</strong>: ${r.price.toFixed(2)} ‚Ç∫`)
                            .join(' | ')
                        : Object.entries(prices)
                            .filter(([k, v]) => v && v > 0)
                            .map(([k, v]) => `<strong>${k}</strong>: ${v.toFixed(2)} ‚Ç∫`)
                            .join(' | ');

                    statusDiv.innerHTML = `<div class="price-status success">‚úì ${totalFound} siteden fiyat bulundu!<br><div style="margin-top: 8px; font-size: 13px;">${foundPricesList}</div>${bestPrice ? `<br>üèÜ <strong>En iyi fiyat:</strong> ${bestPrice.siteName || bestPrice.site} - ${bestPrice.price.toFixed(2)} ‚Ç∫` : ''}</div>`;

                // Tabloyu g√ºncelle
                const tableContainer = document.getElementById('singleBookPriceTable');
                if (tableContainer) {
                    tableContainer.innerHTML = generatePriceComparisonTable(prices);
                }

                // Otomatik kaydet
                const book = currentBooks.find(b => getBookPriceKey(b) === bookKey);
                if (book) {
                    saveBookPrices(book, prices);
                }
            } else {
                    // Fiyat bulunamadƒ±
                statusDiv.innerHTML = `<div class="price-status error">
                        ‚ùå Fiyat bulunamadƒ±.<br>
                    <small style="display: block; margin-top: 8px; color: #666;">
                        üí° <strong>√á√∂z√ºm √∂nerileri:</strong><br>
                        ‚Ä¢ Fiyatlarƒ± manuel olarak kontrol etmek i√ßin a≈üaƒüƒ±daki site linklerine tƒ±klayƒ±n<br>
                            ‚Ä¢ API sunucusunun √ßalƒ±≈ütƒ±ƒüƒ±ndan emin olun<br>
                            ‚Ä¢ Birka√ß dakika sonra tekrar deneyin<br>
                            ‚Ä¢ Console'da hata mesajlarƒ±nƒ± kontrol edin (F12)
                        </small>
                    </div>`;
                }
            } catch (error) {
                console.error('Fiyat √ßekme hatasƒ±:', error);

                // file:// protokol√º kontrol√º
                const isFileProtocol = window.location.protocol === 'file:';
                let errorMsg = error.message;

                if (isFileProtocol) {
                    errorMsg = '‚ö†Ô∏è Dosya doƒürudan a√ßƒ±ldƒ±ƒüƒ± i√ßin CORS hatasƒ± olu≈üuyor.';
                }

                statusDiv.innerHTML = `<div class="price-status error">
                    ‚ùå ${errorMsg}<br>
                    <small style="display: block; margin-top: 12px; color: #666; line-height: 1.6;">
                        ${isFileProtocol ? `
                        <strong style="color: #d32f2f; display: block; margin-bottom: 8px;">üî¥ √ñNEMLƒ∞: Web Sunucusu Gerekli!</strong>
                        Dosyayƒ± doƒürudan a√ßtƒ±ƒüƒ±nƒ±z i√ßin (file://) CORS kƒ±sƒ±tlamalarƒ± nedeniyle fiyatlar √ßekilemiyor.<br><br>
                        <strong>‚úÖ √á√∂z√ºm - Web Sunucusu Kullanƒ±n:</strong><br>
                        <code style="background: #f5f5f5; padding: 4px 8px; border-radius: 4px; display: inline-block; margin: 4px 0;">
                            cd www<br>
                            python -m http.server 8000
                        </code><br><br>
                        Sonra tarayƒ±cƒ±da ≈üu adresi a√ßƒ±n:<br>
                        <code style="background: #f5f5f5; padding: 4px 8px; border-radius: 4px; display: inline-block; margin: 4px 0;">
                            http://localhost:8000/index.html
                        </code>
                        ` : `
                        üí° <strong>√á√∂z√ºm:</strong><br>
                        ‚Ä¢ Render.com dashboard'a gidin<br>
                        ‚Ä¢ API servisinizi bulun<br>
                        ‚Ä¢ "Redeploy" veya "Manual Deploy" butonuna tƒ±klayƒ±n<br>
                        ‚Ä¢ Deploy tamamlandƒ±ktan sonra tekrar deneyin
                        `}
                    </small>
                </div>`;
            }

            btn.disabled = false;
            btn.innerHTML = 'üìã Fiyatlarƒ± Listele';
        }

        // CORS proxy kullanarak HTML √ßekme
        async function fetchWithProxy(url) {
            // √áalƒ±≈üan ve g√ºvenilir proxy servisleri (CORS sorunlarƒ±nƒ± minimize etmek i√ßin)
            const proxies = [
                // 1. AllOrigins (JSON endpoint) - En g√ºvenilir, CORS desteƒüi iyi
                { url: `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`, type: 'json', timeout: 12000 },
                // 2. CodeTabs Proxy - G√ºvenilir alternatif
                { url: `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`, type: 'html', timeout: 10000 },
                // 3. AllOrigins (raw endpoint) - Hƒ±zlƒ± alternatif
                { url: `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`, type: 'html', timeout: 10000 },
                // 4. CORS Anywhere (public instance)
                { url: `https://cors-anywhere.herokuapp.com/${encodeURIComponent(url)}`, type: 'html', timeout: 8000 },
                // 5. AllOrigins (alternatif domain)
                { url: `https://allorigins.win/get?url=${encodeURIComponent(url)}`, type: 'json', timeout: 10000 },
                // 6. CORS Proxy
                { url: `https://corsproxy.io/?${encodeURIComponent(url)}`, type: 'html', timeout: 8000 },
                // 7. CORS.sh
                { url: `https://api.cors.sh/${encodeURIComponent(url)}`, type: 'html', timeout: 8000 },
                // 8. ProxyCORS
                { url: `https://proxycors.com/api?url=${encodeURIComponent(url)}`, type: 'json', timeout: 8000 },
                // 9. YACDN
                { url: `https://yacdn.org/proxy/${encodeURIComponent(url)}`, type: 'html', timeout: 8000 },
                // 10. ThingProxy
                { url: `https://thingproxy.freeboard.io/fetch/${encodeURIComponent(url)}`, type: 'html', timeout: 8000 }
            ];

            // T√ºm proxy'leri paralel dene (daha hƒ±zlƒ± sonu√ß i√ßin)
            const promises = proxies.map(async (proxy, index) => {
                try {
                    const timeoutPromise = new Promise((_, reject) =>
                        setTimeout(() => reject(new Error('Timeout')), proxy.timeout)
                    );

                    const fetchPromise = fetch(proxy.url, {
                        method: 'GET',
                        headers: {
                            'Accept': proxy.type === 'json' ? 'application/json' : 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
                            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
                            'Accept-Language': 'tr-TR,tr;q=0.9,en-US;q=0.8,en;q=0.7'
                        },
                        mode: 'cors',
                        cache: 'no-cache',
                        credentials: 'omit'
                    });

                    const response = await Promise.race([fetchPromise, timeoutPromise]);

                    if (response && response.ok) {
                        let text = await response.text();

                        // JSON endpoint'lerden gelen veriyi parse et
                        if (proxy.type === 'json') {
                            try {
                                const json = JSON.parse(text);
                                text = json.contents || json.content || json.data || json.body || text;
                            } catch (e) {
                                // JSON parse edilemezse olduƒüu gibi kullan
                            }
                        }

                        // ProxyCORS √∂zel parsing
                        if (proxy.url.includes('proxycors.com')) {
                            try {
                                const json = JSON.parse(text);
                                text = json.data || json.content || json.body || text;
                            } catch (e) {}
                        }

                        // CORS.sh √∂zel parsing
                        if (proxy.url.includes('cors.sh')) {
                            try {
                                const json = JSON.parse(text);
                                text = json.data || json.content || json.html || text;
                            } catch (e) {}
                        }

                        // Ge√ßerli HTML i√ßeriƒüi kontrol√º
                        if (text && typeof text === 'string' && text.length > 100) {
                            return { success: true, text, index: index + 1, proxy: proxy.url.split('/')[2] };
                        }
                    }
                } catch (error) {
                    // Hatalarƒ± sessizce yakala, bir sonraki proxy'ye ge√ß
                    return { success: false, error: error.message, index: index + 1 };
                }
                return { success: false, error: 'Invalid response', index: index + 1 };
            });

            // T√ºm sonu√ßlarƒ± bekle ve ilk ba≈üarƒ±lƒ± olanƒ± d√∂nd√ºr
            const results = await Promise.allSettled(promises);

            for (const result of results) {
                if (result.status === 'fulfilled' && result.value.success) {
                    console.log(`‚úì Proxy ba≈üarƒ±lƒ±: ${result.value.index}. servis (${result.value.proxy})`);
                    return result.value.text;
                }
            }

            // T√ºm proxy'ler ba≈üarƒ±sƒ±z olduysa detaylƒ± hata mesajƒ±
            const errors = results
                .filter(r => r.status === 'fulfilled' && !r.value.success)
                .map(r => `Proxy ${r.value.index}: ${r.value.error}`)
                .join(', ');

            throw new Error(`T√ºm proxy servisleri ba≈üarƒ±sƒ±z oldu. Hatalar: ${errors || 'Bilinmeyen hata'}. L√ºtfen daha sonra tekrar deneyin veya fiyatlarƒ± manuel olarak kontrol edin.`);
        }

        // D&R fiyat √ßekme
        async function fetchDRPrice(bookTitle, isbn) {
            // Retry mekanizmasƒ± - 2 kez dene
            for (let attempt = 0; attempt < 2; attempt++) {
                try {
                    const searchUrl = `https://www.dr.com.tr/search?q=${encodeURIComponent(isbn || bookTitle)}`;
                    const html = await fetchWithProxy(searchUrl);

                if (!html || html.length < 100) {
                    throw new Error('HTML i√ßeriƒüi yetersiz');
                }

                // JSON-LD structured data'dan fiyat √ßek (en g√ºvenilir)
                const jsonLdRegex = /<script[^>]*type=["']application\/ld\+json["'][^>]*>(.*?)<\/script>/gis;
                const jsonMatches = html.match(jsonLdRegex);
                if (jsonMatches) {
                    for (const match of jsonMatches) {
                        try {
                            const jsonStr = match.replace(/<script[^>]*>|<\/script>/gi, '');
                            const json = JSON.parse(jsonStr);
                            if (json.offers && json.offers.price) {
                                const price = parseFloat(json.offers.price);
                                if (price > 10 && price < 10000) {
                                    console.log('D&R JSON fiyat bulundu:', price);
                                    return price;
                                }
                            }
                            if (json.price) {
                                const price = parseFloat(json.price);
                                if (price > 10 && price < 10000) {
                                    console.log('D&R JSON price bulundu:', price);
                                    return price;
                                }
                            }
                        } catch (e) {}
                    }
                }

                // Daha kapsamlƒ± fiyat regex'leri
                const pricePatterns = [
                    /data-price=["']([0-9,\.]+)["']/gi,
                    /data-price=([0-9,\.]+)/gi,
                    /"price":\s*"([0-9,\.]+)"/gi,
                    /"price":\s*([0-9,\.]+)/gi,
                    /price["']?\s*:\s*["']?([0-9,\.]+)/gi,
                    /<span[^>]*class[^>]*["']price["'][^>]*>[\s]*([0-9,\.]+)[\s]*(?:TL|‚Ç∫)?/gi,
                    /<div[^>]*class[^>]*["']price["'][^>]*>[\s]*([0-9,\.]+)[\s]*(?:TL|‚Ç∫)?/gi,
                    /(?:fiyat|price)[^>]*>[\s]*([0-9]{1,4}(?:[.,][0-9]{2})?)[\s]*(?:TL|‚Ç∫)/gi
                ];

                const foundPrices = [];
                for (const pattern of pricePatterns) {
                    const matches = html.match(pattern);
                    if (matches) {
                        for (const match of matches) {
                            const priceText = match.replace(/[^0-9,.]/g, '').replace(',', '.');
                            const price = parseFloat(priceText);
                            if (price > 10 && price < 10000 && !foundPrices.includes(price)) {
                                foundPrices.push(price);
                            }
                        }
                    }
                }

                // En yaygƒ±n fiyatƒ± bul (en √ßok ge√ßen)
                if (foundPrices.length > 0) {
                    const priceCounts = {};
                    foundPrices.forEach(p => {
                        priceCounts[p] = (priceCounts[p] || 0) + 1;
                    });
                    const mostCommonPrice = Object.keys(priceCounts).reduce((a, b) =>
                        priceCounts[a] > priceCounts[b] ? a : b
                    );
                    const finalPrice = parseFloat(mostCommonPrice);
                    console.log('D&R fiyat bulundu:', finalPrice);
                    return finalPrice;
                }

                // Genel fiyat arama (son √ßare) - daha spesifik
                const generalPriceRegex = /([0-9]{2,4}(?:\.[0-9]{2})?)[\s]*(?:TL|‚Ç∫|lira|TRY)/gi;
                const generalMatches = html.match(generalPriceRegex);
                if (generalMatches) {
                    const prices = generalMatches.map(m => parseFloat(m.replace(/[^0-9.]/g, '')))
                        .filter(p => p > 10 && p < 10000);
                    if (prices.length > 0) {
                        // Ortalama fiyatƒ± al (daha g√ºvenilir)
                        const avgPrice = prices.reduce((a, b) => a + b, 0) / prices.length;
                        console.log('D&R genel fiyat bulundu:', avgPrice);
                        return Math.round(avgPrice * 100) / 100;
                    }
                }

                // Fiyat bulunamadƒ±ysa ve son deneme deƒüilse tekrar dene
                if (attempt < 1) {
                    await new Promise(resolve => setTimeout(resolve, 1000)); // 1 saniye bekle
                    continue;
                }
                } catch (error) {
                    console.error(`D&R fiyat √ßekme hatasƒ± (deneme ${attempt + 1}/2):`, error.message);
                    if (attempt < 1) {
                        // Son deneme deƒüilse tekrar dene
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        continue;
                    }
                    // Son deneme de ba≈üarƒ±sƒ±z oldu, sessizce devam et
                }
            }
            return null;
        }

        // BKM Kitap fiyat √ßekme
        async function fetchBKMPrice(bookTitle, isbn) {
            try {
                let searchUrl;
                if (isbn) {
                    searchUrl = `https://www.bkmkitap.com/kitap/${isbn.replace(/[-\s]/g, '')}`;
                } else {
                    searchUrl = `https://www.bkmkitap.com/arama?q=${encodeURIComponent(bookTitle)}`;
                }

                const html = await fetchWithProxy(searchUrl);

                // JSON-LD structured data'dan fiyat √ßek (en g√ºvenilir)
                const jsonLdRegex = /<script[^>]*type=["']application\/ld\+json["'][^>]*>(.*?)<\/script>/gis;
                const jsonMatches = html.match(jsonLdRegex);
                if (jsonMatches) {
                    for (const match of jsonMatches) {
                        try {
                            const jsonStr = match.replace(/<script[^>]*>|<\/script>/gi, '');
                            const json = JSON.parse(jsonStr);
                            if (json.offers && json.offers.price) {
                                const price = parseFloat(json.offers.price);
                                if (price > 10 && price < 10000) {
                                    console.log('BKM JSON fiyat bulundu:', price);
                                    return price;
                                }
                            }
                            if (json.price) {
                                const price = parseFloat(json.price);
                                if (price > 10 && price < 10000) {
                                    console.log('BKM JSON price bulundu:', price);
                                    return price;
                                }
                            }
                        } catch (e) {}
                    }
                }

                // BKM fiyat regex'leri
                const pricePatterns = [
                    /(?:fiyat|price|amount)[^>]*>[\s]*([0-9]{1,3}(?:\.[0-9]{2})?)[\s]*(?:TL|‚Ç∫)/gi,
                    /<span[^>]*class[^>]*price[^>]*>[\s]*([0-9,\.]+)[\s]*(?:TL|‚Ç∫)/gi,
                    /data-price=["']([0-9,\.]+)["']/gi,
                    /"price":\s*"([0-9,\.]+)"/gi,
                    /"price":\s*([0-9,\.]+)/gi,
                    /class="price"[^>]*>[\s]*([0-9,\.]+)/gi
                ];

                for (const pattern of pricePatterns) {
                    const matches = html.match(pattern);
                    if (matches) {
                        for (const match of matches) {
                            const priceText = match.replace(/[^0-9,.]/g, '').replace(',', '.');
                            const price = parseFloat(priceText);
                            if (price > 10 && price < 10000) {
                                console.log('BKM fiyat bulundu:', price);
                                return price;
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('BKM fiyat √ßekme hatasƒ±:', error);
            }
            return null;
        }

        // Kitapyurdu fiyat √ßekme
        async function fetchKitapyurduPrice(bookTitle, isbn) {
            try {
                let searchUrl;
                if (isbn) {
                    searchUrl = `https://www.kitapyurdu.com/index.php?route=product/search&filter_name=${encodeURIComponent(isbn)}`;
                } else {
                    searchUrl = `https://www.kitapyurdu.com/index.php?route=product/search&filter_name=${encodeURIComponent(bookTitle)}`;
                }

                const html = await fetchWithProxy(searchUrl);

                // Kitapyurdu fiyat regex'leri
                const pricePatterns = [
                    /(?:fiyat|price)[^>]*>[\s]*([0-9]{1,3}(?:\.[0-9]{2})?)[\s]*(?:TL|‚Ç∫)/gi,
                    /<span[^>]*class[^>]*price[^>]*>[\s]*([0-9,\.]+)[\s]*(?:TL|‚Ç∫)/gi,
                    /data-price=["']([0-9,\.]+)["']/gi,
                    /"price":\s*"([0-9,\.]+)"/gi,
                    /class="price"[^>]*>[\s]*([0-9,\.]+)/gi,
                    /<div[^>]*class[^>]*fiyat[^>]*>[\s]*([0-9,\.]+)/gi
                ];

                for (const pattern of pricePatterns) {
                    const matches = html.match(pattern);
                    if (matches) {
                        for (const match of matches) {
                            const priceText = match.replace(/[^0-9,.]/g, '').replace(',', '.');
                            const price = parseFloat(priceText);
                            if (price > 10 && price < 10000) {
                                console.log('Kitapyurdu fiyat bulundu:', price);
                                return price;
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('Kitapyurdu fiyat √ßekme hatasƒ±:', error);
            }
            return null;
        }

        // Hepsiburada fiyat √ßekme
        async function fetchHepsiburadaPrice(bookTitle, isbn) {
            try {
                const searchUrl = `https://www.hepsiburada.com/ara?q=${encodeURIComponent(isbn || bookTitle)}`;
                const html = await fetchWithProxy(searchUrl);

                // Hepsiburada fiyat regex'leri
                const pricePatterns = [
                    /(?:fiyat|price|amount)[^>]*>[\s]*([0-9]{1,3}(?:\.[0-9]{2})?)[\s]*(?:TL|‚Ç∫)/gi,
                    /<span[^>]*class[^>]*price[^>]*>[\s]*([0-9,\.]+)[\s]*(?:TL|‚Ç∫)/gi,
                    /data-price=["']([0-9,\.]+)["']/gi,
                    /"price":\s*"([0-9,\.]+)"/gi,
                    /"price":\s*([0-9,\.]+)/gi,
                    /class="price"[^>]*>[\s]*([0-9,\.]+)/gi
                ];

                for (const pattern of pricePatterns) {
                    const matches = html.match(pattern);
                    if (matches) {
                        for (const match of matches) {
                            const priceText = match.replace(/[^0-9,.]/g, '').replace(',', '.');
                            const price = parseFloat(priceText);
                            if (price > 10 && price < 10000) {
                                console.log('Hepsiburada fiyat bulundu:', price);
                                return price;
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('Hepsiburada fiyat √ßekme hatasƒ±:', error);
            }
            return null;
        }

        // Trendyol fiyat √ßekme
        async function fetchTrendyolPrice(bookTitle, isbn) {
            try {
                const searchUrl = `https://www.trendyol.com/sr?q=${encodeURIComponent(isbn || bookTitle)}`;
                const html = await fetchWithProxy(searchUrl);

                // Trendyol fiyat regex'leri
                const pricePatterns = [
                    /(?:fiyat|price|amount)[^>]*>[\s]*([0-9]{1,3}(?:\.[0-9]{2})?)[\s]*(?:TL|‚Ç∫)/gi,
                    /<span[^>]*class[^>]*price[^>]*>[\s]*([0-9,\.]+)[\s]*(?:TL|‚Ç∫)/gi,
                    /data-price=["']([0-9,\.]+)["']/gi,
                    /"price":\s*"([0-9,\.]+)"/gi,
                    /"price":\s*([0-9,\.]+)/gi,
                    /class="price"[^>]*>[\s]*([0-9,\.]+)/gi
                ];

                for (const pattern of pricePatterns) {
                    const matches = html.match(pattern);
                    if (matches) {
                        for (const match of matches) {
                            const priceText = match.replace(/[^0-9,.]/g, '').replace(',', '.');
                            const price = parseFloat(priceText);
                            if (price > 10 && price < 10000) {
                                console.log('Trendyol fiyat bulundu:', price);
                                return price;
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('Trendyol fiyat √ßekme hatasƒ±:', error);
            }
            return null;
        }

        // Amazon fiyat √ßekme
        async function fetchAmazonPrice(bookTitle, isbn) {
            try {
                const searchUrl = `https://www.amazon.com.tr/s?k=${encodeURIComponent(isbn || bookTitle)}`;
                const html = await fetchWithProxy(searchUrl);

                // Amazon fiyat regex'leri
                const pricePatterns = [
                    /(?:fiyat|price|amount)[^>]*>[\s]*([0-9]{1,3}(?:\.[0-9]{2})?)[\s]*(?:TL|‚Ç∫)/gi,
                    /<span[^>]*class[^>]*price[^>]*>[\s]*([0-9,\.]+)[\s]*(?:TL|‚Ç∫)/gi,
                    /data-price=["']([0-9,\.]+)["']/gi,
                    /"price":\s*"([0-9,\.]+)"/gi,
                    /"price":\s*([0-9,\.]+)/gi,
                    /class="a-price"[^>]*>[\s]*([0-9,\.]+)/gi
                ];

                for (const pattern of pricePatterns) {
                    const matches = html.match(pattern);
                    if (matches) {
                        for (const match of matches) {
                            const priceText = match.replace(/[^0-9,.]/g, '').replace(',', '.');
                            const price = parseFloat(priceText);
                            if (price > 10 && price < 10000) {
                                console.log('Amazon fiyat bulundu:', price);
                                return price;
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('Amazon fiyat √ßekme hatasƒ±:', error);
            }
            return null;
        }

        // Modal dƒ±≈üƒ±na tƒ±klandƒ±ƒüƒ±nda kapat
        document.addEventListener('click', function(e) {
            const singleModal = document.getElementById('singleBookPriceModal');
            if (e.target === singleModal) {
                closeSingleBookPriceModal();
            }
        });


        // Sayfa y√ºklendiƒüinde favori sayƒ±sƒ±nƒ± g√ºncelle ve event listener'larƒ± ekle
        document.addEventListener('DOMContentLoaded', function() {
            // localStorage ba≈ülatmasƒ±
            if (!localStorage.getItem("searchCount")) localStorage.setItem("searchCount", 0);
            if (!localStorage.getItem("ownedBadges")) localStorage.setItem("ownedBadges", "[]");

            // Splash screen'i kapat (yumu≈üak ge√ßi≈ü)
            setTimeout(function() {
                try {
                    const splashScreen = document.getElementById('splash-screen');
                    if (splashScreen && !splashScreen.classList.contains('splash-hidden')) {
                        splashScreen.classList.remove('splash-visible');
                        splashScreen.classList.add('splash-hidden');
                        // Animasyon bittikten sonra DOM'dan kaldƒ±r
                        setTimeout(function() {
                            if (splashScreen) {
                                splashScreen.classList.add('splash-removed');
                            }
                        }, 1200);
                    }
                } catch (e) {
                    // Sessizce devam et
                }
            }, 2800); // 2.8 saniye

            // Tema tercihini y√ºkle
            const savedTheme = getThemePreference();
            applyTheme(savedTheme);

            // Sistem temasƒ± deƒüi≈üikliƒüini dinle (sadece auto modda)
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
                if (getThemePreference() === 'auto') {
                    applyTheme('auto');
                }
            });

            updateFavoritesCount();

            // √únvanƒ± g√ºncelle
            updateActiveTitle();
            
            // Yeni rozet var mƒ± kontrol et (kƒ±rmƒ±zƒ± bildirim noktasƒ±)
            checkForNewBadges();

            // Arama input event listener'larƒ±
            const searchInput = document.getElementById('searchInput');
            const searchHistoryDropdown = document.getElementById('searchHistoryDropdown');
            const sortSelect = document.getElementById('sortSelect');

            // Input odaklandƒ±ƒüƒ±nda arama ge√ßmi≈üini g√∂ster
            if (searchInput) {
                searchInput.addEventListener('focus', function() {
                    showSearchHistory();
                });

                // Input'tan √ßƒ±kƒ±ldƒ±ƒüƒ±nda dropdown'ƒ± kapat (kƒ±sa bir gecikme ile)
                searchInput.addEventListener('blur', function() {
                    setTimeout(() => {
                        hideSearchHistory();
                    }, 200); // Tƒ±klama i≈üleminin tamamlanmasƒ± i√ßin gecikme
                });

                // Enter tu≈üu ile arama
                searchInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        searchBooks();
                    } else if (e.key === 'Escape') {
                        hideSearchHistory();
                    }
                });
            }

            // Sƒ±ralama se√ßeneƒüi deƒüi≈ütiƒüinde
            if (sortSelect) {
                sortSelect.addEventListener('change', function() {
                    currentOrderBy = this.value;
                    // Eƒüer arama terimi varsa otomatik olarak yeniden ara
                    const searchTerm = searchInput.value.trim();
                    if (searchTerm) {
                        searchBooks();
                    }
                });
            }

            // Rastgele Kitap butonu event listener
        });

        // displayResults fonksiyonu zaten favori durumunu kontrol ediyor, ek bir wrapper'a gerek yok
        // Native reklam verilerini sakla
        let nativeAdData = null;
        
        function showNativeAd(headline, body, cta, imageUrl) {
            try {
                // Native reklam verilerini sakla (kitaplar arasƒ±nda g√∂stermek i√ßin)
                nativeAdData = {
                    headline: headline || 'Sponsorlu ƒ∞√ßerik',
                    body: body || '',
                    cta: cta || 'Detaylarƒ± G√∂r',
                    imageUrl: imageUrl || ''
                };
                
                // Eƒüer sonu√ßlar zaten g√∂sterilmi≈üse, reklamƒ± ekle
                insertNativeAdIntoResults();
                
            } catch (error) {
                console.error('Native reklam verisi kaydedilirken hata:', error);
            }
        }
        
        // Native reklamƒ± kitaplarƒ±n arasƒ±na ekle (3. kitaptan sonra)
        function insertNativeAdIntoResults() {
            if (!nativeAdData) return;
            
            // Mevcut native reklam varsa kaldƒ±r
            const existingAd = document.getElementById('native-ad-card');
            if (existingAd) {
                existingAd.remove();
            }
            
            // Sonu√ß container'ƒ±nƒ± bul
            const resultsContainer = document.getElementById('results-normal');
            if (!resultsContainer || resultsContainer.style.display === 'none') {
                // Sonu√ßlar g√∂r√ºnm√ºyorsa ad-placeholder'a ekle
                const adPlaceholder = document.getElementById('ad-placeholder');
                if (adPlaceholder) {
                    adPlaceholder.innerHTML = '';
                    adPlaceholder.appendChild(createNativeAdCard());
                }
                return;
            }
            
            // Kitap kartlarƒ±nƒ± bul
            const bookCards = resultsContainer.querySelectorAll('.book-card:not(#native-ad-card)');
            
            if (bookCards.length >= 3) {
                // 3. kitaptan sonra ekle
                const thirdBook = bookCards[2];
                thirdBook.parentNode.insertBefore(createNativeAdCard(), thirdBook.nextSibling);
            } else if (bookCards.length > 0) {
                // 3'ten az kitap varsa en sona ekle
                resultsContainer.appendChild(createNativeAdCard());
            } else {
                // Hi√ß kitap yoksa ad-placeholder'a ekle
                const adPlaceholder = document.getElementById('ad-placeholder');
                if (adPlaceholder) {
                    adPlaceholder.innerHTML = '';
                    adPlaceholder.appendChild(createNativeAdCard());
                }
            }
        }
        
        // Native reklam kartƒ± olu≈ütur
        function createNativeAdCard() {
            const safeHeadline = escapeHtml(nativeAdData.headline);
            const safeBody = escapeHtml(nativeAdData.body);
            const safeCta = escapeHtml(nativeAdData.cta);
            const safeImageUrl = nativeAdData.imageUrl;
            const placeholderId = 'placeholder-native-ad';

            // G√∂rsel varsa kullan, yoksa placeholder g√∂ster
            let imageHtml = '';
            if (safeImageUrl && safeImageUrl.trim() !== '') {
                imageHtml = `<img src="${escapeHtml(safeImageUrl)}" alt="${safeHeadline}" class="book-cover" style="max-width: 100%; height: auto;" onerror="this.style.display='none'; const placeholder = this.nextElementSibling; if(placeholder) placeholder.classList.add('show');">${createPlaceholderImage(nativeAdData.headline || 'Reklam', false, placeholderId)}`;
            } else {
                imageHtml = createPlaceholderImage(nativeAdData.headline || 'Reklam', true, placeholderId);
            }

            const adCard = document.createElement('div');
            adCard.className = 'book-card';
            adCard.id = 'native-ad-card';
            adCard.setAttribute('role', 'listitem');
            adCard.setAttribute('aria-label', `Reklam: ${safeHeadline}`);
            adCard.style.border = '2px solid rgba(255, 193, 7, 0.5)';
            adCard.style.background = 'linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 152, 0, 0.05))';

            adCard.innerHTML = `
                <div class="ad-badge" style="
                    position: absolute;
                    top: 8px;
                    left: 8px;
                    background: linear-gradient(135deg, #ffc107, #ff9800);
                    color: #000;
                    padding: 3px 8px;
                    border-radius: 4px;
                    font-size: 10px;
                    font-weight: bold;
                    z-index: 10;
                ">REKLAM</div>
                ${imageHtml}
                <div class="book-info">
                    <div class="book-title" style="margin-top: 5px;">
                        ${safeHeadline}
                    </div>
                    <div class="book-author" style="color: #888;">Sponsorlu i√ßerik</div>
                    <div class="book-summary">${safeBody}</div>
                    <div class="purchase-links" role="group" aria-label="Sponsor baƒülantƒ±sƒ±">
                        <a href="#" class="purchase-link" style="background: linear-gradient(135deg, #ffc107, #ff9800); color: #000;" onclick="onNativeAdClick(event)">
                            ${safeCta}
                        </a>
                    </div>
                </div>
            `;

            return adCard;
        }

        // Native ad tƒ±klama handler
        function onNativeAdClick(event) {
            event.preventDefault();
            try {
                if (window.AndroidBridge && AndroidBridge.onNativeAdClicked) {
                    AndroidBridge.onNativeAdClicked();
                }
            } catch (err) {
                console.error("Native ad click error:", err);
            }
        }

        // Modal Kapatma (Genel)
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('show');
            }
        }

        // Rozet verileri
        const badges = [
            { level: 10, name: "Kitap Meraklƒ±sƒ±", icon: "üìò" },
            { level: 20, name: "Kitap Kurdu", icon: "üìö" },
            { level: 30, name: "Okuma Ustasƒ±", icon: "üß†" },
            { level: 40, name: "Kitap Yolcusu", icon: "üó∫Ô∏è" },
            { level: 50, name: "Kitap K√¢≈üifi", icon: "üî≠" },
            { level: 100, name: "Kitap Profes√∂r√º", icon: "üéì" }
        ];

        // Yeni rozet olup olmadƒ±ƒüƒ±nƒ± kontrol et ve kƒ±rmƒ±zƒ± nokta g√∂ster
        function checkForNewBadges() {
            let count = Number(localStorage.getItem("searchCount") || 0);
            let owned = JSON.parse(localStorage.getItem("ownedBadges") || "[]");
            
            let hasUnclaimed = false;
            badges.forEach(b => {
                const earned = count >= b.level;
                const alreadyOwned = owned.includes(b.level);
                if (earned && !alreadyOwned) hasUnclaimed = true;
            });
            
            const notifEl = document.getElementById("badgeNotif");
            if (notifEl) {
                notifEl.classList.toggle("active", hasUnclaimed);
            }
            
            return hasUnclaimed;
        }
        
        // Rozetleri ekranda listeleyen fonksiyon
        function openBadges() {
            document.getElementById("badgesModal").style.display = "flex";

            let count = Number(localStorage.getItem("searchCount") || 0);
            let owned = JSON.parse(localStorage.getItem("ownedBadges") || "[]");

            const grid = document.getElementById("badgeGrid");
            grid.innerHTML = "";

            let hasUnclaimed = false;

            badges.forEach(b => {
                const earned = count >= b.level;
                const alreadyOwned = owned.includes(b.level);

                if (earned && !alreadyOwned) hasUnclaimed = true;

                grid.innerHTML += `
                    <div class="badge-card ${earned ? 'unlocked' : ''}">
                        <div style="font-size:36px">${b.icon}</div>
                        <div style="margin-top:4px">${b.name}</div>
                        <small>${b.level} arama gerekli</small>
                        ${
                            earned && !alreadyOwned 
                                ? `<button onclick="claimBadge(${b.level}, '${b.name}', '${b.icon}')">AL</button>`
                                : alreadyOwned 
                                    ? `<small style='color:#4caf50;'>Alƒ±ndƒ± ‚úì</small>`
                                    : ``
                        }
                    </div>
                `;
            });

            document.getElementById("badgeNotif").classList.toggle("active", hasUnclaimed);
        }

        // √únvanƒ± sayfaya yazdƒ±ran fonksiyon
        function updateActiveTitle() {
            const title = localStorage.getItem("activeTitle") || "‚Äî";
            const activeTitleEl = document.getElementById("activeTitle");
            if (activeTitleEl) {
                activeTitleEl.innerText = title;
            }
        }

        // Rozet alma fonksiyonu
        function claimBadge(level, name, icon) {
            let owned = JSON.parse(localStorage.getItem("ownedBadges") || "[]");
            if (!owned.includes(level)) {
                owned.push(level);
            }
            localStorage.setItem("ownedBadges", JSON.stringify(owned));
            // Emoji + √ºnvan adƒ± birlikte kaydet
            localStorage.setItem("activeTitle", `${icon} ${name}`);

            updateActiveTitle();  // √únvan hemen yenilensin
            openBadges();         // Rozet ekranƒ± yenilensin
        }

        // Modal kapatma fonksiyonu
        function closeBadges() {
            document.getElementById("badgesModal").style.display = "none";
        }

    </script>
    <script src="./scripts/badges.js?v=2.0.0"></script>
    <div id="banner-space"></div>
</body>
</html>